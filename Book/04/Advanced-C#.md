# ูุตู ฺูุงุฑู: ุณ ุดุงุฑูพ ูพุดุฑูุชู

ุฏุฑ ุงู ูุตูุ ุจู ุณุฑุงุบ ูุจุงุญุซ ูพุดุฑูุชู ุฒุจุงู C# ูโุฑูู ฺฉู ุจุฑ ูพุงู ููุงูู ุจูุง ุดุฏูโุงูุฏ ฺฉู ุฏุฑ ูุตูโูุง 2 ู 3 ุจุฑุฑุณ ฺฉุฑุฏู.
ฺูุงุฑ ุจุฎุด ุงูู ุฑุง ุจุงุฏ ุจู ุตูุฑุช ูพูุณุชู ู ูพุดุช ุณุฑ ูู ูุทุงูุนู ฺฉูุฏุ ุงูุง ุจุฎุดโูุง ุจุงูโูุงูุฏู ุฑุง ูโุชูุงูุฏ ุจู ูุฑ ุชุฑุชุจ ุจุฎูุงูุฏ.

### Delegates (ููุงูุฏฺฏุงู) ๐จ

ฺฉ delegate ฺฉ ุดุก ุงุณุช ฺฉู ูโุฏุงูุฏ ฺฺฏููู ฺฉ ูุชุฏ ุฑุง ูุฑุงุฎูุงู ฺฉูุฏ.

ููุน delegate ุชุนู ูโฺฉูุฏ ฺฉู ูููููโูุง delegate ูโุชูุงููุฏ ฺู ููุน ูุชุฏูุง ุฑุง ูุฑุงุฎูุงู ฺฉููุฏ. ุจู ุทูุฑ ูุดุฎุตุ ฺฉ delegate ููุน ุจุงุฒฺฏุดุช ูุชุฏ ู ุงููุงุน ูพุงุฑุงูุชุฑูุง ูุชุฏ ุฑุง ุชุนุฑู ูโฺฉูุฏ.

ูุซุงู: ุชุนุฑู ฺฉ ููุน delegate ุจู ูุงู Transformer:
```c#
delegate int Transformer(int x);
```

ุงู delegate ุจุง ูุฑ ูุชุฏ ฺฉู ุจุงุฒฺฏุดุช ุงุฒ ููุน int ุฏุงุดุชู ุจุงุดุฏ ู ฺฉ ูพุงุฑุงูุชุฑ int ุจฺฏุฑุฏ ุณุงุฒฺฏุงุฑ ุงุณุช. ูุซู ุงู:
```c#
int Square(int x) { return x * x; }
```

ุง ุจู ุตูุฑุช ฺฉูุชุงูโุชุฑ (expression-bodied):
```c#
int Square(int x) => x * x;
```
**ุณุงุฎุชู ู ุงุณุชูุงุฏู ุงุฒ ฺฉ delegate ๐๏ธ**

ุงุฎุชุตุงุต ฺฉ ูุชุฏ ุจู ฺฉ ูุชุบุฑ delegateุ ุจุงุนุซ ุงุฌุงุฏ ฺฉ ููููู delegate ูโุดูุฏ:
```c#
Transformer t = Square;
```

ูุฑุงุฎูุงู ฺฉ ููููู delegate ุฏููุงู ูุซู ูุฑุงุฎูุงู ฺฉ ูุชุฏ ุงุณุช:
```c#
int answer = t(3);   // answer ุจุฑุงุจุฑ ุจุง 9
```

ูุซุงู ฺฉุงูู:
```c#
Transformer t = Square;   // ุงุฌุงุฏ ููููู delegate
int result = t(3);        // ูุฑุงุฎูุงู delegate
Console.WriteLine(result); // ุฎุฑูุฌ: 9

int Square(int x) => x * x;

delegate int Transformer(int x);  // ุชุนุฑู ููุน delegate
```
**ููููู ุงุตู delegate ๐ฏ**

ฺฉ ููููู delegate ูุงูุนุงู ุจู ุนููุงู ููุงูุฏูโ caller ุนูู ูโฺฉูุฏ:
caller (ูุฑุงุฎูุงููุฏู) delegate ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏ ู ุณูพุณ delegateุ ูุชุฏ ูุฏู ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏ.

ุงู ูุงุณุทูโฺฏุฑ (indirection) ุจุงุนุซ ูโุดูุฏ ฺฉู caller ุงุฒ ูุชุฏ ูุฏู ุฌุฏุง ู ูุณุชูู ุจุงุดุฏ.

**ูฺฉุชูโูุง ููู โ**

ุฏุณุชูุฑ:
```
Transformer t = Square;
```

ุฏุฑ ูุงูุน ฺฉ ูุงูโุจูุฑ (shorthand) ุจุฑุง ุงู ุงุณุช:
```c#
Transformer t = new Transformer(Square);
```

ุนุจุงุฑุช:
```
t(3)
```

ูุงูโุจูุฑ ุงุณุช ุจุฑุง:
```
t.Invoke(3)
```

ุงุฒ ูุธุฑ ููุ ููุช ุจู Square ุจุฏูู ูพุฑุงูุชุฒ ู ุขุฑฺฏููุงู ุงุดุงุฑู ูโฺฉููุ ุฏุฑ ุญุงู ูุดุฎุต ฺฉุฑุฏู ฺฉ method group ูุณุชู.
ุงฺฏุฑ ูุชุฏ overload ุดุฏู ุจุงุดุฏุ ฺฉุงููพุงูุฑ C# ุจุฑ ุงุณุงุณ ุงูุถุง delegate ุงูุชุฎุงุจ ูโฺฉูุฏ ฺฉู ฺฉุฏุงู overload ููุงุณุจ ุงุณุช.

**Delegate ุดุจู ุจู Callback ๐**


ฺฉ delegate ูุดุงุจู ฺุฒ ุงุณุช ฺฉู ุฏุฑ ุงุตุทูุงุญ ุนููู callback ูุงูุฏู ูโุดูุฏ.
ุงู ููููู ุณุงุฒูโูุง ูุซู function pointers ุฏุฑ ุฒุจุงู C ุฑุง ูุฒ ุฏุฑ ุจุฑ ูโฺฏุฑุฏ.

### ููุดุชู ูุชุฏูุง ูพูุงฺฏู ุจุง ุงุณุชูุงุฏู ุงุฒ Delegateูุง โจ

ฺฉ ูุชุบุฑ ุงุฒ ููุน delegate ุฏุฑ ุฒูุงู ุงุฌุฑุง (runtime) ุจู ฺฉ ูุชุฏ ูุณุจุช ุฏุงุฏู ูโุดูุฏ. ุงู ูฺฺฏ ุจุฑุง ููุดุชู ูุชุฏูุง ูพูุงฺฏู (plug-in methods) ุจุณุงุฑ ฺฉุงุฑุจุฑุฏ ุงุณุช.

ุฏุฑ ูุซุงู ุฒุฑุ ูุง ฺฉ ูุชุฏ ฺฉูฺฉ (utility method) ุจู ูุงู Transform ุฏุงุฑู ฺฉู ฺฉ ุนูู transform ุฑุง ุฑู ูุฑ ุนุถู ุงุฒ ฺฉ ุขุฑุงูโ ุนุฏุฏ (integer array) ุงุนูุงู ูโฺฉูุฏ. ุงู ูุชุฏ Transform ฺฉ ูพุงุฑุงูุชุฑ ุงุฒ ููุน delegate ุฏุงุฑุฏ ฺฉู ูโุชูุงูุฏ ุจุฑุง ูุดุฎุต ฺฉุฑุฏู ูพูุงฺฏู transform ุงุฒ ุขู ุงุณุชูุงุฏู ฺฉูุฏ:
```c#
int[] values = { 1, 2, 3 };
Transform (values, Square);      // ุงุชุตุงู ูุชุฏ Square ุจู Transform
foreach (int i in values)
  Console.Write (i + "  ");      // ุฎุฑูุฌ: 1   4   9

void Transform (int[] values, Transformer t)
{
  for (int i = 0; i < values.Length; i++)
    values[i] = t (values[i]);
}

int Square (int x) => x * x;
int Cube (int x) => x * x * x;

delegate int Transformer (int x);
```

๐น ุฏุฑ ุงูุฌุง ุงฺฏุฑ ุฏุฑ ุฎุท ุฏูู ุจูโุฌุง Square ุงุฒ Cube ุงุณุชูุงุฏู ฺฉููุ ุชุจุฏู ุฑู ุงุนุฏุงุฏ ุจูโุตูุฑุช ูฺฉุนุจ (ุชูุงู ุณูู) ุงูุฌุงู ูโุดูุฏ.

๐น ูุชุฏ Transform ฺฉ higher-order function ุงุณุชุ ฺูู ฺฉ ุชุงุจุน (delegate) ุฑุง ุจูโุนููุงู ุขุฑฺฏููุงู ูโฺฏุฑุฏ. (ูุฑ ูุชุฏ ฺฉู ฺฉ delegate ุฑุง ุจุฑฺฏุฑุฏุงูุฏ ูุฒ ฺฉ higher-order function ูุญุณูุจ ูโุดูุฏ.)

### ุงูุฏุงู ูุชุฏ ุฏุฑ Delegateูุง: Instance ู Static โก

ฺฉ ูุชุฏ ูุฏู (target method) ุจุฑุง ฺฉ delegate ูโุชูุงูุฏ ูุญู (local)ุ ุงุณุชุง (static) ุง ูููููโุง (instance) ุจุงุดุฏ.

ูุซุงู ฺฉ ูุชุฏ static ุจูโุนููุงู ูุฏู delegate:
```c#
Transformer t = Test.Square;
Console.WriteLine (t(10));      // 100

class Test 
{ 
    public static int Square (int x) => x * x; 
}

delegate int Transformer (int x);
```
ูุซุงู ฺฉ ูุชุฏ instance ุจูโุนููุงู ูุฏู delegate:
```c#
Test test = new Test();
Transformer t = test.Square;
Console.WriteLine (t(10));      // 100

class Test 
{ 
    public int Square (int x) => x * x; 
}

delegate int Transformer (int x);
```

๐ ุฒูุงู ฺฉู ฺฉ ูุชุฏ instance ุจู ฺฉ delegate ุงุฎุชุตุงุต ุฏุงุฏู ูโุดูุฏุ ุขู delegate ููุท ุจู ุฎูุฏ ูุชุฏ ุงุดุงุฑู ููโฺฉูุฏุ ุจูฺฉู ูููููโุง ุงุฒ ฺฉูุงุณ ฺฉู ูุชุฏ ุจู ุขู ุชุนูู ุฏุงุฑุฏ ุฑุง ูู ูฺฏูโุฏุงุฑ ูโฺฉูุฏ.

**ุฎุงุตุช Target ุฏุฑ ฺฉูุงุณ System.Delegate ๐ฏ**

ฺฉูุงุณ System.Delegate ฺฉ ูฺฺฏ ุจู ูุงู Target ุฏุงุฑุฏ ฺฉู ุงู ููููู (instance) ุฑุง ูุดุงู ูโุฏูุฏ (ู ุงฺฏุฑ delegate ุจู ฺฉ ูุชุฏ static ุงุดุงุฑู ฺฉูุฏุ ููุฏุงุฑุด null ุฎูุงูุฏ ุจูุฏ).

ูุซุงู:
```c#
MyReporter r = new MyReporter();
r.Prefix = "%Complete: ";

ProgressReporter p = r.ReportProgress;
p(99);                                 // %Complete: 99

Console.WriteLine (p.Target == r);     // True
Console.WriteLine (p.Method);          // Void ReportProgress(Int32)

r.Prefix = "";
p(99);                                 // 99

public delegate void ProgressReporter (int percentComplete);

class MyReporter
{
  public string Prefix = "";
  public void ReportProgress (int percentComplete)
    => Console.WriteLine (Prefix + percentComplete);
}
```

โ ฺูู ููููู (instance) ุฏุฑ ุฎุงุตุช Target ุฐุฎุฑู ูโุดูุฏุ ุทูู ุนูุฑ ุขู ุญุฏุงูู ุจู ุงูุฏุงุฒู ุทูู ุนูุฑ delegate ฺฏุณุชุฑุด ูโุงุจุฏ.

๐ ุฌูุนโุจูุฏ:

+ Delegateูุง ุจู ูุง ุงุฌุงุฒู ูโุฏููุฏ ฺฉู ูุชุฏูุง ุฑุง ูุซู ูุชุบุฑูุง ูพุงุณ ุจุฏูู.

+ ูโุชูุงููุฏ ุจู ูุชุฏูุง static ุง instance ูุชุตู ุดููุฏ.

+ ุฎุงุตุช Target ุชุถูู ูโฺฉูุฏ ฺฉู ููููู ูุฑุจูุท ุจู ูุชุฏ instance ุชุง ููุช delegate ุฒูุฏู ุงุณุชุ ุจุงู ุจูุงูุฏ.

๐ก ุงู ููููู ูพุงูโุง ุฏุฑ ุทุฑุงุญ ูพูุงฺฏูโูุงุ ฺฉุงูโุจฺฉโูุง ู ุจุฑูุงููโููุณ ุดุกฺฏุฑุงุณุช.
### ููุงูุฏฺฏุงู ฺูุฏูพุฎุด (Multicast Delegates) ๐ฏ

ุชูุงู ูููููโูุง delegate ุฏุฑ ุณโุดุงุฑูพ ุฏุงุฑุง ูุงุจูุช ฺูุฏูพุฎุด (multicast) ูุณุชูุฏ. ุงู ุนู ฺฉ ูููููโ delegate ูโุชูุงูุฏ ูู ููุท ุจู ฺฉ ูุชุฏุ ุจูฺฉู ุจู ฺฉ ูุณุช ุงุฒ ูุชุฏูุง ุงุดุงุฑู ฺฉูุฏ.

ุนููฺฏุฑูุง + ู += ุจุฑุง ุชุฑฺฉุจ ฺฉุฑุฏู ูููููโูุง delegate ุงุณุชูุงุฏู ูโุดููุฏ:
```c#
SomeDelegate d = SomeMethod1;
d += SomeMethod2;
```

ุฎุท ุขุฎุฑ ุงุฒ ูุธุฑ ุนููฺฉุฑุฏ ุฏููุงู ูุนุงุฏู ุงู ุงุณุช:
```c#
d = d + SomeMethod2;
```

ุงฺฉููู ููุช d ูุฑุงุฎูุงู ุดูุฏุ ูู SomeMethod1 ู ูู SomeMethod2 ุงุฌุฑุง ูโุดููุฏ.
โ ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ูุชุฏูุง ุจู ุชุฑุชุจ ฺฉู ุงุถุงูู ุดุฏูโุงูุฏ ูุฑุงุฎูุงู ูโุดููุฏ.

ุนููฺฏุฑูุง - ู -= ูู ุจุฑุง ุญุฐู ฺฉ ูุชุฏ ุงุฒ ูุณุช ูุชุฏูุง ฺฉ delegate ุงุณุชูุงุฏู ูโุดููุฏ:
```
d -= SomeMethod1;
```

ุงฺฉููู ูุฑุงุฎูุงู d ุจุงุนุซ ูโุดูุฏ ููุท SomeMethod2 ุงุฌุฑุง ุดูุฏ.

๐ ูฺฉุชู ููู:

+ ููุช ุฑู ฺฉ ูุชุบุฑ delegate ฺฉู ููุฏุงุฑุด null ุงุณุชุ ุนูู + ุง += ุงูุฌุงู ุฏูุฏุ ุจุงุฒ ูู ฺฉุงุฑ ูโฺฉูุฏ ู ูุนุงุฏู ุงู ุงุณุช ฺฉู ุจู ุขู ููุฏุงุฑ ุฌุฏุฏ ุจุฏูุฏ:
```c#
SomeDelegate d = null;
d += SomeMethod1;   // ูุนุงุฏู ุจุง: d = SomeMethod1 ููุช d ุจุฑุงุจุฑ null ุงุณุช
```

+ ุจู ุทูุฑ ูุดุงุจูุ ุงฺฏุฑ ุฑู ฺฉ delegate ฺฉู ููุท ฺฉ ูุชุฏ ุฑุง ูฺฏู ุฏุงุดุชู ุจุงุดุฏ ุนูู -= ฺฉูุฏุ ูุชุฌูโุงุด ูุนุงุฏู ุงุฎุชุตุงุต ููุฏุงุฑ null ุจู ุขู ูุชุบุฑ ุฎูุงูุฏ ุจูุฏ.

โก ฺฉ ูฺฉุชู ููู ุฏฺฏุฑ:
Delegates ุฏุฑ ุณโุดุงุฑูพ immutable ูุณุชูุฏ. ุนู ููุช ุดูุง += ุง -= ุฑุง ุงุณุชูุงุฏู ูโฺฉูุฏุ ุฏุฑ ูุงูุน ฺฉ ูููููโ ุฌุฏุฏ ุงุฒ delegate ุณุงุฎุชู ูโุดูุฏ ู ุจู ูุชุบุฑ ููุฌูุฏ ุงุฎุชุตุงุต ุฏุงุฏู ูโุดูุฏ.

๐ข ุงฺฏุฑ ฺฉ delegate ฺูุฏูพุฎุด (multicast delegate) ุฏุงุฑุง ููุน ุจุงุฒฺฏุดุช ุบุฑ ุงุฒ void ุจุงุดุฏุ ููุฏุงุฑ ุจุงุฒฺฏุดุช ฺฉู ุดูุง ุฏุฑุงูุช ูโฺฉูุฏ ูุฑุจูุท ุจู ุขุฎุฑู ูุชุฏ ุงุณุช ฺฉู ุงุฌุฑุง ุดุฏู ุงุณุช. ูุชุฏูุง ูุจู ููฺูุงู ุงุฌุฑุง ูโุดููุฏุ ุงูุง ููุฏุงุฑ ุจุงุฒฺฏุดุช ุขูโูุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดูุฏ.
(ุจู ููู ุฏููุ ุฏุฑ ุจุดุชุฑ ููุงุฑุฏ ฺฉู ุงุฒ multicast delegate ุงุณุชูุงุฏู ูโุดูุฏุ ุขูโูุง void ุจุฑูโฺฏุฑุฏุงููุฏ.)

๐งฉ ุชูุงู ุงููุงุน delegate ุจู ุทูุฑ ุถูู ุงุฒ System.MulticastDelegate ุงุฑุซโุจุฑ ูโฺฉููุฏ ฺฉู ุฎูุฏุด ุงุฒ System.Delegate ุงุฑุซโุจุฑ ูโฺฉูุฏ.
ฺฉุงููพุงูุฑ ุณโุดุงุฑูพ ุชูุงู ุนููุงุช +ุ -ุ += ู -= ุฑู delegateูุง ุฑุง ุจู ูุชุฏูุง ุงุณุชุงุชฺฉ Combine ู Remove ุงุฒ ฺฉูุงุณ System.Delegate ุชุจุฏู ูโฺฉูุฏ.
#### ูุซุงู Multicast Delegate ๐๏ธ

ูุฑุถ ฺฉูุฏ ฺฉ ูุชุฏ ููุดุชูโุงุฏ ฺฉู ุงุฌุฑุง ุขู ุฒูุงู ุฒุงุฏ ูโุจุฑุฏ. ุงู ูุชุฏ ูโุชูุงูุฏ ุจู ุทูุฑ ููุธู ูุฒุงู ูพุดุฑูุช ฺฉุงุฑ ุฑุง ุจู ูุฑุงุฎูุงููุฏู ฺฏุฒุงุฑุด ุฏูุฏุ ุงู ฺฉุงุฑ ุจุง ูุฑุงุฎูุงู ฺฉ delegate ุงูุฌุงู ูโุดูุฏ.

ุฏุฑ ูุซุงู ุฒุฑุ ูุชุฏ HardWork ฺฉ ูพุงุฑุงูุชุฑ ุงุฒ ููุน delegate ุจู ูุงู ProgressReporter ุฏุฑุงูุช ูโฺฉูุฏ ู ุงุฒ ุขู ุจุฑุง ูุดุงู ุฏุงุฏู ูพุดุฑูุช ุงุณุชูุงุฏู ูโฺฉูุฏ:
```c#
public delegate void ProgressReporter(int percentComplete);

public class Util
{
    public static void HardWork(ProgressReporter p)
    {
        for (int i = 0; i < 10; i++)
        {
            p(i * 10);                           // ูุฑุงุฎูุงู delegate
            System.Threading.Thread.Sleep(100);  // ุดุจูโุณุงุฒ ฺฉุงุฑ ุณูฺฏู
        }
    }
}
```

ุจุฑุง ูุงูุชูุฑ ฺฉุฑุฏู ูุฒุงู ูพุดุฑูุชุ ูโุชูุงูู ฺฉ ูููููโ Multicast Delegate ุจู ูุงู p ุจุณุงุฒู ุชุง ูพุดุฑูุช ููโุฒูุงู ุชูุณุท ุฏู ูุชุฏ ูุณุชูู ุจุฑุฑุณ ุดูุฏ:
```c#
ProgressReporter p = WriteProgressToConsole;
p += WriteProgressToFile;

Util.HardWork(p);

void WriteProgressToConsole(int percentComplete)
    => Console.WriteLine(percentComplete);

void WriteProgressToFile(int percentComplete)
    => System.IO.File.WriteAllText("progress.txt",
                                    percentComplete.ToString());
```

๐ ุฏุฑ ุงูุฌุง ฺู ุงุชูุงู ูโุงูุชุฏุ

1. ุงุจุชุฏุง ฺฉ delegate ุงุฒ ููุน ProgressReporter ุณุงุฎุชู ูโุดูุฏ ู ุจู ูุชุฏ WriteProgressToConsole ุงุดุงุฑู ูโฺฉูุฏ.

2. ุณูพุณ ุจุง ุนููฺฏุฑ +=ุ ูุชุฏ WriteProgressToFile ูู ุจู ุขู ุงุถุงูู ูโุดูุฏ.
ุนู delegate p ุงฺฉููู ฺฉ multicast delegate ุงุณุช.

3. ูุฑ ุจุงุฑ ฺฉู ูุชุฏ HardWork ูพุดุฑูุช ุฑุง ฺฏุฒุงุฑุด ูโุฏูุฏ (p(i * 10))ุ ูุฑ ุฏู ูุชุฏ ุงุฌุฑุง ูโุดููุฏ:

+ WriteProgressToConsole ููุฏุงุฑ ูพุดุฑูุช ุฑุง ุฑู ฺฉูุณูู ฺุงูพ ูโฺฉูุฏ.

+ WriteProgressToFile ููุฏุงุฑ ูพุดุฑูุช ุฑุง ุฏุฑ ฺฉ ูุงู progress.txt ุฐุฎุฑู ูโฺฉูุฏ.

๐ ูุชุฌู ููุง:

+ ุดูุง ููุฒูุงู ุฏุฑ ฺฉูุณูู ูโุจูุฏ ฺฉู ูพุดุฑูุช ฺฉุงุฑ ฺูุฏ ุฏุฑุตุฏ ุงุณุช.

+ ฺฉ ูุงู ูุชู ูู ุฏุงุฑุฏ ฺฉู ููุงู ุงุทูุงุนุงุช ุฑุง ุฐุฎุฑู ูโฺฉูุฏ.

### ุงููุงุน Delegate ุนููู (Generic Delegate Types) โก

ฺฉ delegate ูโุชูุงูุฏ ุดุงูู ูพุงุฑุงูุชุฑูุง ุนููู (Generic Type Parameters) ุจุงุดุฏ:
```c#
public delegate T Transformer<T>(T arg);
```

ุจุง ฺูู ุชุนุฑู ูโุชูุงูู ฺฉ ูุชุฏ ุงุจุฒุงุฑ ุนููู (Utility Method) ุจููุณู ฺฉู ุฑู ูุฑ ููุน ุฏุงุฏูโุง ฺฉุงุฑ ฺฉูุฏ:
```c#
int[] values = { 1, 2, 3 };
Util.Transform(values, Square);      // ุงุชุตุงู ูุชุฏ Square

foreach (int i in values)
    Console.Write(i + "  ");         // ุฎุฑูุฌ: 1   4   9

int Square(int x) => x * x;

public class Util
{
    public static void Transform<T>(T[] values, Transformer<T> t)
    {
        for (int i = 0; i < values.Length; i++)
            values[i] = t(values[i]);
    }
}
```
### Delegates ุขูุงุฏู: Func ู Action โ

ุจุง ูุนุฑู generic delegatesุ ุงู ุงูฺฉุงู ูุฑุงูู ุดุฏ ฺฉู ูุฌููุนูโุง ฺฉูฺฺฉ ุงุฒ delegateูุง ุทุฑุงุญ ุดููุฏ ฺฉู ุขูโูุฏุฑ ุนููู ู ุงูุนุทุงูโูพุฐุฑ ุจุงุดูุฏ ฺฉู ุจุฑุง ูุชุฏูุง ุจุง ูุฑ ููุน ุฎุฑูุฌ ู ูุฑ ุชุนุฏุงุฏ (ูุนููู) ุขุฑฺฏููุงู ูุงุจู ุงุณุชูุงุฏู ุจุงุดูุฏ.

ุงู delegateูุง ููุงู Func ู Action ูุณุชูุฏ ฺฉู ุฏุฑ ูุถุง ูุงู System ุชุนุฑู ุดุฏูโุงูุฏ:
```c#
delegate TResult Func<out TResult>();                
delegate TResult Func<in T, out TResult>(T arg);          
delegate TResult Func<in T1, in T2, out TResult>(T1 arg1, T2 arg2);
// ... ุงุฏุงูู ุฏุงุฑุฏ ุชุง 16 ูพุงุฑุงูุชุฑ

delegate void Action();
delegate void Action<in T>(T arg);
delegate void Action<in T1, in T2>(T1 arg1, T2 arg2);
// ... ุงุฏุงูู ุฏุงุฑุฏ ุชุง 16 ูพุงุฑุงูุชุฑ
```


๐ ุงูโูุง ุจุณุงุฑ ุนููู ู ูุฏุฑุชููุฏ ูุณุชูุฏ.

**ุฌุงฺฏุฒู Transformer ุจุง Func ๐**

ุฏุฑ ูุซุงู ูุจูุ ุจู ุฌุง ุชุนุฑู delegate ุงุฎุชุตุงุต Transformerุ ูโุชูุงูุณุชู ุงุฒ Func ุงุณุชูุงุฏู ฺฉูู:
```c#
public static void Transform<T>(T[] values, Func<T, T> transformer)
{
    for (int i = 0; i < values.Length; i++)
        values[i] = transformer(values[i]);
}
```

ุฏุฑ ุงูุฌุง:

+ Func<T, T> ุนู ฺฉ delegate ฺฉู ฺฉ ูุฑูุฏ ุงุฒ ููุน T ูโฺฏุฑุฏ ู ุฎุฑูุฌ ูู ุงุฒ ููุงู ููุน T ุจุฑูโฺฏุฑุฏุงูุฏ.

+ ุฏููุงู ููุงู ฺุฒ ุงุณุช ฺฉู ูุจูุงู ุจุง Transformer<T> ุณุงุฎุชู ุจูุฏู.

**ูุญุฏูุฏุชโูุง ๐ง**

ุชููุง ุณูุงุฑููุง ุนูู ฺฉู Func ู Action ูพูุดุด ููโุฏููุฏุ ููุงุฑุฏ ูุณุชูุฏ ฺฉู ุดุงูู ูพุงุฑุงูุชุฑูุง ref/out ุง pointer ุจุงุดูุฏ.

**ูฺฉุชู ุชุงุฑุฎ ๐ฐ๏ธ**

ุฒูุงู ฺฉู C# ุจุฑุง ุงููู ุจุงุฑ ูุนุฑู ุดุฏุ ูููุฒ generics ูุฌูุฏ ูุฏุงุดุช. ุจู ููู ุฏููุ Func ู Action ูู ูุฌูุฏ ูุฏุงุดุชูุฏ.
ุจู ููู ุฎุงุทุฑุ ุจุฎุด ุฒุงุฏ ุงุฒ ฺฉุชุงุจุฎุงููโ .NET ุงุฒ delegateูุง ุณูุงุฑุด ุงุณุชูุงุฏู ูโฺฉูุฏุ ูู ุงุฒ Func ู Action.

### ููุงุณู Delegateโูุง ู Interfaceโูุง โ๏ธ

ูุฑ ูุณุฆููโุง ฺฉู ุจุง ฺฉ delegate ุญู ูโุดูุฏุ ูโุชูุงูุฏ ุจุง ฺฉ interface ูู ุญู ุดูุฏ.

ุจูโุนููุงู ูุซุงูุ ูโุชูุงูู ูููููโ ุงูููโูุงู ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ ฺฉ interface ุจู ูุงู ITransformer ุจุงุฒููุณ ฺฉููุ ุจู ุฌุง ุงูฺฉู ุงุฒ delegate ุงุณุชูุงุฏู ฺฉูู:
```c#
int[] values = { 1, 2, 3 };
Util.TransformAll(values, new Squarer());

foreach (int i in values)
    Console.WriteLine(i);

public interface ITransformer
{
    int Transform(int x);
}

public class Util
{
    public static void TransformAll(int[] values, ITransformer t)
    {
        for (int i = 0; i < values.Length; i++)
            values[i] = t.Transform(values[i]);
    }
}

class Squarer : ITransformer
{
    public int Transform(int x) => x * x;
}
```
ฺู ุฒูุงู delegate ุงูุชุฎุงุจ ุจูุชุฑ ุงุฒ interface ุงุณุชุ โ

ุทุฑุงุญ ุจุง delegate ููฺฉู ุงุณุช ุงูุชุฎุงุจ ุจูุชุฑ ุจุงุดุฏ ุงฺฏุฑ ฺฉ ุง ฺูุฏ ููุฑุฏ ุฒุฑ ุจุฑูุฑุงุฑ ุจุงุดูุฏ:

+ ๐น interface ููุท ฺฉ ูุชุฏ ุชุนุฑู ฺฉุฑุฏู ุจุงุดุฏ.

+ ๐น ูุงุฒ ุจู multicast (ุงุชุตุงู ฺูุฏ ูุชุฏ ุจู ฺฉ delegate) ุฏุงุดุชู ุจุงุดู.

+ ๐น ฺฉ subscriber ูุฌุจูุฑ ุจุงุดุฏ ฺูุฏ ุจุงุฑ ฺฉ interface ุฑุง ูพุงุฏูโุณุงุฒ ฺฉูุฏ.

**ุจุฑุฑุณ ูุซุงู ๐**

ุฏุฑ ูุซุงู ITransformer:

+ ูุง ูุงุฒ ุจู multicast ูุฏุงุฑู.

+ ุงูุง interface ููุท ฺฉ ูุชุฏ (Transform) ุชุนุฑู ฺฉุฑุฏู ุงุณุช.

+ ุงุฒ ุทุฑู ููฺฉู ุงุณุช ุจุฎูุงูู ฺูุฏู ุชุจุฏู ูุฎุชูู (ูุซูุงู ูุฑุจุน ุง ูฺฉุนุจ) ุฑุง ูพุงุฏูโุณุงุฒ ฺฉูู.

ุฏุฑ ฺูู ุญุงูุชุ ุงฺฏุฑ ุงุฒ interface ุงุณุชูุงุฏู ฺฉููุ ูุฌุจูุฑ ูโุดูู ุจุฑุง ูุฑ ุชุจุฏู ฺฉ ฺฉูุงุณ ุฌุฏุงฺฏุงูู ุจุณุงุฒูุ ฺูู ฺฉ ฺฉูุงุณ ููุท ฺฉ ุจุงุฑ ูโุชูุงูุฏ ITransformer ุฑุง ูพุงุฏูโุณุงุฒ ฺฉูุฏ. ุงู ฺฉุงุฑ ุฏุณุชโููพุงฺฏุฑ ู ุชฺฉุฑุงุฑ ูโุดูุฏ.

ูุซูุงู:
```c#
int[] values = { 1, 2, 3 };
Util.TransformAll(values, new Cuber());

foreach (int i in values)
    Console.WriteLine(i);

class Squarer : ITransformer
{
    public int Transform(int x) => x * x;
}

class Cuber : ITransformer
{
    public int Transform(int x) => x * x * x;
}
```

๐ ูุชุฌู:

+ ุจุง delegateูุงุ ูพุงุฏูโุณุงุฒ ุณุงุฏูโุชุฑ ู ููุนุทูโุชุฑ ุงุณุช (ูโุชูุงูู ุจูโุฑุงุญุช ูุชุฏูุง ูุฎุชูู ูุซู ูุฑุจุน ุง ูฺฉุนุจ ุฑุง ูพุงุณ ุจุฏูู).

+ ุจุง interfaceูุงุ ูุฌุจูุฑู ุจุฑุง ูุฑ ุนููฺฏุฑ ฺฉ ฺฉูุงุณ ุฌุฏุฏ ุจุณุงุฒู.
  
### ุณุงุฒฺฏุงุฑ Delegate ูุง โ๏ธ

#### ุณุงุฒฺฏุงุฑ ููุน (Type Compatibility) ๐ท๏ธ

ุชูุงู ููุนโูุง delegate ุจุง ูู ูุงุณุงุฒฺฏุงุฑ ูุณุชูุฏุ ุญุช ุงฺฏุฑ ุงูุถุง (signature) ุขูโูุง ฺฉ ุจุงุดุฏ:
```c#
D1 d1 = Method1;
D2 d2 = d1;   // โ ุฎุทุง ุฒูุงู ฺฉุงููพุงู

void Method1() { }

delegate void D1();
delegate void D2();
```

๐น ุงูุง ุงู ุญุงูุช ูุฌุงุฒ ุงุณุช:
```
D2 d2 = new D2(d1);   // โ ุฏุฑุณุช
```
**ููุงุณูโ ุจุฑุงุจุฑ (Equality) โ**

ุฏู ูููููโ delegate ููุช ุจุฑุงุจุฑ ูุญุณูุจ ูโุดููุฏ ฺฉู ุจู ฺฉ ูุชุฏ ฺฉุณุงู ุงุดุงุฑู ฺฉููุฏ:
```c#
D d1 = Method1;
D d2 = Method1;

Console.WriteLine(d1 == d2);   // True

void Method1() { }

delegate void D();
```

๐น ุฏุฑ ููุฑุฏ multicast delegateโูุง ููุ ุจุฑุงุจุฑ ููุช ุจุฑูุฑุงุฑ ุงุณุช ฺฉู ุจู ููุงู ูุชุฏูุง ู ุจู ููุงู ุชุฑุชุจ ุงุดุงุฑู ฺฉููุฏ.

#### ุณุงุฒฺฏุงุฑ ูพุงุฑุงูุชุฑ (Parameter Compatibility) ๐

ููุช ฺฉ ูุชุฏ ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏุ ูโุชูุงูุฏ ุขุฑฺฏููุงู ุจุฏูุฏ ฺฉู ุงุฒ ููุน ุฎุงุตโุชุฑ ุงุฒ ูพุงุฑุงูุชุฑ ูุชุฏ ุจุงุดุฏ. ุงู ุฑูุชุงุฑ ูุนููู polymorphism ุงุณุช.

ุจู ููู ุฏููุ ฺฉ delegate ูู ูโุชูุงูุฏ ูพุงุฑุงูุชุฑูุง ุฎุงุตโุชุฑ ุงุฒ ูุชุฏ ูุฏู ุฎูุฏ ุฏุงุดุชู ุจุงุดุฏ. ุงู ูฺฺฏ ุฑุง contravariance ูโูุงููุฏ.

ูุซุงู:
```c#
StringAction sa = new StringAction(ActOnObject);
sa("hello");

void ActOnObject(object o) => Console.WriteLine(o);   // ุฎุฑูุฌ: hello

delegate void StringAction(string s);
```

๐น ุฏุฑ ุงูุฌุง StringAction ฺฉ ูุชุฏ ุฑุง ุจุง ูพุงุฑุงูุชุฑ string ูุฑุงุฎูุงู ูโฺฉูุฏ.
๐น ุงูุง ูุชุฏ ฺฉู ูุงูุนุง ุงุฌุฑุง ูโุดูุฏ (ActOnObject) ูพุงุฑุงูุชุฑุด ุงุฒ ููุน object ุงุณุช.
๐น ุฏุฑ ุงู ุญุงูุชุ ุขุฑฺฏููุงู string ุจูโุทูุฑ ุฎูุฏฺฉุงุฑ ุชุจุฏู ุจู object (upcast) ูโุดูุฏ.

**3. ุงุฑุชุจุงุท ุจุง ุงูฺฏู ุงุณุชุงูุฏุงุฑุฏ Event ๐ฏ**

ุงูฺฏู ุงุณุชุงูุฏุงุฑุฏ event ุฏุฑ C# ุทูุฑ ุทุฑุงุญ ุดุฏู ุงุณุช ฺฉู ุงุฒ contravariance ุงุณุชูุงุฏู ฺฉูุฏ.

+ ูููโ ฺฉูุงุณโูุง ุฑูุฏุงุฏ ุงุฒ ฺฉูุงุณ ูพุงูโ ูุดุชุฑฺฉ EventArgs ุงุฑุซโุจุฑ ูโฺฉููุฏ.

+ ุจูุงุจุฑุงู ูโุชูุงูุฏ ฺฉ ูุชุฏ ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุชูุณุท ุฏู delegate ูุฎุชูู ูุฑุงุฎูุงู ุดูุฏ:

     + ฺฉ ุฑูุฏุงุฏ MouseEventArgs ูพุงุณ ุจุฏูุฏ ๐ฑ๏ธ

     + ุฏฺฏุฑ KeyEventArgs ูพุงุณ ุจุฏูุฏ โจ๏ธ

ุงู ฺฉุงุฑ ุงูุนุทุงูโูพุฐุฑ ุจุงูุง ุฏุฑ ูุฏุฑุช ุฑูุฏุงุฏูุง ุจู ุดูุง ูโุฏูุฏ.

๐ ุฎูุงุตู:

+ delegate type ูุง ุญุช ุจุง ุงูุถุง ฺฉุณุงู ูู ูุงุณุงุฒฺฏุงุฑ ูุณุชูุฏ.

+ multicast delegateูุง ุจุฑุงุจุฑูุฏ ุงฺฏุฑ ุฏููุง ููุงู ูุชุฏูุง ู ุชุฑุชุจ ุฑุง ุฏุงุดุชู ุจุงุดูุฏ.

+ contravariance ุงุฌุงุฒู ูโุฏูุฏ ูุชุฏ ูุฏูุ ูพุงุฑุงูุชุฑ ุนุงูโุชุฑ ุงุฒ delegate ุฏุงุดุชู ุจุงุดุฏ.

+ event pattern ุงุฒ ููู ูฺฺฏ ุจุฑุง ูพุดุชุจุงู ุงุฒ ุงููุงุน ูุฎุชูู ุฑูุฏุงุฏูุง ุงุณุชูุงุฏู ูโฺฉูุฏ.

#### ุณุงุฒฺฏุงุฑ ููุน ุจุงุฒฺฏุดุช ุฏุฑ Delegateูุง (Return Type Compatibility) ๐

ููุงูโุทูุฑ ฺฉู ููุช ฺฉ ูุชุฏ ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏ ููฺฉู ุงุณุช ููุน ุฎุงุตโุชุฑ ุงุฒ ฺุฒ ฺฉู ุงูุชุธุงุฑ ุฏุงุดุชุฏ ุจุฑฺฏุฑุฏุฏ (ุฑูุชุงุฑ ูุนููู polymorphism)ุ ุฏุฑ ููุฑุฏ delegateโูุง ูู ููู ููุถูุน ุตุงุฏู ุงุณุช.

ุนู ูุชุฏ ูุฏู ฺฉ delegate ูโุชูุงูุฏ ููุน ุจุงุฒฺฏุดุช ุฎุงุตโุชุฑ ุงุฒ ฺุฒ ฺฉู delegate ุชุนุฑู ฺฉุฑุฏู ุฏุงุดุชู ุจุงุดุฏ.
ุงู ูฺฺฏ ุฑุง covariance ูโูุงููุฏ.

ูุซุงู: Covariance ุฏุฑ ููุน ุจุงุฒฺฏุดุช ๐
```c#
ObjectRetriever o = new ObjectRetriever(RetrieveString);
object result = o();
Console.WriteLine(result);   // hello

string RetrieveString() => "hello";

delegate object ObjectRetriever();
```

๐น ุงูุฌุง ObjectRetriever ุงูุชุธุงุฑ ุฏุงุฑุฏ ูุชุฏ ฺฉู ุจู ุขู ูุชุตู ุงุณุชุ ฺฉ object ุจุฑฺฏุฑุฏุงูุฏ.
๐น ุงูุง ุฏุฑ ูุงูุนุชุ ูุชุฏ RetrieveString ฺฉ string ุจุฑูโฺฏุฑุฏุงูุฏ.
๐น ฺูู string ุฒุฑฺฉูุงุณ object ุงุณุชุ ุงู ูุฌุงุฒ ุงุณุช โ.

๐ ูพุณ: ููุน ุจุงุฒฺฏุดุช delegate ูุง covariant ุงุณุช.

#### ูุงุฑุงูุณ ุฏุฑ Delegateูุง ุฌูุฑฺฉ โ๏ธ

ุฏุฑ ูุตู ณ ฺฏูุชู ฺฉู ุงูุชุฑูุณโูุง ุฌูุฑฺฉ ูโุชูุงููุฏ ุงุฒ covariant ู contravariant ุงุณุชูุงุฏู ฺฉููุฏ.
ุงู ูุงุจูุช ุจุฑุง delegateโูุง ุฌูุฑฺฉ ูู ูุฌูุฏ ุฏุงุฑุฏ.

**ููุงูู ุฎูุจ ุจุฑุง ุชุนุฑู delegate ุฌูุฑฺฉ:**

ุงฺฏุฑ ูพุงุฑุงูุชุฑ ููุน (Type Parameter) ููุท ุฏุฑ ุฎุฑูุฌ ุงุณุชูุงุฏู ูโุดูุฏ โ ุจุง out (covariant) ุนูุงูุชโฺฏุฐุงุฑ ุดูุฏ.

ุงฺฏุฑ ูพุงุฑุงูุชุฑ ููุน ููุท ุฏุฑ ูุฑูุฏ ุงุณุชูุงุฏู ูโุดูุฏ โ ุจุง in (contravariant) ุนูุงูุชโฺฏุฐุงุฑ ุดูุฏ.

**ูุซุงู ฑ: Covariance ุฏุฑ ุฌูุฑฺฉโูุง (ุจุง Func) ๐ค**

ุฏุฑ ูุถุง ูุงู System ุฏุงุฑู:
```c#
delegate TResult Func<out TResult>();
```

ุงู ุจุงุนุซ ูโุดูุฏ ุจุชูุงูู ุจููุณู:
```c#
Func<string> x = () => "Hello!";
Func<object> y = x;   // โ ูุฌุงุฒ ุจู ุฎุงุทุฑ covariance
```

๐น ุนู ูโุชูุงูู Func<string> ุฑุง ุจู Func<object> ุชุจุฏู ฺฉูู ฺูู string ุฒุฑฺฉูุงุณ object ุงุณุช.

**ูุซุงู ฒ: Contravariance ุฏุฑ ุฌูุฑฺฉโูุง (ุจุง Action) ๐ฅ**

ุจุงุฒ ูู ุฏุฑ ูุถุง ูุงู System:
```c#
delegate void Action<in T>(T arg);
```

ุงู ุจุงุนุซ ูโุดูุฏ:
```c#
Action<object> x = obj => Console.WriteLine(obj);
Action<string> y = x;   // โ ูุฌุงุฒ ุจู ุฎุงุทุฑ contravariance
```

๐น ุนู ูโุชูุงูู Action<object> ุฑุง ุจู Action<string> ุชุจุฏู ฺฉูู ฺูู ูุชุฏ ฺฉู ุงูุชุธุงุฑ ุฏุฑุงูุช object ุฏุงุฑุฏุ ูโุชูุงูุฏ string ูู ุจฺฏุฑุฏ.

๐ ุฎูุงุตู:

+ ููุน ุจุงุฒฺฏุดุช delegate ูโุชูุงูุฏ ุฎุงุตโุชุฑ ุงุฒ ููุน ุชุนุฑูโุดุฏู ุจุงุดุฏ โ ุงู covariance ุงุณุช.

+ ุฏุฑ delegate ุฌูุฑฺฉ:

     + ููุน ุฎุฑูุฌ (out) โ covariant ๐ค

     + ููุน ูุฑูุฏ (in) โ contravariant ๐ฅ

ุงู ุจุงุนุซ ูโุดูุฏ ุชุจุฏูโูุง ุจู delegateูุง ุจูโุตูุฑุช ุทุจุน ู ุจุฑ ุงุณุงุณ ุงุฑุซโุจุฑ ุงูุฌุงู ุดููุฏ.
### ุฑูุฏุงุฏูุง (Events)

ููฺฏุงู ุงุณุชูุงุฏู ุงุฒ **delegates**ุ ุฏู ููุด ูุนูููุงู ุธุงูุฑ ูโุดููุฏ: **broadcaster** ู **subscriber**.

* **Broadcaster** ููุน ุงุณุช ฺฉู ุฏุงุฑุง ฺฉ ููุฏ delegate ูโุจุงุดุฏ. ุงู ููุน ุชุตูู ูโฺฏุฑุฏ ฺฉู ฺู ุฒูุงู ูพุงู ุฑุง ูพุฎุด ฺฉูุฏุ ุจุง **invoke** ฺฉุฑุฏู delegate.
* **Subscribers** ุฏุฑุงูุชโฺฉููุฏฺฏุงู ูุฏู ูุชุฏ ูุณุชูุฏ. ฺฉ subscriber ุชุตูู ูโฺฏุฑุฏ ฺู ุฒูุงู ุดุฑูุน ุจู ฺฏูุด ุฏุงุฏู ฺฉูุฏ ู ฺู ุฒูุงู ุขู ุฑุง ูุชููู ฺฉูุฏุ ุจุง ุงุณุชูุงุฏู ุงุฒ ุนููฺฏุฑูุง `+=` ู `-=` ุฑู delegate ูุฑุจูุท ุจู broadcaster. ฺฉ subscriber ุฏุฑุจุงุฑู ุฏฺฏุฑ subscribers ุงุทูุงุน ูุฏุงุฑุฏ ู ุฏุฑ ุนููฺฉุฑุฏ ุขูโูุง ุฏุฎุงูุช ููโฺฉูุฏ.

### ุฑูุฏุงุฏูุง ุฏุฑ C# ูพุดุฑูุชู โก

ุฑูุฏุงุฏูุง ฺฉ ูฺฺฏ ุฒุจุงู ูุณุชูุฏ ฺฉู ุงู ุงูฺฏู ุฑุง ุฑุณู ูโฺฉููุฏ. ฺฉ **event** ฺฉ ุณุงุฎุชุงุฑ ุงุณุช ฺฉู ุชููุง ุฒุฑูุฌููุนูโุง ุงุฒ ูุงุจูุชโูุง delegate ุฑุง ฺฉู ุจุฑุง ูุฏู **broadcaster/subscriber** ูุงุฒู ุงุณุชุ ุฏุฑ ูุนุฑุถ ูุฑุงุฑ ูโุฏูุฏ. ูุฏู ุงุตู ุฑูุฏุงุฏูุง ุฌููฺฏุฑ ุงุฒ ุฏุฎุงูุช subscribers ุฏุฑ ุนููฺฉุฑุฏ ฺฉุฏฺฏุฑ ุงุณุช.

ุณุงุฏูโุชุฑู ุฑูุด ุจุฑุง ุชุนุฑู ฺฉ ุฑูุฏุงุฏุ ุงุณุชูุงุฏู ุงุฒ ฺฉูุฏูุงฺู **event** ูุจู ุงุฒ ฺฉ ุนุถู delegate ุงุณุช:

```csharp
// ุชุนุฑู delegate
public delegate void PriceChangedHandler(decimal oldPrice, decimal newPrice);

public class Broadcaster
{
    // ุชุนุฑู ุฑูุฏุงุฏ
    public event PriceChangedHandler PriceChanged;
}
```

ฺฉุฏ ฺฉู ุฏุงุฎู ููุน **Broadcaster** ูุฑุงุฑ ุฏุงุฑุฏุ ุฏุณุชุฑุณ ฺฉุงูู ุจู **PriceChanged** ุฏุงุฑุฏ ู ูโุชูุงูุฏ ุขู ุฑุง ูุงููุฏ ฺฉ delegate ูุนููู ูุฏุฑุช ฺฉูุฏ. ฺฉุฏูุง ุฎุงุฑุฌ ุงุฒ **Broadcaster** ุชููุง ูโุชูุงููุฏ ุนููุงุช `+=` ู `-=` ุฑุง ุฑู ุฑูุฏุงุฏ **PriceChanged** ุงูุฌุงู ุฏููุฏ.

โ ุงุฏุงููโ ูุชู ุฑุง ุงุฑุณุงู ฺฉูุฏ ุชุง ุชุฑุฌูู ุจุนุฏ ุฑุง ุขูุงุฏู ฺฉูู.


### ฺฺฏููู ุฑูุฏุงุฏูุง ุฏุฑ ุฏุฑูู ฺฉุงุฑ ูโฺฉููุฏุ ๐

ููุช ฺฉ ุฑูุฏุงุฏ ุจู ุดฺฉู ุฒุฑ ุชุนุฑู ูโฺฉูุฏ:

```csharp
public class Broadcaster
{
    public event PriceChangedHandler PriceChanged;
}
```

ุณู ุงุชูุงู ุฏุฑ ูพุดุช ุตุญูู ุฑุฎ ูโุฏูุฏ:

1๏ธโฃ ุงุจุชุฏุงุ **ฺฉุงููพุงูุฑ** ุชุนุฑู ุฑูุฏุงุฏ ุฑุง ุจู ฺุฒ ุดุจู ุจู ฺฉุฏ ุฒุฑ ุชุฑุฌูู ูโฺฉูุฏ:

```csharp
PriceChangedHandler priceChanged;   // delegate ุฎุตูุต

public event PriceChangedHandler PriceChanged
{
    add    { priceChanged += value; }
    remove { priceChanged -= value; }
}
```

ฺฉูุฏูุงฺูโูุง **add** ู **remove** ูุดุงูโุฏููุฏู **accessorูุง ุฑูุฏุงุฏ ุตุฑุญ** ูุณุชูุฏโฺฉู ุนููฺฉุฑุฏ ุดุจู ุจู **accessorูุง property** ุฏุงุฑูุฏ. ุจุนุฏุงู ุฏุฑุจุงุฑู ูุญูู ููุดุชู ุงูโูุง ุชูุถุญ ุฎูุงูู ุฏุงุฏ.

2๏ธโฃ ุฏููุ ฺฉุงููพุงูุฑ ุฏุงุฎู ฺฉูุงุณ **Broadcaster** ุจู ุฏูุจุงู ุงุฑุฌุงุนุงุช ุจู **PriceChanged** ูโฺฏุฑุฏุฏ ฺฉู ุนููุงุช ุฏฺฏุฑ ุบุฑ ุงุฒ `+=` ุง `-=` ุงูุฌุงู ูโุฏููุฏ ู ุขูโูุง ุฑุง ุจู ููุฏ delegate ุฒุฑู ุนู **priceChanged** ูุฏุงุช ูโฺฉูุฏ.

3๏ธโฃ ุณููุ ฺฉุงููพุงูุฑ ุนููุงุช `+=` ู `-=` ุฑู ุฑูุฏุงุฏ ุฑุง ุจู ูุฑุงุฎูุงู **add** ู **remove** accessorูุง ุฑูุฏุงุฏ ุชุฑุฌูู ูโฺฉูุฏ. ุฌุงูุจ ุงุณุช ุจุฏุงูุฏ ฺฉู ุงู ฺฉุงุฑ ุจุงุนุซ ูโุดูุฏ ุฑูุชุงุฑ `+=` ู `-=` ููุช ุฑู ุฑูุฏุงุฏูุง ุงุนูุงู ูโุดููุฏุ ููุญุตุฑุจูโูุฑุฏ ุจุงุดุฏ: ุจุฑุฎูุงู ุณุงุฑ ุณูุงุฑููุงุ ุงูโูุง ุชููุง ฺฉ ูุงูุจุฑ ุจุฑุง `+` ู `-` ุจู ููุฑุงู ุงูุชุณุงุจ ูุณุชูุฏ.

ูุซุงู ุฑุง ุฏุฑ ูุธุฑ ุจฺฏุฑุฏ ๐

ฺฉูุงุณ **Stock** ุฑูุฏุงุฏ **PriceChanged** ุฎูุฏ ุฑุง ูุฑ ุจุงุฑ ฺฉู ููุช ุณูุงู ุชุบุฑ ูโฺฉูุฏุ ูุนุงู ูโฺฉูุฏ:

```csharp
public delegate void PriceChangedHandler(decimal oldPrice, decimal newPrice);

public class Stock
{
    string symbol;
    decimal price;
    public Stock(string symbol) => this.symbol = symbol;
    public event PriceChangedHandler PriceChanged;
    public decimal Price
    {
        get => price;
        set
        {
            if (price == value) return;   // ุฎุฑูุฌ ุงฺฏุฑ ฺุฒ ุชุบุฑ ูฺฉุฑุฏู
            decimal oldPrice = price;
            price = value;
            if (PriceChanged != null)      // ุงฺฏุฑ ูุณุช ูุฑุงุฎูุงู ุฎุงู ูุณุช
                PriceChanged(oldPrice, price); // ุฑูุฏุงุฏ ูุนุงู ุดูุฏ
        }
    }
}
```

ุงฺฏุฑ ฺฉูุฏูุงฺู **event** ุฑุง ุญุฐู ฺฉูู ู **PriceChanged** ุจู ฺฉ ููุฏ ูุนููู delegate ุชุจุฏู ุดูุฏุ ุจุงุฒ ูู ูุซุงู ูุง ููุงู ูุชุงุฌ ุฑุง ุฎูุงูุฏ ุฏุงุฏ. ุงูุง ฺฉูุงุณ **Stock** ฺฉูุชุฑ ููุงูู ุฎูุงูุฏ ุจูุฏุ ุฒุฑุง subscribers ูโุชูุงููุฏ ุจุง ฺฉุฏฺฏุฑ ุชุฏุงุฎู ุงุฌุงุฏ ฺฉููุฏุ ูุซูุงู:

* ุฌุงฺฏุฒู ฺฉุฑุฏู ุฏฺฏุฑ subscribers ุจุง ุงูุชุณุงุจ ูุฌุฏุฏ **PriceChanged** ุจู ุฌุง ุงุณุชูุงุฏู ุงุฒ ุนููฺฏุฑ `+=`.
* ูพุงฺฉ ฺฉุฑุฏู ุชูุงู subscribers ุจุง ุงูุชุณุงุจ **PriceChanged** ุจู `null`.
* ุงุฑุณุงู ูพุงู ุจู subscribers ุฏฺฏุฑ ุจุง invoke ฺฉุฑุฏู delegate.

### ุงูฺฏู ุงุณุชุงูุฏุงุฑุฏ ุฑูุฏุงุฏูุง ๐๏ธ

ุฏุฑ ุชูุฑุจุงู ููู ููุงุฑุฏ ฺฉู ุฑูุฏุงุฏูุง ุฏุฑ ฺฉุชุงุจุฎุงููโูุง .NET ุชุนุฑู ูโุดููุฏุ ุชุนุฑู ุขูโูุง ูุทุงุจู ฺฉ ุงูฺฏู ุงุณุชุงูุฏุงุฑุฏ ุงุณุช ุชุง ฺฉูพุงุฑฺฺฏ ุจู ฺฉุฏูุง ฺฉุชุงุจุฎุงูู ู ฺฉุงุฑุจุฑ ุญูุธ ุดูุฏ. ุฏุฑ ูุฑฺฉุฒ ุงู ุงูฺฏูุ ฺฉูุงุณ **System.EventArgs** ูุฑุงุฑ ุฏุงุฑุฏุ ฺฉ ฺฉูุงุณ ุงุฒ ูพุด ุชุนุฑูโุดุฏู ุฏุฑ .NET ฺฉู ูฺ ุนุถู ูุฏุงุฑุฏ (ุจู ุฌุฒ ููุฏ ุงุณุชุงุชฺฉ **Empty**). **EventArgs** ฺฉูุงุณ ูพุงูโุง ุจุฑุง ุงูุชูุงู ุงุทูุงุนุงุช ูุฑุจูุท ุจู ฺฉ ุฑูุฏุงุฏ ุงุณุช.

ุฏุฑ ูุซุงู Stock ูุงุ ุจุฑุง ุงูุชูุงู ููุช ูุฏู ู ุฌุฏุฏ ููฺฏุงู ูุนุงู ุดุฏู ุฑูุฏุงุฏ **PriceChanged**ุ ฺฉูุงุณ EventArgs ุฑุง ุจู ุตูุฑุช ุฒุฑ subclass ูโฺฉูู:

```csharp
public class PriceChangedEventArgs : System.EventArgs
{
    public readonly decimal LastPrice;
    public readonly decimal NewPrice;

    public PriceChangedEventArgs(decimal lastPrice, decimal newPrice)
    {
        LastPrice = lastPrice;
        NewPrice = newPrice;
    }
}
```

ุจุฑุง ุงุณุชูุงุฏู ูุฌุฏุฏุ subclass EventArgs ูุนูููุงู ุจุฑ ุงุณุงุณ ุงุทูุงุนุงุช ฺฉู ุดุงูู ูโุดูุฏ ูุงูฺฏุฐุงุฑ ูโุดูุฏุ ูู ุจุฑ ุงุณุงุณ ุฑูุฏุงุฏ ฺฉู ุจุฑุง ุขู ุงุณุชูุงุฏู ูโุดูุฏ. ุฏุงุฏูโูุง ูุนูููุงู ุจู ุตูุฑุช property ุง ููุฏ ููุทโุฎูุงูุฏู ุงุฑุงุฆู ูโุดููุฏ.

### ุงูุชุฎุงุจ ุง ุชุนุฑู delegate ุจุฑุง ุฑูุฏุงุฏ ๐ฏ

ุณู ูุงุนุฏู ูุฌูุฏ ุฏุงุฑุฏ:

1๏ธโฃ ููุน ุจุงุฒฺฏุดุช ุจุงุฏ **void** ุจุงุดุฏ.
2๏ธโฃ ุฏู ุขุฑฺฏููุงู ุฏุฑุงูุช ฺฉูุฏ: ุขุฑฺฏููุงู ุงูู ุงุฒ ููุน **object** ู ุขุฑฺฏููุงู ุฏูู ฺฉ subclass ุงุฒ **EventArgs**. ุขุฑฺฏููุงู ุงูู ูุดุงูโุฏููุฏู broadcaster ู ุขุฑฺฏููุงู ุฏูู ุดุงูู ุงุทูุงุนุงุช ุงุถุงู ุจุฑุง ุงูุชูุงู ุงุณุช.
3๏ธโฃ ูุงู delegate ุจุงุฏ ุจุง **EventHandler** ูพุงุงู ุงุจุฏ.

.NET ฺฉ delegate ุนููู ุจู ูุงู **System.EventHandler<>** ุจุฑุง ฺฉูฺฉ ุจู ุงู ฺฉุงุฑ ุชุนุฑู ฺฉุฑุฏู ุงุณุช:

```csharp
public delegate void EventHandler<TEventArgs>(object source, TEventArgs e);
```

ูุจู ุงุฒ ูุฌูุฏ genericูุง ุฏุฑ ุฒุจุงู (ูุจู ุงุฒ C# 2.0)ุ ุจุงุฏ delegate ุณูุงุฑุด ุฑุง ุจู ุตูุฑุช ุฒุฑ ูโููุดุชู:

```csharp
public delegate void PriceChangedHandler(object sender, PriceChangedEventArgs e);
```

ุจู ุฏูุงู ุชุงุฑุฎุ ุจุดุชุฑ ุฑูุฏุงุฏูุง ุฏุฑ ฺฉุชุงุจุฎุงููโูุง .NET ุงุฒ ุงู ุฑูุด ุงุณุชูุงุฏู ูโฺฉููุฏ.

### ุชุนุฑู ุฑูุฏุงุฏ ุจุง delegate ุงูุชุฎุงุจโุดุฏู ๐ง

```csharp
public class Stock
{
    ...
    public event EventHandler<PriceChangedEventArgs> PriceChanged;
}
```

### ููุดุชู ูุชุฏ ูุญุงูุธุชโุดุฏู ู virtual ุจุฑุง ูุนุงู ฺฉุฑุฏู ุฑูุฏุงุฏ

ูุงู ุงู ูุชุฏ ุจุงุฏ ููุงู ูุงู ุฑูุฏุงุฏ ุจุงุดุฏุ ุจุง ูพุดููุฏ **On**ุ ู ฺฉ ุขุฑฺฏููุงู **EventArgs** ุฏุฑุงูุช ฺฉูุฏ:

```csharp
public class Stock
{
    ...
    public event EventHandler<PriceChangedEventArgs> PriceChanged;

    protected virtual void OnPriceChanged(PriceChangedEventArgs e)
    {
        if (PriceChanged != null) PriceChanged(this, e);
    }
}
```

ุจุฑุง ุนููฺฉุฑุฏ ููุงูู ุฏุฑ ุณูุงุฑููุง ฺูุฏูุฎ (multithreaded)ุ ุจูุชุฑ ุงุณุช delegate ุฑุง ูุจู ุงุฒ ุชุณุช ู ูุฑุงุฎูุงู ุจู ฺฉ ูุชุบุฑ ูููุช ุงูุชุณุงุจ ุฏูุฏ:

```csharp
var temp = PriceChanged;
if (temp != null) temp(this, e);
```

ููฺูู ูโุชูุงู ุจุง ุงุณุชูุงุฏู ุงุฒ **null-conditional operator** ููุงู ฺฉุงุฑ ุฑุง ุจุฏูู ูุชุบุฑ ูููุช ุงูุฌุงู ุฏุงุฏ:

```csharp
PriceChanged?.Invoke(this, e);
```

ุงู ุฑูุด ูู **thread-safe** ู ูู ูุฎุชุตุฑ ุงุณุช ู ุจูุชุฑู ุฑูุด ุนููู ุจุฑุง ูุฑุงุฎูุงู ุฑูุฏุงุฏูุง ูุญุณูุจ ูโุดูุฏ.

### ูุซุงู ฺฉุงูู ๐ป

```csharp
using System;

Stock stock = new Stock("THPW");
stock.Price = 27.10M;

// ุซุจุช ุจุฑุง ุฑูุฏุงุฏ PriceChanged
stock.PriceChanged += stock_PriceChanged;
stock.Price = 31.59M;

void stock_PriceChanged(object sender, PriceChangedEventArgs e)
{
    if ((e.NewPrice - e.LastPrice) / e.LastPrice > 0.1M)
        Console.WriteLine("Alert, 10% stock price increase!");
}

public class PriceChangedEventArgs : EventArgs
{
    public readonly decimal LastPrice;
    public readonly decimal NewPrice;

    public PriceChangedEventArgs(decimal lastPrice, decimal newPrice)
    {
        LastPrice = lastPrice; NewPrice = newPrice;
    }
}

public class Stock
{
    string symbol;
    decimal price;
    public Stock(string symbol) => this.symbol = symbol;
    public event EventHandler<PriceChangedEventArgs> PriceChanged;

    protected virtual void OnPriceChanged(PriceChangedEventArgs e)
    {
        PriceChanged?.Invoke(this, e);
    }

    public decimal Price
    {
        get => price;
        set
        {
            if (price == value) return;
            decimal oldPrice = price;
            price = value;
            OnPriceChanged(new PriceChangedEventArgs(oldPrice, price));
        }
    }
}
```

### ุงุณุชูุงุฏู ุงุฒ EventHandler ุบุฑ ุนููู

ููุช ุฑูุฏุงุฏ ูุงุฒ ุจู ุงูุชูุงู ุงุทูุงุนุงุช ุงุถุงู ูุฏุงุฑุฏุ ูโุชูุงู ุงุฒ **EventHandler** ุบุฑ generic ุงุณุชูุงุฏู ฺฉุฑุฏ. ุฏุฑ ุงู ูุซุงูุ ฺฉูุงุณ **Stock** ุจุงุฒููุณ ุดุฏู ุชุง ุฑูุฏุงุฏ **PriceChanged** ูพุณ ุงุฒ ุชุบุฑ ููุช ูุนุงู ุดูุฏ ู ุชููุง ูุงุฒ ุงุณุช ุจุฏุงูู ุฑูุฏุงุฏ ุฑุฎ ุฏุงุฏู ุงุณุชุ ุจุฏูู ูุงุฒ ุจู ุงุทูุงุนุงุช ุงุถุงู. ููฺูู ุงุฒ **EventArgs.Empty** ุงุณุชูุงุฏู ูโฺฉูู ุชุง ุงุฒ ุงุฌุงุฏ ุบุฑุถุฑูุฑ ฺฉ ููููู EventArgs ุฌููฺฏุฑ ุดูุฏ:

```csharp
public class Stock
{
    string symbol;
    decimal price;

    public Stock(string symbol) { this.symbol = symbol; }
    public event EventHandler PriceChanged;

    protected virtual void OnPriceChanged(EventArgs e)
    {
        PriceChanged?.Invoke(this, e);
    }

    public decimal Price
    {
        get { return price; }
        set
        {
            if (price == value) return;
            price = value;
            OnPriceChanged(EventArgs.Empty);
        }
    }
}
```

**Accessorูุง ุฑูุฏุงุฏูุง ๐**

Accessorูุง ฺฉ ุฑูุฏุงุฏุ ูพุงุฏูโุณุงุฒโูุง ุนููฺฏุฑูุง `+=` ู `-=` ุขู ูุณุชูุฏ. ุจู ุทูุฑ ูพุดโูุฑุถุ ุงู accessors ุจู ุตูุฑุช ุถูู ุชูุณุท ฺฉุงููพุงูุฑ ูพุงุฏูโุณุงุฒ ูโุดููุฏ. ุจู ูุซุงู ุฒุฑ ุชูุฌู ฺฉูุฏ:

```csharp
public event EventHandler PriceChanged;
```

ฺฉุงููพุงูุฑ ุงู ุฑุง ุจู ุดฺฉู ุฒุฑ ุชุจุฏู ูโฺฉูุฏ:

* ฺฉ ููุฏ delegate ุฎุตูุต
* ฺฉ ุฌูุช ุชุงุจุน accessor ุนููู ุจุฑุง ุฑูุฏุงุฏ (**add\_PriceChanged** ู **remove\_PriceChanged**) ฺฉู ุนููุงุช `+=` ู `-=` ุฑุง ุจู ููุฏ delegate ุฎุตูุต ูุฏุงุช ูโฺฉููุฏ

ุดูุง ูโุชูุงูุฏ ุงู ุฑููุฏ ุฑุง ุจุง ุชุนุฑู **explicit event accessors** ุจู ุฏุณุช ุจฺฏุฑุฏ. ุฏุฑ ุงูุฌุง ูพุงุฏูโุณุงุฒ ุฏุณุช ุฑูุฏุงุฏ **PriceChanged** ุงุฒ ูุซุงู ูุจู ุขูุฏู ุงุณุช:

```csharp
private EventHandler priceChanged;   // ุชุนุฑู ฺฉ delegate ุฎุตูุต
public event EventHandler PriceChanged
{
    add    { priceChanged += value; }
    remove { priceChanged -= value; }
}
```

ุงู ูุซุงู ุงุฒ ูุธุฑ ุนููฺฉุฑุฏ ุจุง ูพุงุฏูโุณุงุฒ ูพุดโูุฑุถ C# ฺฉุณุงู ุงุณุช (ุจู ุฌุฒ ุงูฺฉู C# ููฺูู ุงูู ุฏุฑ ุจุฑุงุจุฑ ฺูุฏูุฎ ุฑุง ุจุง ุงูฺฏูุฑุชู lock-free compare-and-swap ุชุถูู ูโฺฉูุฏ). ุจุง ุชุนุฑู ุฏุณุช accessorsุ ุจู C# ูโฺฏูู ฺฉู ููุทู ูพุดโูุฑุถ ููุฏ ู accessor ุฑุง ุชููุฏ ูฺฉูุฏ.

ุจุง ุงุณุชูุงุฏู ุงุฒ explicit event accessorsุ ูโุชูุงู ุงุณุชุฑุงุชฺโูุง ูพฺุฏูโุชุฑ ุจุฑุง ุฐุฎุฑู ู ุฏุณุชุฑุณ ุจู delegate ุฒุฑู ุงุนูุงู ฺฉุฑุฏ. ุณู ุณูุงุฑู ฺฉู ุงู ฺฉุงุฑุจุฑุฏ ุฏุงุฑุฏ:

1๏ธโฃ ููุช accessors ุชููุง ุจู ุนููุงู ูุงุณุทู ุจุฑุง ฺฉูุงุณ ุฏฺฏุฑ ูุณุชูุฏ ฺฉู ุฑูุฏุงุฏ ุฑุง ูพุฎุด ูโฺฉูุฏ.
2๏ธโฃ ููุช ฺฉูุงุณ ุชุนุฏุงุฏ ุฒุงุฏ ุฑูุฏุงุฏ ุฏุงุฑุฏ ุงูุง ุงุบูุจ ุชููุง ุชุนุฏุงุฏ ฺฉู subscriber ูุฌูุฏ ุฏุงุฑุฏุ ูุซู ฺฉูุชุฑูโูุง ููุฏูุฒ. ุฏุฑ ุงู ููุงุฑุฏ ุจูุชุฑ ุงุณุช delegateูุง subscribers ุฑุง ุฏุฑ ฺฉ **dictionary** ุฐุฎุฑู ฺฉููุ ุฒุฑุง dictionary ุญุงูุธู ฺฉูุชุฑ ูุณุจุช ุจู ุฏูโูุง ููุฏ delegate ุฎุงู ูุตุฑู ูโฺฉูุฏ.
3๏ธโฃ ููฺฏุงู ูพุงุฏูโุณุงุฒ explicit ฺฉ interface ฺฉู ุฑูุฏุงุฏ ุฑุง ุชุนุฑู ฺฉุฑุฏู ุงุณุช.

ูููููโุง ุจุฑุง ููุฑุฏ ุณูู:

```csharp
public interface IFoo { event EventHandler Ev; }

class Foo : IFoo
{
    private EventHandler ev;
    event EventHandler IFoo.Ev
    {
        add    { ev += value; }
        remove { ev -= value; }
    }
}
```

ุจุฎุดโูุง **add** ู **remove** ฺฉ ุฑูุฏุงุฏ ุจู ูุชุฏูุง **add\_XXX** ู **remove\_XXX** ฺฉุงููพุงู ูโุดููุฏ.

---

**Modifierูุง ุฑูุฏุงุฏูุง โก**

ูุซู ูุชุฏูุงุ ุฑูุฏุงุฏูุง ูโุชูุงููุฏ **virtual**ุ **overridden**ุ **abstract** ุง **sealed** ุจุงุดูุฏ. ููฺูู ูโุชูุงููุฏ **static** ุจุงุดูุฏ:

```csharp
public class Foo
{
    public static event EventHandler<EventArgs> StaticEvent;
    public virtual event EventHandler<EventArgs> VirtualEvent;
}
```

---

**Lambda Expressions ฮป**

ฺฉ **lambda expression** ูุชุฏ ุจุฏูู ูุงู ุงุณุช ฺฉู ุจู ุฌุง ฺฉ instance delegate ููุดุชู ูโุดูุฏ. ฺฉุงููพุงูุฑ ุจูุงูุงุตูู ุขู ุฑุง ุจู ฺฉ ุงุฒ ููุงุฑุฏ ุฒุฑ ุชุจุฏู ูโฺฉูุฏ:

* ฺฉ instance delegate
* ุง ฺฉ **expression tree** ุงุฒ ููุน `Expression<TDelegate>` ฺฉู ฺฉุฏ ุฏุงุฎู lambda ุฑุง ุจู ุตูุฑุช ฺฉ ูุฏู ุดุก ูุงุจู ูพูุงุด ููุงุด ูโุฏูุฏ. ุงู ุงุฌุงุฒู ูโุฏูุฏ lambda ุจุนุฏุงู ุฏุฑ ุฒูุงู ุงุฌุฑุง ุชูุณุฑ ุดูุฏ.

ูุซุงู:

```csharp
Transformer sqr = x => x * x;
Console.WriteLine(sqr(3));   // ุฎุฑูุฌ: 9
delegate int Transformer(int i);
```

ฺฉุงููพุงูุฑ lambdaูุง ุงู ููุน ุฑุง ุจุง ููุดุชู ฺฉ ูุชุฏ ุฎุตูุต ู ุงูุชูุงู ฺฉุฏ expression ุจู ุขู ูุชุฏ ุญู ูโฺฉูุฏ.

ูุฑู ฺฉู ฺฉ lambda:

```
(parameters) => expression-or-statement-block
```

ุงฺฏุฑ ููุท ฺฉ ูพุงุฑุงูุชุฑ ุจุง ููุน ูุงุจู ุงุณุชูุชุงุฌ ุฏุงุดุชู ุจุงุดูุ ูโุชูุงู ูพุฑุงูุชุฒูุง ุฑุง ุญุฐู ฺฉุฑุฏ.

ูุซุงู:

```csharp
x => x * x;
```

ูุฑ ูพุงุฑุงูุชุฑ lambda ูุชูุงุธุฑ ุจุง ูพุงุฑุงูุชุฑ delegate ุงุณุช ู ููุน expression (ฺฉู ููฺฉู ุงุณุช **void** ุจุงุดุฏ) ูุชูุงุธุฑ ุจุง ููุน ุจุงุฒฺฏุดุช delegate ุงุณุช.

ูโุชูุงู expression ุฑุง ุจู ุตูุฑุช ฺฉ ุจููฺฉ statement ูุฒ ููุดุช:

```csharp
x => { return x * x; };
```

ุงุบูุจ lambdaูุง ููุฑุงู ุจุง **Func** ู **Action** ุงุณุชูุงุฏู ูโุดููุฏ:

```csharp
Func<int,int> sqr = x => x * x;
```

ูุซุงู ุจุง ุฏู ูพุงุฑุงูุชุฑ:

```csharp
Func<string,string,int> totalLength = (s1, s2) => s1.Length + s2.Length;
int total = totalLength("hello", "world");   // total = 10
```

ุงฺฏุฑ ูุงุฒ ุจู ุงุณุชูุงุฏู ุงุฒ ูพุงุฑุงูุชุฑูุง ูุณุชุ ูโุชูุงู ุขูโูุง ุฑุง ุจุง underscore ุฏูุฑ ุงูุฏุงุฎุช (ุงุฒ C# 9):

```csharp
Func<string,string,int> totalLength = (_,_) => ...
```

ูุซุงู ุจุฏูู ุขุฑฺฏููุงู:

```csharp
Func<string> greeter = () => "Hello, world";
```

ุงุฒ C# 10 ุจู ุจุนุฏุ ูโุชูุงู ุงุฒ **implicit typing** ุจุฑุง lambda ุงุณุชูุงุฏู ฺฉุฑุฏ:

```csharp
var greeter = () => "Hello, world";
```

### ูุดุฎุต ฺฉุฑุฏู ุตุฑุญ ููุน ูพุงุฑุงูุชุฑ ู ููุน ุจุงุฒฺฏุดุช Lambda ๐ง

ฺฉุงููพุงูุฑ ูุนูููุงู ูโุชูุงูุฏ ููุน ูพุงุฑุงูุชุฑูุง lambda ุฑุง ุจู ุตูุฑุช ุฒูููโุง ุงุณุชูุชุงุฌ ฺฉูุฏ. ููุช ุงู ุงูฺฉุงู ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏุ ุจุงุฏ ููุน ูุฑ ูพุงุฑุงูุชุฑ ุฑุง ุจู ุตูุฑุช ุตุฑุญ ูุดุฎุต ฺฉูุฏ. ุจู ุฏู ูุชุฏ ุฒุฑ ุชูุฌู ฺฉูุฏ:

```csharp
void Foo<T>(T x) { }
void Bar<T>(Action<T> a) { }
```

ฺฉุฏ ุฒุฑ **ฺฉุงููพุงู ููโุดูุฏ**ุ ุฒุฑุง ฺฉุงููพุงูุฑ ููโุชูุงูุฏ ููุน `x` ุฑุง ุงุณุชูุชุงุฌ ฺฉูุฏ:

```csharp
Bar(x => Foo(x));   // ููุน x ฺุณุชุ
```

ูโุชูุงู ุจุง ูุดุฎุต ฺฉุฑุฏู ุตุฑุญ ููุน `x` ูุดฺฉู ุฑุง ุญู ฺฉุฑุฏ:

```csharp
Bar((int x) => Foo(x));
```

ุงู ูุซุงู ุณุงุฏู ุฑุง ูโุชูุงู ุจู ุฏู ุฑูุด ุฏฺฏุฑ ูุฒ ุงุตูุงุญ ฺฉุฑุฏ:

```csharp
Bar<int>(x => Foo(x));  // ูุดุฎุต ฺฉุฑุฏู type parameter ุจุฑุง Bar
Bar<int>(Foo);          // ููุงููุฏ ุจุงูุงุ ุจุง ุงุณุชูุงุฏู ุงุฒ method group
```

ูุซุงู ุฏฺฏุฑ ุงุฒ ุงุณุชูุงุฏู explicit ุจุฑุง ููุน ูพุงุฑุงูุชุฑ (C# 10):

```csharp
var sqr = (int x) => x * x;
```

ฺฉุงููพุงูุฑ `sqr` ุฑุง ุจู ููุน `Func<int,int>` ุงุณุชูุชุงุฌ ูโฺฉูุฏ. ุจุฏูู ูุดุฎุต ฺฉุฑุฏู `int`ุ ุงุณุชูุชุงุฌ ููุน ุดฺฉุณุช ูโุฎูุฑุฏ: ฺฉุงููพุงูุฑ ูโุฏุงูุฏ ฺฉู sqr ุจุงุฏ ุงุฒ ููุน `Func<T,T>` ุจุงุดุฏุ ุงูุง ููโุฏุงูุฏ T ฺุณุช.

ุงุฒ C# 10 ุจู ุจุนุฏ ูโุชูุงู ููุน ุจุงุฒฺฏุดุช lambda ุฑุง ูุฒ ูุดุฎุต ฺฉุฑุฏ:

```csharp
var sqr = int (int x) => x;
```

ูุดุฎุต ฺฉุฑุฏู ููุน ุจุงุฒฺฏุดุช ูโุชูุงูุฏ ุนููฺฉุฑุฏ ฺฉุงููพุงูุฑ ุฑุง ุฏุฑ lambdaูุง ูพฺุฏู ู ุชู ุฏุฑ ุชู ุจูุจูุฏ ุฏูุฏ.

---

### ูพุงุฑุงูุชุฑูุง ูพุดโูุฑุถ Lambda (C# 12) ๐ฏ

ูุงููุฏ ูุชุฏูุง ูุนููู ฺฉู ูโุชูุงููุฏ ูพุงุฑุงูุชุฑ ุงุฎุชุงุฑ ุฏุงุดุชู ุจุงุดูุฏ:

```csharp
void Print(string message = "") => Console.WriteLine(message);
```

lambdaูุง ูุฒ ูโุชูุงููุฏ ูพุงุฑุงูุชุฑ ุงุฎุชุงุฑ ุฏุงุดุชู ุจุงุดูุฏ:

```csharp
var print = (string message = "") => Console.WriteLine(message);
print("Hello");
print();
```

ุงู ูฺฺฏ ุจุฑุง ฺฉุชุงุจุฎุงููโูุง ูุงููุฏ **ASP.NET Minimal API** ููุฏ ุงุณุช.

---

### ุฏุณุชุฑุณ ุจู ูุชุบุฑูุง ุฎุงุฑุฌ (Outer Variables) ๐

ฺฉ lambda ูโุชูุงูุฏ ุจู ูุฑ ูุชุบุฑ ฺฉู ุฏุฑ ูุญู ุชุนุฑูุด ูุงุจู ุฏุณุชุฑุณ ุงุณุชุ ุงุฑุฌุงุน ุฏูุฏ. ุงู ูุชุบุฑูุง **outer variables** ูุงูุฏู ูโุดููุฏ ู ูโุชูุงููุฏ ุดุงูู ูุชุบุฑูุง ูุญูุ ูพุงุฑุงูุชุฑูุง ู ููุฏูุง ุจุงุดูุฏ:

```csharp
int factor = 2;
Func<int, int> multiplier = n => n * factor;
Console.WriteLine(multiplier(3));   // ุฎุฑูุฌ: 6
```

ูุชุบุฑูุง ฺฉู ุชูุณุท lambda ุงุฑุฌุงุน ูโุดููุฏุ **captured variables** ูุงูุฏู ูโุดููุฏ. lambda ฺฉู ูุชุบุฑูุง ุฑุง capture ูโฺฉูุฏุ **closure** ูุงูุฏู ูโุดูุฏ.

ูุชุบุฑูุง capture ุดุฏู ููฺฏุงู ูุฑุงุฎูุงู delegate ุงุฑุฒุงุจ ูโุดููุฏุ ูู ููฺฏุงู capture ุดุฏู:

```csharp
int factor = 2;
Func<int, int> multiplier = n => n * factor;
factor = 10;
Console.WriteLine(multiplier(3));  // ุฎุฑูุฌ: 30
```

lambdaูุง ูโุชูุงููุฏ ุฎูุฏุดุงู ูุชุบุฑูุง capture ุดุฏู ุฑุง ุจูโุฑูุฒุฑุณุงู ฺฉููุฏ:

```csharp
int seed = 0;
Func<int> natural = () => seed++;
Console.WriteLine(natural());  // 0
Console.WriteLine(natural());  // 1
Console.WriteLine(seed);       // 2
```

ูุชุบุฑูุง capture ุดุฏู ุทูู ุนูุฑุดุงู ุชุง ุทูู ุนูุฑ delegate ุงุฏุงูู ูพุฏุง ูโฺฉูุฏ. ูุซุงู:

```csharp
static Func<int> Natural()
{
    int seed = 0;
    return () => seed++;  // ุจุฑูโฺฏุฑุฏุงูุฏ ฺฉ closure
}

static void Main()
{
    Func<int> natural = Natural();
    Console.WriteLine(natural()); // 0
    Console.WriteLine(natural()); // 1
}
```

ุงฺฏุฑ ูุชุบุฑ ูุญู ุฑุง ุฏุงุฎู ุฎูุฏ lambda ุจุณุงุฒูุ ูุฑ ูุฑุงุฎูุงู delegate ฺฉ ูุชุบุฑ ุฌุฏุฏ ุงุฌุงุฏ ูโฺฉูุฏ:

```csharp
static Func<int> Natural()
{
    return () => { int seed = 0; return seed++; };
}

static void Main()
{
    Func<int> natural = Natural();
    Console.WriteLine(natural());  // 0
    Console.WriteLine(natural());  // 0
}
```

ูพุงุฏูโุณุงุฒ capture ุฏุงุฎู ุจุง **hoisting** ุงูุฌุงู ูโุดูุฏ: ูุชุบุฑูุง capture ุดุฏู ุจู ููุฏูุง ฺฉ ฺฉูุงุณ ุฎุตูุต ููุชูู ูโุดููุฏ ู ููฺฏุงู ูุฑุงุฎูุงู ูุชุฏุ ฺฉูุงุณ ุงุฌุงุฏ ุดุฏู ู ุจู delegate ูุงุจุณุชู ูโุดูุฏ.

---

### Lambdaูุง ุงุณุชุงุชฺฉ โก

ุฒูุงู ฺฉู lambda ูุชุบุฑูุง ูุญูุ ูพุงุฑุงูุชุฑูุงุ ููุฏูุง instance ุง **this** ุฑุง capture ูโฺฉูุฏุ ฺฉุงููพุงูุฑ ููฺฉู ุงุณุช ฺฉูุงุณ ุฎุตูุต ุงุฌุงุฏ ฺฉูุฏ ุชุง ุงุฑุฌุงุน ุจู ุฏุงุฏูโูุง ุฐุฎุฑู ุดูุฏ. ุงู ุจุงุนุซ ูุตุฑู ุญุงูุธู ูโุดูุฏ.

ุงุฒ C# 9 ุจู ุจุนุฏ ูโุชูุงู ุจุง **static** ฺฉุฑุฏู lambdaุ local function ุง anonymous methodุ ุงุฒ capture ุดุฏู state ุฌููฺฏุฑ ฺฉุฑุฏ:

```csharp
Func<int, int> multiplier = static n => n * 2;
```

ุงฺฏุฑ ุจุนุฏุงู lambda ุจุฎูุงูุฏ ูุชุบุฑ ุฑุง capture ฺฉูุฏุ ฺฉุงููพุงูุฑ ุฎุทุง ูโุฏูุฏ:

```csharp
int factor = 2;
Func<int, int> multiplier = static n => n * factor;  // ฺฉุงููพุงู ููโุดูุฏ
```

lambda ุจุฏูู captureุ ฺฉ instance delegate ฺฉุด ุดุฏู ุฑุง ูุฌุฏุฏุงู ุงุณุชูุงุฏู ูโฺฉูุฏ ู ูุฒููโุง ูุฏุงุฑุฏ.

lambdaูุง ุงุณุชุงุชฺฉ ูููุฒ ูโุชูุงููุฏ ุจู ูุชุบุฑูุง ู ุซุงุจุชโูุง static ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดูุฏ. **static** ุชููุง ููุด ุจุฑุฑุณ ุฏุงุฑุฏ ู ุชุงุซุฑ ุจุฑ IL ุชููุฏุดุฏู ูุฏุงุฑุฏุ ุจุฏูู ุขูุ ฺฉุงููพุงูุฑ ุฏุฑ ุตูุฑุช ูุงุฒ closure ุชููุฏ ูโฺฉูุฏุ ุงูุง ุญุช ุขู ุฒูุงู ุชุฑููุฏูุง ุจุฑุง ฺฉุงูุด ูุฒูู ุฏุงุฑุฏ.

### ฺฏุฑูุชู ูุชุบุฑูุง ุชฺฉุฑุงุฑ (Capturing iteration variables) ๐

ููุช ุฏุฑ ฺฉ ุญูููโ `for` ูุชุบุฑ ุชฺฉุฑุงุฑ (iteration variable) ุฑุง **Capture** ูโฺฉูุฏุ ุฒุจุงู C# ุจุง ุขู ุทูุฑ ุฑูุชุงุฑ ูโฺฉูุฏ ฺฉู ุงูฺฏุงุฑ **ุจุฑูู ุงุฒ ุญููู ุชุนุฑู ุดุฏู ุจุงุดุฏ**. ุนู ุฏุฑ ูุฑ ุชฺฉุฑุงุฑุ ููุงู ูุชุบุฑ ฺฏุฑูุชู ูโุดูุฏ. ุจู ููู ุฏูู ุจุฑูุงููโ ุฒุฑ ุจูโุฌุง ููุงุด `012`ุ ููุฏุงุฑ `333` ุฑุง ฺุงูพ ูโฺฉูุฏ:

```csharp
Action[] actions = new Action[3];
for (int i = 0; i < 3; i++)
    actions[i] = () => Console.Write(i);

foreach (Action a in actions) a();     // 333
```

ูุฑ **closure** (ุจุฎุด ูพุฑุฑูฺฏ ุดุฏู) ููุงู ูุชุบุฑ `i` ุฑุง ูโฺฏุฑุฏ. ุงู ููุทู ุงุณุชุ ฺูู `i` ูุชุบุฑ ุงุณุช ฺฉู ููุฏุงุฑุด ุจู ุชฺฉุฑุงุฑูุง ุญููู ุจุงู ูโูุงูุฏุ ุญุช ูโุชูุงูุฏ ุฏุงุฎู ุจุฏููโ ุญูููุ ููุฏุงุฑ `i` ุฑุง ุชุบุฑ ุฏูุฏ. ูุชุฌู ุงู ุงุณุช ฺฉู ููุช **delegate**ูุง ุจุนุฏุงู ูุฑุงุฎูุงู ูโุดููุฏุ ููฺฏ ููุฏุงุฑ `i` ุฏุฑ ูุญุธูโ ูุฑุงุฎูุงู ุฑุง ูโุจููุฏุ ุนู `3`. ุจุฑุง ุฏุฑฺฉ ุจูุชุฑุ ุญููู ุฑุง ุงูโุทูุฑ ุจุงุฒููุณ ฺฉูุฏ:

```csharp
Action[] actions = new Action[3];
int i = 0;
actions[0] = () => Console.Write(i);
i = 1;
actions[1] = () => Console.Write(i);
i = 2;
actions[2] = () => Console.Write(i);
i = 3;
foreach (Action a in actions) a();    // 333
```

ุฑุงูโุญู ุจุฑุง ููุงุด `012` ุงู ุงุณุช ฺฉู ูุชุบุฑ ุชฺฉุฑุงุฑ ุฑุง ุจู ฺฉ **ูุชุบุฑ ูุญู ุฌุฏุฏ** ฺฉู ุฏุฑ ููุงู ูุญุฏูุฏูโ ุญููู ูุฑุงุฑ ุฏุงุฑุฏุ ุงูุชุณุงุจ ุฏูู:

```csharp
Action[] actions = new Action[3];
for (int i = 0; i < 3; i++)
{
    int loopScopedi = i;
    actions[i] = () => Console.Write(loopScopedi);
}
foreach (Action a in actions) a();     // 012
```

ฺูู ุฏุฑ ูุฑ ุชฺฉุฑุงุฑุ ฺฉ ูุชุบุฑ ุฌุฏุฏ `loopScopedi` ุณุงุฎุชู ูโุดูุฏุ ูุฑ **closure** ฺฉ ูุชุบุฑ ูุชูุงูุช ุฑุง ูโฺฏุฑุฏ. โจ

> **ูฺฉุชู:** ูุจู ุงุฒ ูุณุฎูโ C# 5.0ุ ุญูููโูุง `foreach` ูู ููู ุฑูุชุงุฑ ุฑุง ุฏุงุดุชูุฏ ู ุจุงุนุซ ุณุฑุฏุฑฺฏู ูโุดุฏูุฏ. ฺูู ูุชุบุฑ ุฏุฑ `foreach` ุชุบุฑูุงูพุฐุฑ ุงุณุชุ ุงูุชุธุงุฑ ูโุฑูุช ูุญู ุจุงุดุฏุ ูู ูุจูุฏ. ุฎูุดุจุฎุชุงูู ุงู ููุถูุน ุงุตูุงุญ ุดุฏู ู ุญุงูุง ูโุชูุงูุฏ ูุชุบุฑูุง `foreach` ุฑุง ุจุฏูู ูฺฏุฑุงู Capture ฺฉูุฏ. โ

---

### ููุงุณูโ **Lambda Expressions** ู **Local Methods** ๐

ุนููฺฉุฑุฏ **local methods** (ุจุฎุด ยซLocal methodsยป ุฏุฑ ุตูุญู 106) ุดุจุงูุช ุฒุงุฏ ุจู **lambda expressions** ุฏุงุฑุฏุ ุงูุง ุณู ูุฒุช ุฏุงุฑูุฏ:

1. ูโุชูุงููุฏ **ุจุงุฒฺฏุดุช (recursive)** ุจุงุดูุฏ (ุฎูุฏุดุงู ุฑุง ุตุฏุง ุจุฒููุฏ) ุจุฏูู ูุงุฒ ุจู ุฑูุดโูุง ูพฺุฏู.
2. ูุงุฒ ุจู ูุดุฎุต ฺฉุฑุฏู ููุน delegate ูุฏุงุฑูุฏ ู ฺฉุฏ ุดููุบ ููโุดูุฏ.
3. **ฺฉุงุฑุง ุจุดุชุฑ** ุฏุงุฑูุฏ ฺูู ุณุฑุจุงุฑ delegate ุฑุง ุญุฐู ูโฺฉููุฏ.

**Local methods** ุจูููโุชุฑ ูุณุชูุฏ ฺูู ุงุฒ ูุงุณุทูโ delegate ุงุณุชูุงุฏู ููโฺฉููุฏ (ุงู ฺฉุงุฑ ุจุงุนุซ ุตุฑู ููุฏุงุฑ CPU ู ุญุงูุธู ูโุดูุฏ). ููฺูู ูโุชูุงููุฏ ุจู ูุชุบุฑูุง ูุญู ูุชุฏ ูุงูุฏ ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดูุฏ ุจุฏูู ุงูฺฉู ฺฉุงููพุงูุฑ ูุฌุจูุฑ ุจู **hoist ฺฉุฑุฏู** ุขูโูุง ุฏุฑ ฺฉ ฺฉูุงุณ ูุฎู ุจุงุดุฏ.

ุงูุง ุฏุฑ ุจุณุงุฑ ุงุฒ ููุงุฑุฏ ุดูุง ุจู delegate ูุงุฒ ุฏุงุฑุฏุ ูุซู ููุช ฺฉู ูโุฎูุงูุฏ ูุชุฏ ุจุง ูพุงุฑุงูุชุฑ ุงุฒ ููุน delegate ุฑุง ุตุฏุง ุจุฒูุฏ:

```csharp
public void Foo(Func<int, bool> predicate) { ... }
```

(ูููููโูุง ุจุดุชุฑ ุฏุฑ ูุตู 8 ุฎูุงูุฏ ุฏุฏ.) ุฏุฑ ุงู ููุงูุนุ ุงุณุชูุงุฏู ุงุฒ **lambda** ูุนูููุงู ฺฉูุชุงูโุชุฑ ู ุชูุฒุชุฑ ุงุณุช.

---

### ูุชุฏูุง ูุงุดูุงุณ (Anonymous Methods) ๐ถ๏ธ

**Anonymous methods** ูุงุจูุช ุฏุฑ C# 2.0 ุจูุฏูุฏ ฺฉู ุชุง ุญุฏ ุฒุงุฏ ุจุง **lambda expressions** ุฏุฑ C# 3.0 ุฌุงฺฏุฒู ุดุฏูุฏ. ูุชุฏูุง ูุงุดูุงุณ ูุซู lambda ูุณุชูุฏุ ุงูุง ุงูฺฉุงูุงุช ุฒุฑ ุฑุง ูุฏุงุฑูุฏ:

* **ูพุงุฑุงูุชุฑูุง ููุนโุฏู ุถูู (implicitly typed)**
* **ููุดุชุงุฑ ุจู ุดฺฉู expression** (ููุดู ุจุงุฏ ุจู ุตูุฑุช ุจููฺฉ ุจุงูู ุจุงุดูุฏ)
* ุชูุงูุง **ุชุจุฏู ุจู Expression Tree** ุจุง `Expression<T>`

ูุซุงู:

```csharp
delegate int Transformer(int i);
Transformer sqr = delegate (int x) { return x * x; };
Console.WriteLine(sqr(3));  // 9
```

ุงู ูุนุงุฏู ููุดุชุงุฑ ุฒุฑ ุจุง lambda ุงุณุช:

```csharp
Transformer sqr = (int x) => { return x * x; };
// ุง ุณุงุฏูโุชุฑ:
Transformer sqr = x => x * x;
```

ูุชุฏูุง ูุงุดูุงุณ ูู ูุซู lambdaูุง ูุชุบุฑูุง ุจุฑูู ุฑุง Capture ูโฺฉููุฏ ู ุญุช ูโุชูุงููุฏ ุจุง ฺฉูููโ ฺฉูุฏ `static` ุดุจู lambdaูุง ุงุณุชุงุชฺฉ ุฑูุชุงุฑ ฺฉููุฏ.

ูฺฺฏ ุฎุงุต ุขูโูุง ุงู ุงุณุช ฺฉู **ูโุชูุงู ูพุงุฑุงูุชุฑูุง ุฑุง ฺฉุงููุงู ุญุฐู ฺฉุฑุฏ**ุ ุญุช ุงฺฏุฑ delegate ุขูโูุง ุฑุง ุงูุชุธุงุฑ ุฏุงุดุชู ุจุงุดุฏ. ุงู ุจุฑุง ุชุนุฑู event ุจุง handler ุฎุงู ููุฏ ุงุณุช:

```csharp
public event EventHandler Clicked = delegate { };
```

ุงู ฺฉุงุฑ ุจุงุนุซ ูโุดูุฏ ูุจู ุงุฒ ุตุฏุง ุฒุฏู event ูุงุฒ ุจู ุจุฑุฑุณ null ูุฏุงุดุชู ุจุงุดุฏ. ููฺูู ููุดุชู ุฒุฑ ูู ูุนุชุจุฑ ุงุณุช:

```csharp
// ูพุงุฑุงูุชุฑูุง ุญุฐู ุดุฏูโุงูุฏ:
Clicked += delegate { Console.WriteLine("clicked"); };
```

---

### ุฏุณุชูุฑุงุช try ู ูุฏุฑุช ุงุณุชุซูุงูุง (try Statements and Exceptions) โ๏ธ

ฺฉ ุฏุณุชูุฑ `try` ฺฉ ุจููฺฉ ฺฉุฏ ุฑุง ูุดุฎุต ูโฺฉูุฏ ฺฉู ููฺฉู ุงุณุช ุฎุทุง ุฑุฎ ุฏูุฏ ุง ูุงุฒ ุจู ูพุงฺฉุณุงุฒ ุฏุงุดุชู ุจุงุดุฏ. ุจููฺฉ `try` ุจุงุฏ ุญุฏุงูู ุจุง ฺฉ `catch` ุง ฺฉ `finally` (ุง ูุฑ ุฏู) ููุฑุงู ุจุงุดุฏ:

* **catch** ุฒูุงู ุงุฌุฑุง ูโุดูุฏ ฺฉู ุฎุทุง ุฏุฑ ุจููฺฉ try ุฑุฎ ุฏูุฏ.
* **finally** ููุดู ุจุนุฏ ุงุฒ ุฎุฑูุฌ ุงุฒ try (ุง catch) ุงุฌุฑุง ูโุดูุฏ ู ูุนูููุงู ุจุฑุง ฺฉุงุฑูุง ูพุงฺฉุณุงุฒ ูุซู ุจุณุชู ุงุชุตุงูุงุช ุดุจฺฉู ุงุณุช.

`catch` ุจู ุดุก `Exception` ุฏุณุชุฑุณ ุฏุงุฑุฏ ฺฉู ุงุทูุงุนุงุช ุฎุทุง ุฑุง ูฺฏู ูโุฏุงุฑุฏ. ุดูุง ูโุชูุงูุฏ ุฎุทุง ุฑุง ูุฏุฑุช ฺฉูุฏ ุง ุฏูุจุงุฑู ูพุฑุชุงุจ ฺฉูุฏ (ุจุฑุง ูุงฺฏ ฺฉุฑุฏู ุง ุจุงูุง ุจุฑุฏู ุณุทุญ ุฎุทุง).

ูุซุงู:

```csharp
try
{
    // ููฺฉู ุงุณุช ุฎุทุง ุฑุฎ ุฏูุฏ
}
catch (ExceptionA ex)
{
    // ูุฏุฑุช ุฎุทุง ููุน ExceptionA
}
catch (ExceptionB ex)
{
    // ูุฏุฑุช ุฎุทุง ููุน ExceptionB
}
finally
{
    // ูพุงฺฉุณุงุฒ
}
```

ุจุฑูุงููโ ุฒุฑ ุฑุง ุฏุฑ ูุธุฑ ุจฺฏุฑุฏ:

```csharp
int y = Calc(0);
Console.WriteLine(y);

int Calc(int x) => 10 / x;
```

ฺูู `x` ุตูุฑ ุงุณุชุ ุฎุทุง `DivideByZeroException` ุฑุฎ ูโุฏูุฏ ู ุจุฑูุงูู ูุชููู ูโุดูุฏ. ุญุงูุง ุจุง `try/catch`:

```csharp
try
{
    int y = Calc(0);
    Console.WriteLine(y);
}
catch (DivideByZeroException ex)
{
    Console.WriteLine("x cannot be zero");
}
Console.WriteLine("program completed");

int Calc(int x) => 10 / x;
```

ุฎุฑูุฌ:

```
x cannot be zero
program completed
```

ุฏุฑ ุนููุ ุจูุชุฑ ุงุณุช **ุฎุทุงูุง ูุงุจู ูพุดฺฏุฑ ุฑุง ูุจู ุงุฒ ูููุน ุจุฑุฑุณ ฺฉูุฏ**ุ ูุซูุงู ุชูุณู ุจุฑ ุตูุฑ ุฑุง ฺฺฉ ฺฉูุฏุ ฺูู **exceptionูุง ูุฒููโุจุฑ ูุณุชูุฏ** (ุตุฏูุง ุณฺฉู ูพุฑุฏุงุฒูุฏู ุง ุจุดุชุฑ).

ููุช exception ุฑุฎ ูโุฏูุฏุ CLR ุจุฑุฑุณ ูโฺฉูุฏ:

* ุงฺฏุฑ `catch` ุณุงุฒฺฏุงุฑ ูพุฏุง ุดุฏ: ููุงู ุฑุง ุงุฌุฑุง ูโฺฉูุฏุ ุณูพุณ `finally` ู ุจุฑูุงูู ุงุฏุงูู ูโุงุจุฏ.
* ุงฺฏุฑ ูพุฏุง ูุดุฏ: `finally` ุงุฌุฑุง ูโุดูุฏ (ุงฺฏุฑ ุจุงุดุฏ) ู CLR ุจู ุนูุจ ุฏุฑ stack ุฏูุจุงู `try` ูโฺฏุฑุฏุฏ.
* ุงฺฏุฑ ูฺ ุชุงุจุน ูุณุฆููุช ูฺฏุฑูุช: ุจุฑูุงูู ูุชููู ูโุดูุฏ.

---

### ุจุฎุด catch (ุจุฎุด ฺฏุฑูุชู ุงุณุชุซูุงูุง) ๐ก๏ธ

ฺฉ **catch clause** ูุดุฎุต ูโฺฉูุฏ ฺฉู ฺู ููุน ุงุณุชุซูุง (**Exception**) ุจุงุฏ ฺฏุฑูุชู ุดูุฏ. ุงู ููุน ุจุงุฏ ุง **System.Exception** ุจุงุดุฏ ุง ฺฉ ุฒุฑฺฉูุงุณ ุงุฒ **System.Exception**.

ุงฺฏุฑ **System.Exception** ุฑุง ุจฺฏุฑุฏุ ุชูุงู ุฎุทุงูุง ููฺฉู ุฑุง ุฎูุงูุฏ ฺฏุฑูุช. ุงู ฺฉุงุฑ ุฏุฑ ุดุฑุงุท ุฒุฑ ููุฏ ุงุณุช:

* ููุช ุจุฑูุงููโุชุงู ูโุชูุงูุฏ ุจุฏูู ุชูุฌู ุจู ููุน ุฎุงุต ุงุณุชุซูุงุ ุจูุจูุฏ ุงุจุฏ.
* ููุช ูุตุฏ ุฏุงุฑุฏ ุงุณุชุซูุง ุฑุง ุฏูุจุงุฑู ูพุฑุชุงุจ ฺฉูุฏ (ูุซูุงู ุจุนุฏ ุงุฒ ุซุจุช ุง **Log** ฺฉุฑุฏู ุขู).
* ููุช ููุฏูุฑ ุฎุทุง ุดูุง ุขุฎุฑู ุฎุท ุฏูุงุน ูุจู ุงุฒ ูพุงุงู ุจุฑูุงูู ุงุณุช.

ุงูุง ุฏุฑ ุญุงูุช ูุนูููุ ุจูุชุฑ ุงุณุช ููุนโูุง ุฎุงุต ุงุณุชุซูุง ุฑุง ุจฺฏุฑุฏ ุชุง ูุฌุจูุฑ ูุดูุฏ ุจุง ุดุฑุงุท ุฑูุจูโุฑู ุดูุฏ ฺฉู ููุฏูุฑ ุดูุง ุจุฑุง ุขู ุทุฑุงุญ ูุดุฏู ุงุณุช (ูุซูุงู **OutOfMemoryException**).

ุจุฑุง ูุฏุฑุช ฺูุฏ ููุน ุงุณุชุซูุงุ ูโุชูุงูุฏ ุงุฒ ฺูุฏู ุจุฎุด **catch** ุงุณุชูุงุฏู ฺฉูุฏ (ูุฑฺูุฏ ุฏุฑ ุงู ูุซุงู ูโุชูุงู ุจู ุฌุง ูุฏุฑุช ุงุณุชุซูุงุ ุจุฑุฑุณ ูุฑูุฏโูุง ุฑุง ุงูุฌุงู ุฏุงุฏ):

```csharp
class Test
{
  static void Main (string[] args)
  {
    try
    {
      byte b = byte.Parse (args[0]);
      Console.WriteLine (b);
    }
    catch (IndexOutOfRangeException)
    {
      Console.WriteLine ("Please provide at least one argument");
    }
    catch (FormatException)
    {
      Console.WriteLine ("That's not a number!");
    }
    catch (OverflowException)
    {
      Console.WriteLine ("You've given me more than a byte!");
    }
  }
}
```

ุจุฑุง ูุฑ ุงุณุชุซูุง ููุท ฺฉ **catch** ุงุฌุฑุง ูโุดูุฏ. ุงฺฏุฑ ูโุฎูุงูุฏ ฺฉ ููุฏูุฑ ฺฉู ูุซู **System.Exception** ุฏุงุดุชู ุจุงุดุฏุ ุจุงุฏ ููุฏูุฑูุง ุฎุงุตโุชุฑ ุฑุง ูุจู ุงุฒ ุขู ูุฑุงุฑ ุฏูุฏ.

ฺฏุงู ูุงุฒ ูุฏุงุฑุฏ ุจู ูฺฺฏโูุง ุงุณุชุซูุง ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดุฏ. ุฏุฑ ุงู ุญุงูุช ูโุชูุงูุฏ ูุชุบุฑ ุฑุง ุญุฐู ฺฉูุฏ:

```csharp
catch (OverflowException)   // ุจุฏูู ูุชุบุฑ
{
  ...
}
```

ุญุช ูโุชูุงูุฏ ูู ูุชุบุฑ ู ูู ููุน ุฑุง ุญุฐู ฺฉูุฏ (ุจู ุงู ูุนู ฺฉู ููู ุงุณุชุซูุงูุง ฺฏุฑูุชู ูโุดููุฏ):

```csharp
catch { ... }
```

---

### Exception filters (ููุชุฑูุง ุงุณุชุซูุง) ๐

ูโุชูุงูุฏ ุฏุฑ ุจุฎุด **catch** ฺฉ ููุชุฑ ุงุณุชุซูุง ุจุง ุงุณุชูุงุฏู ุงุฒ ฺฉููู **when** ูุดุฎุต ฺฉูุฏ:

```csharp
catch (WebException ex) when (ex.Status == WebExceptionStatus.Timeout)
{
  ...
}
```

ุฏุฑ ุงู ูุซุงูุ ุงฺฏุฑ **WebException** ูพุฑุชุงุจ ุดูุฏุ ุนุจุงุฑุช ุจูู ุจุนุฏ ุงุฒ **when** ุงุฑุฒุงุจ ูโุดูุฏ. ุงฺฏุฑ ูุชุฌู **false** ุจุงุดุฏุ ุงู **catch** ูุงุฏุฏู ฺฏุฑูุชู ุดุฏู ู ุจู ุณุฑุงุบ **catch**ูุง ุจุนุฏ ูโุฑูุฏ.

ุจุง **exception filters** ูโุชูุงู ฺฉ ููุน ุงุณุชุซูุง ุฑุง ฺูุฏ ุจุงุฑ ุจุง ุดุฑุงุท ูุชูุงูุช ฺฏุฑูุช:

```csharp
catch (WebException ex) when (ex.Status == WebExceptionStatus.Timeout)
{ ... }
catch (WebException ex) when (ex.Status == WebExceptionStatus.SendFailure)
{ ... }
```

ุนุจุงุฑุช ุจูู ุฏุฑ **when** ุญุช ูโุชูุงูุฏ ุดุงูู ูุชุฏูุง ุจุงุดุฏ ฺฉู ุนููุงุช ุฌุงูุจ ุงูุฌุงู ูโุฏููุฏุ ูุงููุฏ ุซุจุช ุฎุทุง ุจุฑุง ุงูุฏุงู ุนุจโุงุจ.

---

### ุจุฎุด finally (ุจุฎุด ูพุงุงู) ๐งน

ุจุฎุด **finally** ููุดู ุงุฌุฑุง ูโุดูุฏโฺู ุงุณุชุซูุง ุฑุฎ ุฏูุฏ ฺู ููุ ู ฺู **try** ุจู ุทูุฑ ฺฉุงูู ุงุฌุฑุง ุดูุฏ ุง ุฎุฑ. ูุนูููุงู ุงุฒ **finally** ุจุฑุง ฺฉุฏูุง ูพุงฺฉโุณุงุฒ ุงุณุชูุงุฏู ูโฺฉูู.

ุจุฎุด **finally** ุจุนุฏ ุงุฒ ูุฑ ฺฉ ุงุฒ ุงู ุญุงูุชโูุง ุงุฌุฑุง ูโุดูุฏ:

* ุจุนุฏ ุงุฒ ุงุชูุงู ฺฉ **catch** (ุง ุฒูุงู ฺฉู ฺฉ ุงุณุชุซูุง ุฌุฏุฏ ูพุฑุชุงุจ ุดูุฏ).
* ุจุนุฏ ุงุฒ ุงุชูุงู ุจููฺฉ **try** (ุง ุฒูุงู ฺฉู ุงุณุชุซูุง ุฑุฎ ุฏูุฏ ฺฉู ููุฏูุฑ ุจุฑุงุด ูุฌูุฏ ูุฏุงุฑุฏ).
* ุฒูุงู ฺฉู ฺฉูุชุฑู ุจุง ฺฉ ุฏุณุชูุฑ ูพุฑุด (ูุซู **return** ุง **goto**) ุงุฒ ุจููฺฉ **try** ุฎุงุฑุฌ ุดูุฏ.

ุชููุง ููุงุฑุฏ ฺฉู ูโุชูุงููุฏ ูุงูุน ุงุฌุฑุง **finally** ุดููุฏุ ฺฉ ุญููู ุจโููุงุช ุง ูพุงุงู ูุงฺฏูุงู ูพุฑุฏุงุฒุด ุงุณุช.

ุจุฎุด **finally** ุจู ุจุฑูุงููโุชุงู ูุธู ู ูุทุนุช ุงุถุงูู ูโฺฉูุฏ. ุฏุฑ ูุซุงู ุฒุฑุ ูุงู ฺฉู ุจุงุฒ ุดุฏู ููุดู ุจุณุชู ูโุดูุฏุ ุตุฑูโูุธุฑ ุงุฒ ุงูฺฉู:

* ุจููฺฉ **try** ุจู ุทูุฑ ุนุงุฏ ุชูุงู ุดูุฏ.
* ุงุฌุฑุง ุจู ุฏูู ุฎุงู ุจูุฏู ูุงู (**EndOfStream**) ุฒูุฏุชุฑ ุจุงุฒฺฏุฑุฏุฏ.
* ฺฉ **IOException** ููฺฏุงู ุฎูุงูุฏู ูุงู ุฑุฎ ุฏูุฏ:

```csharp
void ReadFile()
{
  StreamReader reader = null;    // ุฏุฑ ูุถุง ูุงู System.IO
  try
  {
    reader = File.OpenText ("file.txt");
    if (reader.EndOfStream) return;
    Console.WriteLine (reader.ReadToEnd());
  }
  finally
  {
    if (reader != null) reader.Dispose();
  }
}
```

ุฏุฑ ุงู ูุซุงูุ ูุงู ุฑุง ุจุง ูุฑุงุฎูุงู **Dispose** ุฑู **StreamReader** ุจุณุชู. ูุฑุงุฎูุงู **Dispose** ุฑู ฺฉ ุดุก ุฏุฑ ุฏุงุฎู **finally** ฺฉ ุฑูุด ุงุณุชุงูุฏุงุฑุฏ ุงุณุช ู ุฏุฑ #C ุจุง ุฏุณุชูุฑ **using** ูุฒ ูพุดุชุจุงู ูโุดูุฏ.

---

### ุฏุณุชูุฑ `using` โป๏ธ

ุจุณุงุฑ ุงุฒ ฺฉูุงุณโูุง ููุงุจุน ูุฏุฑุชโูุดุฏู (Unmanaged Resources) ูุงููุฏ **ุฏุณุชฺฏุฑูโูุง ูุงู (File Handles)**ุ **ุฏุณุชฺฏุฑูโูุง ฺฏุฑุงูฺฉ (Graphics Handles)** ุง **ุงุชุตุงูุงุช ูพุงฺฏุงู ุฏุงุฏู (Database Connections)** ุฑุง ุฏุฑ ุฎูุฏ ุฌุง ูโุฏููุฏ. ุงู ฺฉูุงุณโูุง ุงูุชุฑูุณ **`System.IDisposable`** ุฑุง ูพุงุฏูโุณุงุฒ ูโฺฉููุฏ ฺฉู ุชููุง ฺฉ ูุชุฏ ุจุฏูู ูพุงุฑุงูุชุฑ ุจู ูุงู **`Dispose`** ุฏุงุฑุฏ ู ุจุฑุง ูพุงฺฉโุณุงุฒ ุงู ููุงุจุน ุงุณุชูุงุฏู ูโุดูุฏ.

ุฏุณุชูุฑ **`using`** ฺฉ ูฺฏุงุฑุด ุณุงุฏู ู ุดฺฉู ุจุฑุง ูุฑุงุฎูุงู **`Dispose`** ุฑู ฺฉ ุดุก ูพุงุฏูโุณุงุฒ **`IDisposable`**ุ ุฏุฑูู ฺฉ ุจููฺฉ **`finally`** ูุฑุงูู ูโฺฉูุฏ.

ุจูโุนููุงู ูุซุงู:

```csharp
using (StreamReader reader = File.OpenText("file.txt"))
{
    ...
}
```

ุงู ูุทุนูโฺฉุฏ ุฏููุงู ูุนุงุฏู ุฒุฑ ุงุณุช:

```csharp
StreamReader reader = File.OpenText("file.txt");
try
{
    ...
}
finally
{
    if (reader != null)
        ((IDisposable)reader).Dispose();
}
```

---

### ุงุนูุงูโูุง `using` (Using Declarations) โ๏ธ

ุงฺฏุฑ ุฏุฑ **C# 8 ู ูุณุฎูโูุง ุจุงูุงุชุฑ**ุ ุจุฑุงฺฉุชโูุง ู ุจููฺฉ ฺฉุฏ ุจุนุฏ ุงุฒ ุฏุณุชูุฑ **`using`** ุญุฐู ุดููุฏุ ุงู ุฏุณุชูุฑ ุชุจุฏู ุจู **ุงุนูุงู using** ูโุดูุฏ. ุฏุฑ ุงู ุญุงูุชุ ููุจุน ุฒูุงู ุขุฒุงุฏ ูโุดูุฏ ฺฉู ุงุฌุฑุง ุจุฑูุงูู ุงุฒ ุจููฺฉ ูุญุตูุฑฺฉููุฏู ุฎุงุฑุฌ ฺฏุฑุฏุฏ.

ูุซุงู:

```csharp
if (File.Exists("file.txt"))
{
    using var reader = File.OpenText("file.txt");
    Console.WriteLine(reader.ReadLine());
    ...
}
```

ุฏุฑ ุงู ุญุงูุชุ **`reader`** ุฒูุงู Dispose ูโุดูุฏ ฺฉู ุงุฌุฑุง ุจุฑูุงูู ุงุฒ ุจููฺฉ **`if`** ุฎุงุฑุฌ ุดูุฏ.

---

### ูพุฑุชุงุจ ุงุณุชุซูุง (Throwing Exceptions) ๐

ุงุณุชุซูุงูุง (Exceptions) ูโุชูุงููุฏ ูู ุชูุณุท **ุฒูุงู ุงุฌุฑุง (Runtime)** ู ูู ุฏุฑ **ฺฉุฏูุง ฺฉุงุฑุจุฑ** ูพุฑุชุงุจ ุดููุฏ. ุฏุฑ ูุซุงู ุฒุฑุ ูุชุฏ **`Display`** ฺฉ ุงุณุชุซูุง **`System.ArgumentNullException`** ุฑุง ูพุฑุชุงุจ ูโฺฉูุฏ:

```csharp
try { Display(null); }
catch (ArgumentNullException ex)
{
    Console.WriteLine("Caught the exception");
}

void Display(string name)
{
    if (name == null)
        throw new ArgumentNullException(nameof(name));
    Console.WriteLine(name);
}
```

ุงุฒ ุขูโุฌุง ฺฉู ุจุฑุฑุณ ุขุฑฺฏููุงู ุจุฑุง ููุฏุงุฑ **null** ู ูพุฑุชุงุจ **`ArgumentNullException`** ุจุณุงุฑ ุฑุงุฌ ุงุณุชุ ุงุฒ **.NET 6** ฺฉ ูุงูโุจุฑ ุงุฑุงุฆู ุดุฏู ุงุณุช:

```csharp
void Display(string name)
{
    ArgumentNullException.ThrowIfNull(name);
    Console.WriteLine(name);
}
```

ุชูุฌู ฺฉูุฏ ฺฉู ุฏุฑ ุงู ุฑูุดุ ูุงุฒ ุจู ูุดุฎุต ฺฉุฑุฏู ูุงู ูพุงุฑุงูุชุฑ ูุฏุงุฑู. ุฏูู ุงู ููุถูุน ุฏุฑ ุจุฎุด **CallerArgumentExpression** (ุตูุญู 247) ุชูุถุญ ุฏุงุฏู ุฎูุงูุฏ ุดุฏ.

---

### ุนุจุงุฑุชโูุง `throw` (Throw Expressions) ๐ฏ

ุนุจุงุฑุช **`throw`** ูโุชูุงูุฏ ุจูโุนููุงู ฺฉ **ุนุจุงุฑุช (Expression)** ุฏุฑ ูุชุฏูุง **Expression-bodied** ุงุณุชูุงุฏู ุดูุฏ:

```csharp
public string Foo() => throw new NotImplementedException();
```

ููฺูู ูโุชูุงูุฏ ุฏุฑ ฺฉ **ุนุจุงุฑุช ุดุฑุท ุณูโุชุง (Ternary Conditional Expression)** ุธุงูุฑ ุดูุฏ:

```csharp
string ProperCase(string value) =>
    value == null ? throw new ArgumentException("value") :
    value == "" ? "" :
    char.ToUpper(value[0]) + value.Substring(1);
```

---

### ูพุฑุชุงุจ ุฏูุจุงุฑู ุงุณุชุซูุง (Rethrowing an Exception) ๐

ูโุชูุงูุฏ ฺฉ ุงุณุชุซูุง ุฑุง ฺฏุฑูุชู ู ุฏูุจุงุฑู ูพุฑุชุงุจ ฺฉูุฏ:

```csharp
try
{
    ...
}
catch (Exception ex)
{
    // Log error
    ...
    throw; // ูพุฑุชุงุจ ุฏูุจุงุฑู ููุงู ุงุณุชุซูุง
}
```

ุงฺฏุฑ ุจูโุฌุง **`throw`** ุงุฒ **`throw ex`** ุงุณุชูุงุฏู ฺฉููุ ุจุฑูุงูู ููฺูุงู ฺฉุงุฑ ูโฺฉูุฏ ุงูุง ุฎุงุตุช **`StackTrace`** ุฏฺฏุฑ ูุณุฑ ุฎุทุง ุงุตู ุฑุง ูุดุงู ููโุฏูุฏ.

ูพุฑุชุงุจ ุฏูุจุงุฑู ุจู ุดูุง ุงุฌุงุฒู ูโุฏูุฏ ุฎุทุง ุฑุง **ุซุจุช (Log)** ฺฉูุฏ ุจุฏูู ุงูฺฉู ุขู ุฑุง ูุงุฏุฏู ุจฺฏุฑุฏุ ุง ุฒูุงู ฺฉู ุดุฑุงุท ูุฑุงุชุฑ ุงุฒ ุงูุชุธุงุฑ ุงุณุชุ ุงุฒ ุงุฏุงูู ูุฏุฑุช ุฎุทุง ุตุฑูโูุธุฑ ฺฉูุฏ.

ฺฉ ุฏฺฏุฑ ุงุฒ ุณูุงุฑููุง ุฑุงุฌุ ูพุฑุชุงุจ ฺฉ ุงุณุชุซูุง **ุฎุงุตโุชุฑ** ุงุณุช:

```csharp
try
{
    // Parse a DateTime from XML element data
}
catch (FormatException ex)
{
    throw new XmlException("Invalid DateTime", ex);
}
```

ุฏูุช ฺฉูุฏ ฺฉู ููฺฏุงู ุณุงุฎุช **`XmlException`**ุ ุงุณุชุซูุง ุงุตู **`ex`** ุฑุง ุจูโุนููุงู ุขุฑฺฏููุงู ุฏูู ูพุงุณ ุฏุงุฏู. ุงู ุขุฑฺฏููุงู ุฎุงุตุช **`InnerException`** ุฑุง ููุฏุงุฑุฏู ูโฺฉูุฏ ู ุฏุฑ ุงุดฺฉุงูโุฒุฏุง ฺฉูฺฉ ุฒุงุฏ ูโฺฉูุฏ. ุชูุฑุจุงู ููู ุงููุงุน ุงุณุชุซูุง ฺูู ุณุงุฒูุฏูโุง ุฏุงุฑูุฏ.

---

### ูพุฑุชุงุจ ฺฉ ุงุณุชุซูุง ฺฉูโุชุฑ (Less-Specific Exception)

ุงู ุฑูุด ุฒูุงู ููุฏ ุงุณุช ฺฉู ุฏุฑ ุญุงู ุนุจูุฑ ุงุฒ ฺฉ **ูุฑุฒ ุงุนุชูุงุฏ (Trust Boundary)** ูุณุชุฏ ุชุง ุงุฒ ุงูุดุง ุงุทูุงุนุงุช ูู ุจุฑุง ููุงุฌูุงู ุจุงูููู ุฌููฺฏุฑ ฺฉูุฏ.

---

### ูฺฺฏโูุง ฺฉูุฏ **System.Exception** โ๏ธ

ูููโุชุฑู ูฺฺฏโูุง **System.Exception** ุจู ุดุฑุญ ุฒุฑ ูุณุชูุฏ:

* **StackTrace**
  ุฑุดุชูโุง (**string**) ฺฉู ุชูุงู ูุชุฏูุง ุฑุง ฺฉู ุงุฒ ููุทู ุดุฑูุน ุฑุฎุฏุงุฏ ุงุณุชุซูุง ุชุง ุจููฺฉ **catch** ูุฑุงุฎูุงู ุดุฏูโุงูุฏุ ููุงุด ูโุฏูุฏ.

* **Message**
  ุฑุดุชูโุง ฺฉู ุชูุถุญ ุฎุทุง ุฑุง ุฏุฑ ุฎูุฏ ูฺฏู ูโุฏุงุฑุฏ.

* **InnerException**
  ุงุณุชุซูุง ุฏุงุฎู (ุฏุฑ ุตูุฑุช ูุฌูุฏ) ฺฉู ุจุงุนุซ ุงุฌุงุฏ ุงุณุชุซูุง ุจุฑูู ุดุฏู ุงุณุช. ุงู ุงุณุชุซูุง ุฎูุฏ ูโุชูุงูุฏ ุดุงูู **InnerException** ุฏฺฏุฑ ูุฒ ุจุงุดุฏ.

> ุฏุฑ ุฒุจุงู C# ุชูุงู ุงุณุชุซูุงูุง ุฏุฑ ุฒูุงู ุงุฌุฑุง (**runtime exceptions**) ุงุชูุงู ูโุงูุชูุฏ ู ูุนุงุฏู ุจุฑุง ุงุณุชุซูุงูุง ุจุฑุฑุณโุดุฏู ุฏุฑ ุฒูุงู ฺฉุงููพุงู (**compile-time checked exceptions**) ูุงููุฏ Java ูุฌูุฏ ูุฏุงุฑุฏ.

---

### ุงููุงุน ุฑุงุฌ ุงุณุชุซูุงูุง ๐จ

ุงููุงุน ุฒุฑ ุงุฒ ุงุณุชุซูุงูุง ุจูโุทูุฑ ฺฏุณุชุฑุฏู ุฏุฑ ุณุฑุงุณุฑ **CLR** ู ฺฉุชุงุจุฎุงููโูุง **.NET** ุงุณุชูุงุฏู ูโุดููุฏ. ุดูุง ูโุชูุงูุฏ ุขูโูุง ุฑุง ุฎูุฏุชุงู ูพุฑุชุงุจ ฺฉูุฏ ุง ุงุฒ ุขูโูุง ุจูโุนููุงู ฺฉูุงุณ ูพุงู ุจุฑุง ุณุงุฎุช ุงููุงุน ุณูุงุฑุด ุงุณุชุซูุง ุงุณุชูุงุฏู ููุงุฏ:

* **System.ArgumentException**
  ุฒูุงู ูพุฑุชุงุจ ูโุดูุฏ ฺฉู ฺฉ ุชุงุจุน ุจุง ุขุฑฺฏููุงู ูุงูุนุชุจุฑ ูุฑุงุฎูุงู ุดูุฏ. ูุนูููุงู ูุดุงูโุฏููุฏู ฺฉ ุฎุทุง ุจุฑูุงููโููุณ ุงุณุช.

* **System.ArgumentNullException**
  ุฒุฑฺฉูุงุณ **ArgumentException** ฺฉู ููุช ฺฉ ุขุฑฺฏููุงู ุชุงุจุน ุจูโุทูุฑ ุบุฑููุชุธุฑู **null** ุจุงุดุฏุ ูพุฑุชุงุจ ูโุดูุฏ.

* **System.ArgumentOutOfRangeException**
  ุฒุฑฺฉูุงุณ **ArgumentException** ฺฉู ููุช ฺฉ ุขุฑฺฏููุงู (ูุนูููุงู ุนุฏุฏ) ุฎู ุจุฒุฑฺฏ ุง ุฎู ฺฉูฺฺฉ ุจุงุดุฏุ ูพุฑุชุงุจ ูโุดูุฏ. ุจุฑุง ูุซุงูุ ุงุฑุณุงู ฺฉ ุนุฏุฏ ููู ุจู ุชุงุจุน ฺฉู ููุท ููุงุฏุฑ ูุซุจุช ุฑุง ูโูพุฐุฑุฏ.

* **System.InvalidOperationException**
  ุฒูุงู ูพุฑุชุงุจ ูโุดูุฏ ฺฉู ูุถุนุช ฺฉ ุดุก ุจุฑุง ุงุฌุฑุง ููููุชโุขูุฒ ูุชุฏ ููุงุณุจ ูุจุงุดุฏุ ุจุฏูู ุชูุฌู ุจู ููุฏุงุฑ ุขุฑฺฏููุงูโูุง. ูุซุงูโูุง ุดุงูู ุฎูุงูุฏู ฺฉ ูุงู ุจุงุฒูุดุฏู ุง ุฏุฑุงูุช ุนูุตุฑ ุจุนุฏ ุงุฒ ฺฉ ุดูุงุฑูุฏู (**Enumerator**) ุงุณุช ฺฉู ูุณุช ุฒุฑู ุขู ุฏุฑ ูุงูู ุงุฌุฑุง ุชุบุฑ ฺฉุฑุฏู ุงุณุช.

* **System.NotSupportedException**
  ุฒูุงู ูพุฑุชุงุจ ูโุดูุฏ ฺฉู ฺฉ ูุงุจูุช ุฎุงุต ูพุดุชุจุงู ููโุดูุฏ. ูุซุงู ููุงุณุจ: ูุฑุงุฎูุงู ูุชุฏ **Add** ุฑู ูุฌููุนูโุง ฺฉู **IsReadOnly** ุขู **true** ุงุณุช.

* **System.NotImplementedException**
  ุฒูุงู ูพุฑุชุงุจ ูโุดูุฏ ฺฉู ฺฉ ุชุงุจุน ูููุฒ ูพุงุฏูโุณุงุฒ ูุดุฏู ุงุณุช.

* **System.ObjectDisposedException**
  ุฒูุงู ูพุฑุชุงุจ ูโุดูุฏ ฺฉู ุฑู ุดุฆ ฺฉู ูุจูุงู **Dispose** ุดุฏูุ ูุชุฏ ูุฑุงุฎูุงู ุดูุฏ.

ฺฉ ุฏฺฏุฑ ุงุฒ ุงุณุชุซูุงูุง ุฑุงุฌ **NullReferenceException** ุงุณุช. ุงู ุงุณุชุซูุง ุชูุณุท **CLR** ุฒูุงู ูพุฑุชุงุจ ูโุดูุฏ ฺฉู ุชูุงุด ฺฉูุฏ ุจู ุนุถู ุงุฒ ุดุฆ ฺฉู ููุฏุงุฑ ุขู **null** ุงุณุช ุฏุณุชุฑุณ ูพุฏุง ฺฉูุฏ (ฺฉู ูุดุงูโุฏููุฏู ูุฌูุฏ ุจุงฺฏ ุฏุฑ ฺฉุฏ ุดูุงุณุช). ุจุฑุง ุชุณุชุ ูโุชูุงูุฏ ุจูโุทูุฑ ูุณุชูู ุงู ุงุณุชุซูุง ุฑุง ูพุฑุชุงุจ ฺฉูุฏ:

```csharp
throw null;
```

---

### ุงูฺฏู ูุชุฏูุง **TryXXX** ๐

ููฺฏุงู ููุดุชู ฺฉ ูุชุฏุ ุฒูุงู ฺฉู ูุดฺฉู ูพุด ูโุขุฏุ ุฏู ุงูุชุฎุงุจ ุฏุงุฑุฏ: ุง ฺฉ ฺฉุฏ ุฎุทุง ุจุฑฺฏุฑุฏุงูุฏ ุง ฺฉ ุงุณุชุซูุง ูพุฑุชุงุจ ฺฉูุฏ. ุจูโุทูุฑ ฺฉูุ ุฒูุงู ฺฉู ุฎุทุง ุฎุงุฑุฌ ุงุฒ ุฑููุฏ ุนุงุฏ ุจุฑูุงูู ุจุงุดุฏ ุง ุฒูุงู ฺฉู ุงูุชุธุงุฑ ูุฏุงุฑุฏ ูุฑุงุฎูุงููุฏู ุจุชูุงูุฏ ุจุง ุขู ููุงุจูู ฺฉูุฏุ ุงุณุชุซูุง ูพุฑุชุงุจ ูโฺฉูุฏ.

ุจุงุงูโุญุงูุ ฺฏุงู ุจูุชุฑ ุงุณุช ูุฑ ุฏู ุงูุชุฎุงุจ ุฑุง ุจู ูุตุฑูโฺฉููุฏู ุงุฑุงุฆู ุฏูุฏ. ูุซุงู ุงุฒ ุงู ููุฑุฏ ููุน **int** ุงุณุช ฺฉู ุฏู ูุณุฎู ุงุฒ ูุชุฏ **Parse** ุฑุง ุงุฑุงุฆู ูโุฏูุฏ:

```csharp
public int Parse(string input);
public bool TryParse(string input, out int returnValue);
```

ุงฺฏุฑ **Parse** ุดฺฉุณุช ุจุฎูุฑุฏุ ฺฉ ุงุณุชุซูุง ูพุฑุชุงุจ ูโฺฉูุฏุ ุงูุง **TryParse** ุฏุฑ ุงู ุญุงูุช ููุฏุงุฑ **false** ุจุฑูโฺฏุฑุฏุงูุฏ.

ูโุชูุงูุฏ ุงู ุงูฺฏู ุฑุง ุจุง ุงู ุฑูุด ูพุงุฏูโุณุงุฒ ฺฉูุฏ ฺฉู ูุชุฏ **XXX** ุฏุฑ ููุงุช ูุชุฏ **TryXXX** ุฑุง ูุฑุงุฎูุงู ฺฉูุฏ:

```csharp
public return-type XXX(input-type input)
{
    return-type returnValue;
    if (!TryXXX(input, out returnValue))
        throw new YYYException(...);
    return returnValue;
}
```

---

### ุฌุงฺฏุฒูโูุง ุงุณุชุซูุงูุง ๐๏ธ

ููุงููุฏ **int.TryParse**ุ ฺฉ ุชุงุจุน ูโุชูุงูุฏ ุจุง ุจุฑฺฏุฑุฏุงูุฏู ฺฉ ฺฉุฏ ุฎุทุง ุงุฒ ุทุฑู ููุฏุงุฑ ุจุงุฒฺฏุดุช ุง ูพุงุฑุงูุชุฑ ุจู ุชุงุจุน ูุฑุงุฎูุงููุฏูุ ุดฺฉุณุช ุฑุง ุงุทูุงุน ุฏูุฏ. ุงฺฏุฑฺู ุงู ุฑูุด ุจุฑุง ุฎุทุงูุง ุณุงุฏู ู ูุงุจู ูพุดโุจู ฺฉุงุฑุขูุฏ ุงุณุชุ ุงูุง ููฺฏุงู ููุงุฌูู ุจุง ุฎุทุงูุง ุบุฑูุนููู ุง ุบุฑูุงุจู ูพุดโุจู ุฏุณุชโููพุงฺฏุฑ ูโุดูุฏุ ุงูุถุง ูุชุฏูุง ุฑุง ุดููุบ ูโฺฉูุฏ ู ูพฺุฏฺฏโูุง ุบุฑุถุฑูุฑ ุงุฌุงุฏ ูโููุงุฏ.

ููฺูู ุงู ุฑูุด ุจุฑุง ุชูุงุจุน ฺฉู ูุชุฏ ูุณุชูุฏ (ูุงููุฏ ุนููฺฏุฑูุง ูุซู ุนููฺฏุฑ ุชูุณู ุง ูฺฺฏโูุง **Properties**) ูุงุจู ุงุณุชูุงุฏู ูุณุช. ฺฉ ุฌุงฺฏุฒู ุฏฺฏุฑ ูุฑุงุฑ ุฏุงุฏู ุฎุทุง ุฏุฑ ฺฉ ูุญู ูุดุชุฑฺฉ ุงุณุช ฺฉู ุชูุงู ุชูุงุจุน ุฏุฑ ุฒูุฌุฑู ูุฑุงุฎูุงู ุจุชูุงููุฏ ุขู ุฑุง ุจุจููุฏ (ูุซูุงู ฺฉ ูุชุฏ **static** ฺฉู ุฎุทุง ูุนู ุฑุง ุฏุฑ ูุฑ ูุฎ ุฐุฎุฑู ฺฉูุฏ). ุจุง ุงู ุญุงูุ ุงู ุฑูุด ูุงุฒููุฏ ูุดุงุฑฺฉุช ูุฑ ุชุงุจุน ุฏุฑ ุงูฺฏู ุงูุชุดุงุฑ ุฎุทุง ุงุณุช ฺฉู ูู ุฏุณุชโููพุงฺฏุฑ ู ูู ูุณุชุนุฏ ุฎุทุง ุฎูุงูุฏ ุจูุฏ.

---

### ุดูุงุฑุด (Enumeration) ู ูพูุงุดฺฏุฑูุง (Iterators) ๐

#### ุดูุงุฑุด (Enumeration)

**Enumerator (ุดูุงุฑุดโฺฏุฑ)** ฺฉ ูฺฉุงูโููุง (cursor) **ููุท ุฎูุงูุฏู** ู **ููุท ุฑู ุจู ุฌูู** ุฑู ฺฉ ุฏูุจุงูู ุงุฒ ููุงุฏุฑ ุงุณุช. ุฏุฑ ุฒุจุงู #Cุ ฺฉ ููุน (type) ุจูโุนููุงู ุดูุงุฑุดโฺฏุฑ ุดูุงุฎุชู ูโุดูุฏ ุงฺฏุฑ ฺฉ ุงุฒ ุดุฑุงุท ุฒุฑ ุฑุง ุฏุงุดุชู ุจุงุดุฏ:

* ฺฉ ูุชุฏ ุนููู (public) ุจุฏูู ูพุงุฑุงูุชุฑ ุจู ูุงู `MoveNext` ู ฺฉ ูฺฺฏ (property) ุจู ูุงู `Current` ุฏุงุดุชู ุจุงุดุฏ.
* ูุงุณุท `System.Collections.Generic.IEnumerator<T>` ุฑุง ูพุงุฏูโุณุงุฒ ฺฉูุฏ.
* ูุงุณุท `System.Collections.IEnumerator` ุฑุง ูพุงุฏูโุณุงุฒ ฺฉูุฏ.

**ุนุจุงุฑุช foreach** ุฑู ฺฉ **Enumerable object (ุดุก ุดูุงุฑุดโูพุฐุฑ)** ูพูุงุด ูโฺฉูุฏ.
ฺฉ **Enumerable object** ููุงุด ููุทู ฺฉ ุฏูุจุงูู ุงุณุช. ุงู ุดุก ุฎูุฏุด ูฺฉุงูโููุง ูุณุชุ ุจูฺฉู **ูฺฉุงูโููุง ุชููุฏ ูโฺฉูุฏ**. ุฏุฑ #Cุ ฺฉ ููุน ุจูโุนููุงู ุดูุงุฑุดโูพุฐุฑ ุดูุงุฎุชู ูโุดูุฏ ุงฺฏุฑ ฺฉ ุงุฒ ุดุฑุงุท ุฒุฑ ุฑุง ุฏุงุดุชู ุจุงุดุฏ (ุจุฑุฑุณโูุง ุจู ููู ุชุฑุชุจ ุงูุฌุงู ูโุดูุฏ):

* ฺฉ ูุชุฏ ุนููู ุจุฏูู ูพุงุฑุงูุชุฑ ุจู ูุงู `GetEnumerator` ุฏุงุดุชู ุจุงุดุฏ ฺฉู ฺฉ ุดูุงุฑุดโฺฏุฑ ุจุฑฺฏุฑุฏุงูุฏ.
* ูุงุณุท `System.Collections.Generic.IEnumerable<T>` ุฑุง ูพุงุฏูโุณุงุฒ ฺฉูุฏ.
* ูุงุณุท `System.Collections.IEnumerable` ุฑุง ูพุงุฏูโุณุงุฒ ฺฉูุฏ.
* (ุงุฒ #C ูุณุฎู 9 ุจู ุจุนุฏ) ุจุชูุงูุฏ ุจู ฺฉ ูุชุฏ ุชูุณุนูโุง (extension method) ุจู ูุงู `GetEnumerator` ฺฉู ฺฉ ุดูุงุฑุดโฺฏุฑ ุจุฑูโฺฏุฑุฏุงูุฏุ ูุชุตู ุดูุฏ (ุจุฎุด **"Extension Methods"** ุฏุฑ ุตูุญู 217 ุฑุง ุจุจูุฏ).

**ุงูฺฏู ุดูุงุฑุด** ุจู ุดฺฉู ุฒุฑ ุงุณุช:

```csharp
class Enumerator   // ูุนูููุงู ูุงุณุท IEnumerator ุง IEnumerator<T> ุฑุง ูพุงุฏูโุณุงุฒ ูโฺฉูุฏ
{
  public IteratorVariableType Current { get {...} }
  public bool MoveNext() {...}
}

class Enumerable   // ูุนูููุงู ูุงุณุท IEnumerable ุง IEnumerable<T> ุฑุง ูพุงุฏูโุณุงุฒ ูโฺฉูุฏ
{
  public Enumerator GetEnumerator() {...}
}
```

**ููููู ูพูุงุด ุณุทุญ ุจุงูุง** ุฑู ฺฉุงุฑุงฺฉุชุฑูุง ฺฉููู `"beer"` ุจุง ุงุณุชูุงุฏู ุงุฒ `foreach`:

```csharp
foreach (char c in "beer")
  Console.WriteLine(c);
```

**ููููู ูพูุงุด ุณุทุญ ูพุงู** ุฑู ฺฉุงุฑุงฺฉุชุฑูุง `"beer"` ุจุฏูู ุงุณุชูุงุฏู ุงุฒ `foreach`:

```csharp
using (var enumerator = "beer".GetEnumerator())
  while (enumerator.MoveNext())
  {
    var element = enumerator.Current;
    Console.WriteLine(element);
  }
```

> ุงฺฏุฑ ุดูุงุฑุดโฺฏุฑ ูุงุณุท `IDisposable` ุฑุง ูพุงุฏูโุณุงุฒ ฺฉูุฏุ ุนุจุงุฑุช `foreach` ูุงููุฏ ฺฉ ุนุจุงุฑุช `using` ุนูู ฺฉุฑุฏู ู **ุจูโุทูุฑ ุถูู** ุดุก ุดูุงุฑุดโฺฏุฑ ุฑุง ุขุฒุงุฏ (dispose) ูโฺฉูุฏ.

ุฌุฒุฆุงุช ุจุดุชุฑ ุฏุฑ ููุฑุฏ ูุงุณุทโูุง ุดูุงุฑุด ุฏุฑ **ูุตู 7** ุชูุถุญ ุฏุงุฏู ุดุฏู ุงุณุช.

---

#### ููุฏุงุฑุฏู ุงููู ูุฌููุนูโูุง (Collection Initializers) ู ุนุจุงุฑุงุช ูุฌููุนูโุง (Collection Expressions) ๐

ุดูุง ูโุชูุงูุฏ ุฏุฑ ฺฉ ูุฑุญููุ ฺฉ ุดุก ุดูุงุฑุดโูพุฐุฑ ุฑุง ุงุฌุงุฏ ู ููุฏุงุฑุฏู ฺฉูุฏ:

```csharp
using System.Collections.Generic;
var list = new List<int> { 1, 2, 3 };
```

ุงุฒ ูุณุฎู #C 12 ุจู ุจุนุฏุ ูโุชูุงูุฏ ุงู ฺฉุงุฑ ุฑุง ฺฉูุชุงูโุชุฑ ุงูุฌุงู ุฏูุฏ (ุจุง ุงุณุชูุงุฏู ุงุฒ **ุจุฑุงฺฉุชโูุง**):

```csharp
using System.Collections.Generic;
List<int> list = [1, 2, 3];
```

**ุนุจุงุฑุงุช ูุฌููุนูโุง** **ูุฏูโููุน (target-typed)** ูุณุชูุฏุ ุนู ููุน `[1, 2, 3]` ุจู ููุน ูุชุบุฑ ฺฉู ุจู ุขู ุงูุชุณุงุจ ุฏุงุฏู ูโุดูุฏ ุจุณุชฺฏ ุฏุงุฑุฏ. ูุซุงู:

```csharp
int[] array = [1, 2, 3];
Span<int> span = [1, 2, 3];
```

ุญุช ูโุชูุงูุฏ ููฺฏุงู ูุฑุงุฎูุงู ูุชุฏูุง ูู ููุน ุฑุง ุญุฐู ฺฉูุฏ ุงฺฏุฑ ฺฉุงููพุงูุฑ ุจุชูุงูุฏ ุขู ุฑุง ุงุณุชูุจุงุท ฺฉูุฏ:

```csharp
Foo([1, 2, 3]);

void Foo(List<int> numbers) { ... }
```

ฺฉุงููพุงูุฑ ุงู ฺฉุฏ ุฑุง ุจู ุงู ุดฺฉู ุชุฑุฌูู ูโฺฉูุฏ:

```csharp
using System.Collections.Generic;
List<int> list = new List<int>();
list.Add(1);
list.Add(2);
list.Add(3);
```

ุงู ููุถูุน ูุงุฒููุฏ ุงู ุงุณุช ฺฉู ุดุก ุดูุงุฑุดโูพุฐุฑ ูุงุณุท `System.Collections.IEnumerable` ุฑุง ูพุงุฏูโุณุงุฒ ฺฉูุฏ ู ฺฉ ูุชุฏ `Add` ุจุง ุชุนุฏุงุฏ ูพุงุฑุงูุชุฑ ููุงุณุจ ุฏุงุดุชู ุจุงุดุฏ. (ุฏุฑ ุนุจุงุฑุงุช ูุฌููุนูโุงุ ฺฉุงููพุงูุฑ ุงุฒ ุงูฺฏููุง ุฏฺฏุฑ ูู ุจุฑุง ุงุฌุงุฏ ูุฌููุนูโูุง ููุท ุฎูุงูุฏู ูพุดุชุจุงู ูโฺฉูุฏ.)

ููฺูู ูโุชูุงูุฏ ุฏฺฉุดูุฑโูุง ุฑุง ูู ุจู ููู ุดฺฉู ููุฏุงุฑุฏู ฺฉูุฏ (ุจุฎุด **"Dictionaries"** ุฏุฑ ุตูุญู 394 ุฑุง ุจุจูุฏ):

```csharp
var dict = new Dictionary<int, string>()
{
  { 5, "five" },
  { 10, "ten" }
};
```

ุง ุจู ุดฺฉู ฺฉูุชุงูโุชุฑ:

```csharp
var dict = new Dictionary<int, string>()
{
  [3] = "three",
  [10] = "ten"
};
```

ุงู ุฑูุด ูู ุชููุง ุจุฑุง ุฏฺฉุดูุฑโูุงุ ุจูฺฉู ุจุฑุง ูุฑ ููุน ฺฉู **Indexer** ุฏุงุดุชู ุจุงุดุฏุ ูุนุชุจุฑ ุงุณุช.

---

#### ูพูุงุดฺฏุฑูุง (Iterators) โ๏ธ

ุฏุฑ ุญุงู ฺฉู ุนุจุงุฑุช `foreach` **ูุตุฑูโฺฉููุฏู** ฺฉ ุดูุงุฑุดโฺฏุฑ ุงุณุชุ **Iterator (ูพูุงุดฺฏุฑ)** **ุชููุฏฺฉููุฏู** ฺฉ ุดูุงุฑุดโฺฏุฑ ุงุณุช.
ูุซุงู ุฒุฑ ฺฉ ูพูุงุดฺฏุฑ ุงุณุช ฺฉู ฺฉ ุฏูุจุงูู ุงุฒ ุงุนุฏุงุฏ ูุจููุงฺ ุฑุง ุชููุฏ ูโฺฉูุฏ (ูุฑ ุนุฏุฏ ุญุงุตู ุฌูุน ุฏู ุนุฏุฏ ูุจู ุงุณุช):

```csharp
using System;
using System.Collections.Generic;
foreach (int fib in Fibs(6))
  Console.Write(fib + "  ");

IEnumerable<int> Fibs(int fibCount)
{
  for (int i = 0, prevFib = 1, curFib = 1; i < fibCount; i++)
  {
    yield return prevFib;
    int newFib = prevFib + curFib;
    prevFib = curFib;
    curFib = newFib;
  }
}
```

**ุฎุฑูุฌ:**

```
1  1  2  3  5  8
```

ุฏุฑ ุญุงู ฺฉู ุฏุณุชูุฑ `return` ูโฺฏูุฏ: **"ุงู ููุฏุงุฑ ุงุณุช ฺฉู ุงุฒ ุงู ูุชุฏ ุฎูุงุณุชู ุจูุฏ"**ุ ุฏุณุชูุฑ `yield return` ูโฺฏูุฏ: **"ุงู ุนูุตุฑ ุจุนุฏ ุงุณุช ฺฉู ุงุฒ ุงู ุดูุงุฑุดโฺฏุฑ ุฎูุงุณุชู ุจูุฏ"**.
ุฏุฑ ูุฑ ุฏุณุชูุฑ `yield`ุ ฺฉูุชุฑู ุจู ูุฑุงุฎูุงููุฏู ุจุฑูโฺฏุฑุฏุฏุ ุงูุง **ูุถุนุช ูุชุฏ ุญูุธ ูโุดูุฏ** ุชุง ููุช ูุฑุงุฎูุงููุฏู ุนูุตุฑ ุจุนุฏ ุฑุง ุฏุฑุฎูุงุณุช ฺฉุฑุฏุ ูุชุฏ ุงุฒ ููุงูโุฌุง ุงุฏุงูู ุงุจุฏ. ุงู ูุถุนุช ุจู ุนูุฑ ุดูุงุฑุดโฺฏุฑ ูุงุจุณุชู ุงุณุช ู ุจุนุฏ ุงุฒ ุงุชูุงู ูพูุงุด ุขุฒุงุฏ ูโุดูุฏ.

ฺฉุงููพุงูุฑ ูุชุฏูุง ูพูุงุดฺฏุฑ ุฑุง ุจู ฺฉูุงุณโูุง ุฎุตูุต ุชุจุฏู ูโฺฉูุฏ ฺฉู ูุงุณุทโูุง `IEnumerable<T>` ู/ุง `IEnumerator<T>` ุฑุง ูพุงุฏูโุณุงุฒ ูโฺฉููุฏ.
ููุทู ููุฌูุฏ ุฏุฑ ุจููฺฉ ูพูุงุดฺฏุฑ ุฏุฑ ูุชุฏ `MoveNext` ู ูฺฺฏ `Current` ฺฉูุงุณ ุชููุฏุดุฏู ุชูุณุท ฺฉุงููพุงูุฑ ูุฑุงุฑ ุฏุงุฏู ูโุดูุฏ. **ุงู ุนู ููุช ูุชุฏ ูพูุงุดฺฏุฑ ุฑุง ุตุฏุง ูโุฒูุฏุ ูฺ ฺฉุฏ ุงุฌุฑุง ููโุดูุฏุ ุชููุง ฺฉ ููููู ุงุฒ ฺฉูุงุณ ุณุงุฎุชู ูโุดูุฏ!**
ฺฉุฏ ุดูุง ุชููุง ููุช ุงุฌุฑุง ูโุดูุฏ ฺฉู ูพูุงุด ุดุฑูุน ุดูุฏุ ูุนูููุงู ุจุง ฺฉ ุนุจุงุฑุช `foreach`.

> ูพูุงุดฺฏุฑูุง ูโุชูุงููุฏ ูุชุฏูุง ูุญู (local methods) ูู ุจุงุดูุฏ (ุจุฎุด **"Local methods"** ุฏุฑ ุตูุญู 106 ุฑุง ุจุจูุฏ).

---

### ูุนูุง **Iterator** (ุชฺฉุฑุงุฑฺฉููุฏู) ๐

ฺฉ **Iterator** ุง ยซุชฺฉุฑุงุฑฺฉููุฏูยป ูุชุฏุ ูฺฺฏ (Property) ุง ุงูุฏฺฉุณุฑ ุงุณุช ฺฉู ุดุงูู ฺฉ ุง ฺูุฏ ุฏุณุชูุฑ `yield` ุงุณุช. ฺฉ **Iterator** ุจุงุฏ ฺฉ ุงุฒ ฺูุงุฑ ุฑุงุจุท (Interface) ุฒุฑ ุฑุง ุจุฑฺฏุฑุฏุงูุฏุ ุฏุฑ ุบุฑ ุงู ุตูุฑุช ฺฉุงููพุงูุฑ ุฎุทุง ุชููุฏ ูโฺฉูุฏ:

```csharp
// ุฑุงุจุทโูุง Enumerable
System.Collections.IEnumerable
System.Collections.Generic.IEnumerable<T>

// ุฑุงุจุทโูุง Enumerator
System.Collections.IEnumerator
System.Collections.Generic.IEnumerator<T>
```

**Iterator** ุจุณุชู ุจู ุงูฺฉู ฺฉ ุฑุงุจุท **Enumerable** ุง **Enumerator** ุจุฑูโฺฏุฑุฏุงูุฏุ ุฑูุชุงุฑ ูุชูุงูุช ุฏุงุฑุฏ. ุชูุถุญ ฺฉุงูู ุงู ููุถูุน ุฏุฑ ูุตู ท ุขูุฏู ุงุณุช.

---

### ุงุณุชูุงุฏู ุงุฒ ฺูุฏู ุฏุณุชูุฑ `yield`

ุฏุฑ ฺฉ **Iterator** ูโุชูุงู ฺูุฏู ุฏุณุชูุฑ `yield` ุงุณุชูุงุฏู ฺฉุฑุฏ:

```csharp
foreach (string s in Foo())
    Console.WriteLine(s); // ฺุงูพ ูโฺฉูุฏ: "One", "Two", "Three"

IEnumerable<string> Foo()
{
    yield return "One";
    yield return "Two";
    yield return "Three";
}
```

---

### ุงุณุชูุงุฏู ุงุฒ `yield break`

ุฏุฑ ฺฉ ุจููฺฉ **Iterator** ุงุณุชูุงุฏู ุงุฒ ุฏุณุชูุฑ `return` ูุฌุงุฒ ูุณุช. ุจุฑุง ุฎุฑูุฌ ุฒูุฏููฺฏุงู ุงุฒ **Iterator** (ุจุฏูู ุจุฑฺฏุฑุฏุงูุฏู ุนูุงุตุฑ ุจุดุชุฑ) ุจุงุฏ ุงุฒ `yield break` ุงุณุชูุงุฏู ฺฉูุฏ:

```csharp
IEnumerable<string> Foo(bool breakEarly)
{
    yield return "One";
    yield return "Two";
    if (breakEarly)
        yield break;
    yield return "Three";
}
```

---

### **Iteratorูุง** ู ุจููฺฉโูุง **try/catch/finally** โ๏ธ

* ุงุณุชูุงุฏู ุงุฒ `yield return` ุฏุฑ ฺฉ ุจููฺฉ `try` ฺฉู ุดุงูู ุจุฎุด `catch` ุจุงุดุฏุ **ูุฌุงุฒ ูุณุช**:

```csharp
IEnumerable<string> Foo()
{
    try { yield return "One"; } // ุบุฑูุฌุงุฒ
    catch { ... }
}
```

* ููฺูู ุงุณุชูุงุฏู ุงุฒ `yield return` ุฏุฑ ุจุฎุดโูุง `catch` ุง `finally` ูุฒ ูุฌุงุฒ ูุณุช.
  ุฏูู ุงู ูุญุฏูุฏุชโูุง ุงู ุงุณุช ฺฉู ฺฉุงููพุงูุฑ ุจุงุฏ **Iteratorูุง** ุฑุง ุจู ฺฉูุงุณโูุง ูุนููู ุจุง ูุชุฏูุง `MoveNext`ุ `Current` ู `Dispose` ุชุจุฏู ฺฉูุฏ ู ูุฏุฑุช ุจูุงฺฉโูุง ุฎุทุง ูพฺุฏฺฏ ุฒุงุฏ ุงุฌุงุฏ ูโฺฉูุฏ.

* ุงูุง ูโุชูุงูุฏ ุฏุฑ ุจููฺฉ `try` ฺฉู **ููุท** ุดุงูู ฺฉ ุจุฎุด `finally` ุงุณุช ุงุฒ `yield return` ุงุณุชูุงุฏู ฺฉูุฏ:

```csharp
IEnumerable<string> Foo()
{
    try { yield return "One"; } // ูุฌุงุฒ
    finally { ... }
}
```

ฺฉุฏ ููุฌูุฏ ุฏุฑ ุจููฺฉ `finally` ุฒูุงู ุงุฌุฑุง ูโุดูุฏ ฺฉู ุดูุงุฑูุฏู (**Enumerator**) ูุตุฑูโฺฉููุฏู ุจู ุงูุชูุง ุชูุงู ุจุฑุณุฏ ุง ุงุฒ ุจู ุจุฑูุฏ. ุฏุณุชูุฑ `foreach` ุจูโุตูุฑุช ุถูู ุดูุงุฑูุฏู ุฑุง Dispose ูโฺฉูุฏ ุงฺฏุฑ ุฒูุฏุชุฑ ุงุฒ ุญููู ุฎุงุฑุฌ ุดูุฏุ ุจูุงุจุฑุงู ุงู ุฑูุด ุงูู ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุดูุงุฑูุฏูโูุงุณุช.

---

### ุงุญุชุงุท ููฺฏุงู ุงุณุชูุงุฏู ุงุฒ **Enumeratorูุง** ุจูโุตูุฑุช ุฏุณุช ๐

ุงฺฏุฑ ุดูุงุฑูุฏู ุฑุง ุจูโุตูุฑุช ุฏุณุช ุงุณุชูุงุฏู ูโฺฉูุฏ ู ูุจู ุงุฒ ูพุงุงู ฺฉุงุฑ ุขู ุฑุง ุฑูุง ฺฉูุฏ ุจุฏูู ุงูฺฉู Dispose ฺฉูุฏุ ุจููฺฉ `finally` ุงุฌุฑุง ููโุดูุฏ. ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุงู ูุดฺฉูุ ุดูุงุฑูุฏูโูุง ุฑุง ุฏุฑูู ฺฉ ุฏุณุชูุฑ `using` ูุฑุงุฑ ุฏูุฏ:

```csharp
string firstElement = null;
var sequence = Foo();
using (var enumerator = sequence.GetEnumerator())
    if (enumerator.MoveNext())
        firstElement = enumerator.Current;
```

---

### ุชุฑฺฉุจ ุชูุงูโูุง (Composing Sequences) ๐งฉ

**Iteratorูุง** ูุงุจูุช ุชุฑฺฉุจ ุจุงูุง ุฏุงุฑูุฏ. ูุซุงู ุฒุฑ ุชููุง ุงุนุฏุงุฏ **ูุจููุงฺ ุฒูุฌ** ุฑุง ุชููุฏ ูโฺฉูุฏ:

```csharp
using System;
using System.Collections.Generic;

foreach (int fib in EvenNumbersOnly(Fibs(6)))
    Console.WriteLine(fib);

IEnumerable<int> Fibs(int fibCount)
{
    for (int i = 0, prevFib = 1, curFib = 1; i < fibCount; i++)
    {
        yield return prevFib;
        int newFib = prevFib + curFib;
        prevFib = curFib;
        curFib = newFib;
    }
}

IEnumerable<int> EvenNumbersOnly(IEnumerable<int> sequence)
{
    foreach (int x in sequence)
        if ((x % 2) == 0)
            yield return x;
}
```

ูฺฉุชู ููู ุงู ุงุณุช ฺฉู **ูุฑ ุนูุตุฑ ุฏููุงู ุฒูุงู ูุญุงุณุจู ูโุดูุฏ ฺฉู ุฏุฑุฎูุงุณุช ุดูุฏ**ุ ุนู ููุท ููฺฏุงู ูุฑุงุฎูุงู ูุชุฏ `MoveNext()` ููุฏุงุฑ ุฌุฏุฏ ุชููุฏ ูโุดูุฏ. (ุดฺฉู ด-ฑ ูุฑุขูุฏ ุฏุฑุฎูุงุณุช ู ุฎุฑูุฌ ุฏุงุฏูโูุง ุฑุง ุฏุฑ ุทูู ุฒูุงู ูุดุงู ูโุฏูุฏ.)

<div align="center">
    
![Conventions-UsedThis-Book](../../assets/image/04/Table-4-1.jpeg) 
</div>
