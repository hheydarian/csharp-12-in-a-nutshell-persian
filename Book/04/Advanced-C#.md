# ูุตู ฺูุงุฑู: ุณ ุดุงุฑูพ ูพุดุฑูุชู

ุฏุฑ ุงู ูุตูุ ุจู ุณุฑุงุบ ูุจุงุญุซ ูพุดุฑูุชู ุฒุจุงู C# ูโุฑูู ฺฉู ุจุฑ ูพุงู ููุงูู ุจูุง ุดุฏูโุงูุฏ ฺฉู ุฏุฑ ูุตูโูุง 2 ู 3 ุจุฑุฑุณ ฺฉุฑุฏู.
ฺูุงุฑ ุจุฎุด ุงูู ุฑุง ุจุงุฏ ุจู ุตูุฑุช ูพูุณุชู ู ูพุดุช ุณุฑ ูู ูุทุงูุนู ฺฉูุฏุ ุงูุง ุจุฎุดโูุง ุจุงูโูุงูุฏู ุฑุง ูโุชูุงูุฏ ุจู ูุฑ ุชุฑุชุจ ุจุฎูุงูุฏ.

### Delegates (ููุงูุฏฺฏุงู) ๐จ

ฺฉ delegate ฺฉ ุดุก ุงุณุช ฺฉู ูโุฏุงูุฏ ฺฺฏููู ฺฉ ูุชุฏ ุฑุง ูุฑุงุฎูุงู ฺฉูุฏ.

ููุน delegate ุชุนู ูโฺฉูุฏ ฺฉู ูููููโูุง delegate ูโุชูุงููุฏ ฺู ููุน ูุชุฏูุง ุฑุง ูุฑุงุฎูุงู ฺฉููุฏ. ุจู ุทูุฑ ูุดุฎุตุ ฺฉ delegate ููุน ุจุงุฒฺฏุดุช ูุชุฏ ู ุงููุงุน ูพุงุฑุงูุชุฑูุง ูุชุฏ ุฑุง ุชุนุฑู ูโฺฉูุฏ.

ูุซุงู: ุชุนุฑู ฺฉ ููุน delegate ุจู ูุงู Transformer:
```c#
delegate int Transformer(int x);
```

ุงู delegate ุจุง ูุฑ ูุชุฏ ฺฉู ุจุงุฒฺฏุดุช ุงุฒ ููุน int ุฏุงุดุชู ุจุงุดุฏ ู ฺฉ ูพุงุฑุงูุชุฑ int ุจฺฏุฑุฏ ุณุงุฒฺฏุงุฑ ุงุณุช. ูุซู ุงู:
```c#
int Square(int x) { return x * x; }
```

ุง ุจู ุตูุฑุช ฺฉูุชุงูโุชุฑ (expression-bodied):
```c#
int Square(int x) => x * x;
```
**ุณุงุฎุชู ู ุงุณุชูุงุฏู ุงุฒ ฺฉ delegate ๐๏ธ**

ุงุฎุชุตุงุต ฺฉ ูุชุฏ ุจู ฺฉ ูุชุบุฑ delegateุ ุจุงุนุซ ุงุฌุงุฏ ฺฉ ููููู delegate ูโุดูุฏ:
```c#
Transformer t = Square;
```

ูุฑุงุฎูุงู ฺฉ ููููู delegate ุฏููุงู ูุซู ูุฑุงุฎูุงู ฺฉ ูุชุฏ ุงุณุช:
```c#
int answer = t(3);   // answer ุจุฑุงุจุฑ ุจุง 9
```

ูุซุงู ฺฉุงูู:
```c#
Transformer t = Square;   // ุงุฌุงุฏ ููููู delegate
int result = t(3);        // ูุฑุงุฎูุงู delegate
Console.WriteLine(result); // ุฎุฑูุฌ: 9

int Square(int x) => x * x;

delegate int Transformer(int x);  // ุชุนุฑู ููุน delegate
```
**ููููู ุงุตู delegate ๐ฏ**

ฺฉ ููููู delegate ูุงูุนุงู ุจู ุนููุงู ููุงูุฏูโ caller ุนูู ูโฺฉูุฏ:
caller (ูุฑุงุฎูุงููุฏู) delegate ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏ ู ุณูพุณ delegateุ ูุชุฏ ูุฏู ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏ.

ุงู ูุงุณุทูโฺฏุฑ (indirection) ุจุงุนุซ ูโุดูุฏ ฺฉู caller ุงุฒ ูุชุฏ ูุฏู ุฌุฏุง ู ูุณุชูู ุจุงุดุฏ.

**ูฺฉุชูโูุง ููู โ**

ุฏุณุชูุฑ:
```
Transformer t = Square;
```

ุฏุฑ ูุงูุน ฺฉ ูุงูโุจูุฑ (shorthand) ุจุฑุง ุงู ุงุณุช:
```c#
Transformer t = new Transformer(Square);
```

ุนุจุงุฑุช:
```
t(3)
```

ูุงูโุจูุฑ ุงุณุช ุจุฑุง:
```
t.Invoke(3)
```

ุงุฒ ูุธุฑ ููุ ููุช ุจู Square ุจุฏูู ูพุฑุงูุชุฒ ู ุขุฑฺฏููุงู ุงุดุงุฑู ูโฺฉููุ ุฏุฑ ุญุงู ูุดุฎุต ฺฉุฑุฏู ฺฉ method group ูุณุชู.
ุงฺฏุฑ ูุชุฏ overload ุดุฏู ุจุงุดุฏุ ฺฉุงููพุงูุฑ C# ุจุฑ ุงุณุงุณ ุงูุถุง delegate ุงูุชุฎุงุจ ูโฺฉูุฏ ฺฉู ฺฉุฏุงู overload ููุงุณุจ ุงุณุช.

**Delegate ุดุจู ุจู Callback ๐**


ฺฉ delegate ูุดุงุจู ฺุฒ ุงุณุช ฺฉู ุฏุฑ ุงุตุทูุงุญ ุนููู callback ูุงูุฏู ูโุดูุฏ.
ุงู ููููู ุณุงุฒูโูุง ูุซู function pointers ุฏุฑ ุฒุจุงู C ุฑุง ูุฒ ุฏุฑ ุจุฑ ูโฺฏุฑุฏ.

### ููุดุชู ูุชุฏูุง ูพูุงฺฏู ุจุง ุงุณุชูุงุฏู ุงุฒ Delegateูุง โจ

ฺฉ ูุชุบุฑ ุงุฒ ููุน delegate ุฏุฑ ุฒูุงู ุงุฌุฑุง (runtime) ุจู ฺฉ ูุชุฏ ูุณุจุช ุฏุงุฏู ูโุดูุฏ. ุงู ูฺฺฏ ุจุฑุง ููุดุชู ูุชุฏูุง ูพูุงฺฏู (plug-in methods) ุจุณุงุฑ ฺฉุงุฑุจุฑุฏ ุงุณุช.

ุฏุฑ ูุซุงู ุฒุฑุ ูุง ฺฉ ูุชุฏ ฺฉูฺฉ (utility method) ุจู ูุงู Transform ุฏุงุฑู ฺฉู ฺฉ ุนูู transform ุฑุง ุฑู ูุฑ ุนุถู ุงุฒ ฺฉ ุขุฑุงูโ ุนุฏุฏ (integer array) ุงุนูุงู ูโฺฉูุฏ. ุงู ูุชุฏ Transform ฺฉ ูพุงุฑุงูุชุฑ ุงุฒ ููุน delegate ุฏุงุฑุฏ ฺฉู ูโุชูุงูุฏ ุจุฑุง ูุดุฎุต ฺฉุฑุฏู ูพูุงฺฏู transform ุงุฒ ุขู ุงุณุชูุงุฏู ฺฉูุฏ:
```c#
int[] values = { 1, 2, 3 };
Transform (values, Square);      // ุงุชุตุงู ูุชุฏ Square ุจู Transform
foreach (int i in values)
  Console.Write (i + "  ");      // ุฎุฑูุฌ: 1   4   9

void Transform (int[] values, Transformer t)
{
  for (int i = 0; i < values.Length; i++)
    values[i] = t (values[i]);
}

int Square (int x) => x * x;
int Cube (int x) => x * x * x;

delegate int Transformer (int x);
```

๐น ุฏุฑ ุงูุฌุง ุงฺฏุฑ ุฏุฑ ุฎุท ุฏูู ุจูโุฌุง Square ุงุฒ Cube ุงุณุชูุงุฏู ฺฉููุ ุชุจุฏู ุฑู ุงุนุฏุงุฏ ุจูโุตูุฑุช ูฺฉุนุจ (ุชูุงู ุณูู) ุงูุฌุงู ูโุดูุฏ.

๐น ูุชุฏ Transform ฺฉ higher-order function ุงุณุชุ ฺูู ฺฉ ุชุงุจุน (delegate) ุฑุง ุจูโุนููุงู ุขุฑฺฏููุงู ูโฺฏุฑุฏ. (ูุฑ ูุชุฏ ฺฉู ฺฉ delegate ุฑุง ุจุฑฺฏุฑุฏุงูุฏ ูุฒ ฺฉ higher-order function ูุญุณูุจ ูโุดูุฏ.)

### ุงูุฏุงู ูุชุฏ ุฏุฑ Delegateูุง: Instance ู Static โก

ฺฉ ูุชุฏ ูุฏู (target method) ุจุฑุง ฺฉ delegate ูโุชูุงูุฏ ูุญู (local)ุ ุงุณุชุง (static) ุง ูููููโุง (instance) ุจุงุดุฏ.

ูุซุงู ฺฉ ูุชุฏ static ุจูโุนููุงู ูุฏู delegate:
```c#
Transformer t = Test.Square;
Console.WriteLine (t(10));      // 100

class Test 
{ 
    public static int Square (int x) => x * x; 
}

delegate int Transformer (int x);
```
ูุซุงู ฺฉ ูุชุฏ instance ุจูโุนููุงู ูุฏู delegate:
```c#
Test test = new Test();
Transformer t = test.Square;
Console.WriteLine (t(10));      // 100

class Test 
{ 
    public int Square (int x) => x * x; 
}

delegate int Transformer (int x);
```

๐ ุฒูุงู ฺฉู ฺฉ ูุชุฏ instance ุจู ฺฉ delegate ุงุฎุชุตุงุต ุฏุงุฏู ูโุดูุฏุ ุขู delegate ููุท ุจู ุฎูุฏ ูุชุฏ ุงุดุงุฑู ููโฺฉูุฏุ ุจูฺฉู ูููููโุง ุงุฒ ฺฉูุงุณ ฺฉู ูุชุฏ ุจู ุขู ุชุนูู ุฏุงุฑุฏ ุฑุง ูู ูฺฏูโุฏุงุฑ ูโฺฉูุฏ.

**ุฎุงุตุช Target ุฏุฑ ฺฉูุงุณ System.Delegate ๐ฏ**

ฺฉูุงุณ System.Delegate ฺฉ ูฺฺฏ ุจู ูุงู Target ุฏุงุฑุฏ ฺฉู ุงู ููููู (instance) ุฑุง ูุดุงู ูโุฏูุฏ (ู ุงฺฏุฑ delegate ุจู ฺฉ ูุชุฏ static ุงุดุงุฑู ฺฉูุฏุ ููุฏุงุฑุด null ุฎูุงูุฏ ุจูุฏ).

ูุซุงู:
```c#
MyReporter r = new MyReporter();
r.Prefix = "%Complete: ";

ProgressReporter p = r.ReportProgress;
p(99);                                 // %Complete: 99

Console.WriteLine (p.Target == r);     // True
Console.WriteLine (p.Method);          // Void ReportProgress(Int32)

r.Prefix = "";
p(99);                                 // 99

public delegate void ProgressReporter (int percentComplete);

class MyReporter
{
  public string Prefix = "";
  public void ReportProgress (int percentComplete)
    => Console.WriteLine (Prefix + percentComplete);
}
```

โ ฺูู ููููู (instance) ุฏุฑ ุฎุงุตุช Target ุฐุฎุฑู ูโุดูุฏุ ุทูู ุนูุฑ ุขู ุญุฏุงูู ุจู ุงูุฏุงุฒู ุทูู ุนูุฑ delegate ฺฏุณุชุฑุด ูโุงุจุฏ.

๐ ุฌูุนโุจูุฏ:

+ Delegateูุง ุจู ูุง ุงุฌุงุฒู ูโุฏููุฏ ฺฉู ูุชุฏูุง ุฑุง ูุซู ูุชุบุฑูุง ูพุงุณ ุจุฏูู.

+ ูโุชูุงููุฏ ุจู ูุชุฏูุง static ุง instance ูุชุตู ุดููุฏ.

+ ุฎุงุตุช Target ุชุถูู ูโฺฉูุฏ ฺฉู ููููู ูุฑุจูุท ุจู ูุชุฏ instance ุชุง ููุช delegate ุฒูุฏู ุงุณุชุ ุจุงู ุจูุงูุฏ.

๐ก ุงู ููููู ูพุงูโุง ุฏุฑ ุทุฑุงุญ ูพูุงฺฏูโูุงุ ฺฉุงูโุจฺฉโูุง ู ุจุฑูุงููโููุณ ุดุกฺฏุฑุงุณุช.
### ููุงูุฏฺฏุงู ฺูุฏูพุฎุด (Multicast Delegates) ๐ฏ

ุชูุงู ูููููโูุง delegate ุฏุฑ ุณโุดุงุฑูพ ุฏุงุฑุง ูุงุจูุช ฺูุฏูพุฎุด (multicast) ูุณุชูุฏ. ุงู ุนู ฺฉ ูููููโ delegate ูโุชูุงูุฏ ูู ููุท ุจู ฺฉ ูุชุฏุ ุจูฺฉู ุจู ฺฉ ูุณุช ุงุฒ ูุชุฏูุง ุงุดุงุฑู ฺฉูุฏ.

ุนููฺฏุฑูุง + ู += ุจุฑุง ุชุฑฺฉุจ ฺฉุฑุฏู ูููููโูุง delegate ุงุณุชูุงุฏู ูโุดููุฏ:
```c#
SomeDelegate d = SomeMethod1;
d += SomeMethod2;
```

ุฎุท ุขุฎุฑ ุงุฒ ูุธุฑ ุนููฺฉุฑุฏ ุฏููุงู ูุนุงุฏู ุงู ุงุณุช:
```c#
d = d + SomeMethod2;
```

ุงฺฉููู ููุช d ูุฑุงุฎูุงู ุดูุฏุ ูู SomeMethod1 ู ูู SomeMethod2 ุงุฌุฑุง ูโุดููุฏ.
โ ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ูุชุฏูุง ุจู ุชุฑุชุจ ฺฉู ุงุถุงูู ุดุฏูโุงูุฏ ูุฑุงุฎูุงู ูโุดููุฏ.

ุนููฺฏุฑูุง - ู -= ูู ุจุฑุง ุญุฐู ฺฉ ูุชุฏ ุงุฒ ูุณุช ูุชุฏูุง ฺฉ delegate ุงุณุชูุงุฏู ูโุดููุฏ:
```
d -= SomeMethod1;
```

ุงฺฉููู ูุฑุงุฎูุงู d ุจุงุนุซ ูโุดูุฏ ููุท SomeMethod2 ุงุฌุฑุง ุดูุฏ.

๐ ูฺฉุชู ููู:

+ ููุช ุฑู ฺฉ ูุชุบุฑ delegate ฺฉู ููุฏุงุฑุด null ุงุณุชุ ุนูู + ุง += ุงูุฌุงู ุฏูุฏุ ุจุงุฒ ูู ฺฉุงุฑ ูโฺฉูุฏ ู ูุนุงุฏู ุงู ุงุณุช ฺฉู ุจู ุขู ููุฏุงุฑ ุฌุฏุฏ ุจุฏูุฏ:
```c#
SomeDelegate d = null;
d += SomeMethod1;   // ูุนุงุฏู ุจุง: d = SomeMethod1 ููุช d ุจุฑุงุจุฑ null ุงุณุช
```

+ ุจู ุทูุฑ ูุดุงุจูุ ุงฺฏุฑ ุฑู ฺฉ delegate ฺฉู ููุท ฺฉ ูุชุฏ ุฑุง ูฺฏู ุฏุงุดุชู ุจุงุดุฏ ุนูู -= ฺฉูุฏุ ูุชุฌูโุงุด ูุนุงุฏู ุงุฎุชุตุงุต ููุฏุงุฑ null ุจู ุขู ูุชุบุฑ ุฎูุงูุฏ ุจูุฏ.

โก ฺฉ ูฺฉุชู ููู ุฏฺฏุฑ:
Delegates ุฏุฑ ุณโุดุงุฑูพ immutable ูุณุชูุฏ. ุนู ููุช ุดูุง += ุง -= ุฑุง ุงุณุชูุงุฏู ูโฺฉูุฏุ ุฏุฑ ูุงูุน ฺฉ ูููููโ ุฌุฏุฏ ุงุฒ delegate ุณุงุฎุชู ูโุดูุฏ ู ุจู ูุชุบุฑ ููุฌูุฏ ุงุฎุชุตุงุต ุฏุงุฏู ูโุดูุฏ.

๐ข ุงฺฏุฑ ฺฉ delegate ฺูุฏูพุฎุด (multicast delegate) ุฏุงุฑุง ููุน ุจุงุฒฺฏุดุช ุบุฑ ุงุฒ void ุจุงุดุฏุ ููุฏุงุฑ ุจุงุฒฺฏุดุช ฺฉู ุดูุง ุฏุฑุงูุช ูโฺฉูุฏ ูุฑุจูุท ุจู ุขุฎุฑู ูุชุฏ ุงุณุช ฺฉู ุงุฌุฑุง ุดุฏู ุงุณุช. ูุชุฏูุง ูุจู ููฺูุงู ุงุฌุฑุง ูโุดููุฏุ ุงูุง ููุฏุงุฑ ุจุงุฒฺฏุดุช ุขูโูุง ูุงุฏุฏู ฺฏุฑูุชู ูโุดูุฏ.
(ุจู ููู ุฏููุ ุฏุฑ ุจุดุชุฑ ููุงุฑุฏ ฺฉู ุงุฒ multicast delegate ุงุณุชูุงุฏู ูโุดูุฏุ ุขูโูุง void ุจุฑูโฺฏุฑุฏุงููุฏ.)

๐งฉ ุชูุงู ุงููุงุน delegate ุจู ุทูุฑ ุถูู ุงุฒ System.MulticastDelegate ุงุฑุซโุจุฑ ูโฺฉููุฏ ฺฉู ุฎูุฏุด ุงุฒ System.Delegate ุงุฑุซโุจุฑ ูโฺฉูุฏ.
ฺฉุงููพุงูุฑ ุณโุดุงุฑูพ ุชูุงู ุนููุงุช +ุ -ุ += ู -= ุฑู delegateูุง ุฑุง ุจู ูุชุฏูุง ุงุณุชุงุชฺฉ Combine ู Remove ุงุฒ ฺฉูุงุณ System.Delegate ุชุจุฏู ูโฺฉูุฏ.
#### ูุซุงู Multicast Delegate ๐๏ธ

ูุฑุถ ฺฉูุฏ ฺฉ ูุชุฏ ููุดุชูโุงุฏ ฺฉู ุงุฌุฑุง ุขู ุฒูุงู ุฒุงุฏ ูโุจุฑุฏ. ุงู ูุชุฏ ูโุชูุงูุฏ ุจู ุทูุฑ ููุธู ูุฒุงู ูพุดุฑูุช ฺฉุงุฑ ุฑุง ุจู ูุฑุงุฎูุงููุฏู ฺฏุฒุงุฑุด ุฏูุฏุ ุงู ฺฉุงุฑ ุจุง ูุฑุงุฎูุงู ฺฉ delegate ุงูุฌุงู ูโุดูุฏ.

ุฏุฑ ูุซุงู ุฒุฑุ ูุชุฏ HardWork ฺฉ ูพุงุฑุงูุชุฑ ุงุฒ ููุน delegate ุจู ูุงู ProgressReporter ุฏุฑุงูุช ูโฺฉูุฏ ู ุงุฒ ุขู ุจุฑุง ูุดุงู ุฏุงุฏู ูพุดุฑูุช ุงุณุชูุงุฏู ูโฺฉูุฏ:
```c#
public delegate void ProgressReporter(int percentComplete);

public class Util
{
    public static void HardWork(ProgressReporter p)
    {
        for (int i = 0; i < 10; i++)
        {
            p(i * 10);                           // ูุฑุงุฎูุงู delegate
            System.Threading.Thread.Sleep(100);  // ุดุจูโุณุงุฒ ฺฉุงุฑ ุณูฺฏู
        }
    }
}
```

ุจุฑุง ูุงูุชูุฑ ฺฉุฑุฏู ูุฒุงู ูพุดุฑูุชุ ูโุชูุงูู ฺฉ ูููููโ Multicast Delegate ุจู ูุงู p ุจุณุงุฒู ุชุง ูพุดุฑูุช ููโุฒูุงู ุชูุณุท ุฏู ูุชุฏ ูุณุชูู ุจุฑุฑุณ ุดูุฏ:
```c#
ProgressReporter p = WriteProgressToConsole;
p += WriteProgressToFile;

Util.HardWork(p);

void WriteProgressToConsole(int percentComplete)
    => Console.WriteLine(percentComplete);

void WriteProgressToFile(int percentComplete)
    => System.IO.File.WriteAllText("progress.txt",
                                    percentComplete.ToString());
```

๐ ุฏุฑ ุงูุฌุง ฺู ุงุชูุงู ูโุงูุชุฏุ

1. ุงุจุชุฏุง ฺฉ delegate ุงุฒ ููุน ProgressReporter ุณุงุฎุชู ูโุดูุฏ ู ุจู ูุชุฏ WriteProgressToConsole ุงุดุงุฑู ูโฺฉูุฏ.

2. ุณูพุณ ุจุง ุนููฺฏุฑ +=ุ ูุชุฏ WriteProgressToFile ูู ุจู ุขู ุงุถุงูู ูโุดูุฏ.
ุนู delegate p ุงฺฉููู ฺฉ multicast delegate ุงุณุช.

3. ูุฑ ุจุงุฑ ฺฉู ูุชุฏ HardWork ูพุดุฑูุช ุฑุง ฺฏุฒุงุฑุด ูโุฏูุฏ (p(i * 10))ุ ูุฑ ุฏู ูุชุฏ ุงุฌุฑุง ูโุดููุฏ:

+ WriteProgressToConsole ููุฏุงุฑ ูพุดุฑูุช ุฑุง ุฑู ฺฉูุณูู ฺุงูพ ูโฺฉูุฏ.

+ WriteProgressToFile ููุฏุงุฑ ูพุดุฑูุช ุฑุง ุฏุฑ ฺฉ ูุงู progress.txt ุฐุฎุฑู ูโฺฉูุฏ.

๐ ูุชุฌู ููุง:

+ ุดูุง ููุฒูุงู ุฏุฑ ฺฉูุณูู ูโุจูุฏ ฺฉู ูพุดุฑูุช ฺฉุงุฑ ฺูุฏ ุฏุฑุตุฏ ุงุณุช.

+ ฺฉ ูุงู ูุชู ูู ุฏุงุฑุฏ ฺฉู ููุงู ุงุทูุงุนุงุช ุฑุง ุฐุฎุฑู ูโฺฉูุฏ.

### ุงููุงุน Delegate ุนููู (Generic Delegate Types) โก

ฺฉ delegate ูโุชูุงูุฏ ุดุงูู ูพุงุฑุงูุชุฑูุง ุนููู (Generic Type Parameters) ุจุงุดุฏ:
```c#
public delegate T Transformer<T>(T arg);
```

ุจุง ฺูู ุชุนุฑู ูโุชูุงูู ฺฉ ูุชุฏ ุงุจุฒุงุฑ ุนููู (Utility Method) ุจููุณู ฺฉู ุฑู ูุฑ ููุน ุฏุงุฏูโุง ฺฉุงุฑ ฺฉูุฏ:
```c#
int[] values = { 1, 2, 3 };
Util.Transform(values, Square);      // ุงุชุตุงู ูุชุฏ Square

foreach (int i in values)
    Console.Write(i + "  ");         // ุฎุฑูุฌ: 1   4   9

int Square(int x) => x * x;

public class Util
{
    public static void Transform<T>(T[] values, Transformer<T> t)
    {
        for (int i = 0; i < values.Length; i++)
            values[i] = t(values[i]);
    }
}
```
### Delegates ุขูุงุฏู: Func ู Action โ

ุจุง ูุนุฑู generic delegatesุ ุงู ุงูฺฉุงู ูุฑุงูู ุดุฏ ฺฉู ูุฌููุนูโุง ฺฉูฺฺฉ ุงุฒ delegateูุง ุทุฑุงุญ ุดููุฏ ฺฉู ุขูโูุฏุฑ ุนููู ู ุงูุนุทุงูโูพุฐุฑ ุจุงุดูุฏ ฺฉู ุจุฑุง ูุชุฏูุง ุจุง ูุฑ ููุน ุฎุฑูุฌ ู ูุฑ ุชุนุฏุงุฏ (ูุนููู) ุขุฑฺฏููุงู ูุงุจู ุงุณุชูุงุฏู ุจุงุดูุฏ.

ุงู delegateูุง ููุงู Func ู Action ูุณุชูุฏ ฺฉู ุฏุฑ ูุถุง ูุงู System ุชุนุฑู ุดุฏูโุงูุฏ:
```c#
delegate TResult Func<out TResult>();                
delegate TResult Func<in T, out TResult>(T arg);          
delegate TResult Func<in T1, in T2, out TResult>(T1 arg1, T2 arg2);
// ... ุงุฏุงูู ุฏุงุฑุฏ ุชุง 16 ูพุงุฑุงูุชุฑ

delegate void Action();
delegate void Action<in T>(T arg);
delegate void Action<in T1, in T2>(T1 arg1, T2 arg2);
// ... ุงุฏุงูู ุฏุงุฑุฏ ุชุง 16 ูพุงุฑุงูุชุฑ
```


๐ ุงูโูุง ุจุณุงุฑ ุนููู ู ูุฏุฑุชููุฏ ูุณุชูุฏ.

**ุฌุงฺฏุฒู Transformer ุจุง Func ๐**

ุฏุฑ ูุซุงู ูุจูุ ุจู ุฌุง ุชุนุฑู delegate ุงุฎุชุตุงุต Transformerุ ูโุชูุงูุณุชู ุงุฒ Func ุงุณุชูุงุฏู ฺฉูู:
```c#
public static void Transform<T>(T[] values, Func<T, T> transformer)
{
    for (int i = 0; i < values.Length; i++)
        values[i] = transformer(values[i]);
}
```

ุฏุฑ ุงูุฌุง:

+ Func<T, T> ุนู ฺฉ delegate ฺฉู ฺฉ ูุฑูุฏ ุงุฒ ููุน T ูโฺฏุฑุฏ ู ุฎุฑูุฌ ูู ุงุฒ ููุงู ููุน T ุจุฑูโฺฏุฑุฏุงูุฏ.

+ ุฏููุงู ููุงู ฺุฒ ุงุณุช ฺฉู ูุจูุงู ุจุง Transformer<T> ุณุงุฎุชู ุจูุฏู.

**ูุญุฏูุฏุชโูุง ๐ง**

ุชููุง ุณูุงุฑููุง ุนูู ฺฉู Func ู Action ูพูุดุด ููโุฏููุฏุ ููุงุฑุฏ ูุณุชูุฏ ฺฉู ุดุงูู ูพุงุฑุงูุชุฑูุง ref/out ุง pointer ุจุงุดูุฏ.

**ูฺฉุชู ุชุงุฑุฎ ๐ฐ๏ธ**

ุฒูุงู ฺฉู C# ุจุฑุง ุงููู ุจุงุฑ ูุนุฑู ุดุฏุ ูููุฒ generics ูุฌูุฏ ูุฏุงุดุช. ุจู ููู ุฏููุ Func ู Action ูู ูุฌูุฏ ูุฏุงุดุชูุฏ.
ุจู ููู ุฎุงุทุฑุ ุจุฎุด ุฒุงุฏ ุงุฒ ฺฉุชุงุจุฎุงููโ .NET ุงุฒ delegateูุง ุณูุงุฑุด ุงุณุชูุงุฏู ูโฺฉูุฏุ ูู ุงุฒ Func ู Action.

### ููุงุณู Delegateโูุง ู Interfaceโูุง โ๏ธ

ูุฑ ูุณุฆููโุง ฺฉู ุจุง ฺฉ delegate ุญู ูโุดูุฏุ ูโุชูุงูุฏ ุจุง ฺฉ interface ูู ุญู ุดูุฏ.

ุจูโุนููุงู ูุซุงูุ ูโุชูุงูู ูููููโ ุงูููโูุงู ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ ฺฉ interface ุจู ูุงู ITransformer ุจุงุฒููุณ ฺฉููุ ุจู ุฌุง ุงูฺฉู ุงุฒ delegate ุงุณุชูุงุฏู ฺฉูู:
```c#
int[] values = { 1, 2, 3 };
Util.TransformAll(values, new Squarer());

foreach (int i in values)
    Console.WriteLine(i);

public interface ITransformer
{
    int Transform(int x);
}

public class Util
{
    public static void TransformAll(int[] values, ITransformer t)
    {
        for (int i = 0; i < values.Length; i++)
            values[i] = t.Transform(values[i]);
    }
}

class Squarer : ITransformer
{
    public int Transform(int x) => x * x;
}
```
ฺู ุฒูุงู delegate ุงูุชุฎุงุจ ุจูุชุฑ ุงุฒ interface ุงุณุชุ โ

ุทุฑุงุญ ุจุง delegate ููฺฉู ุงุณุช ุงูุชุฎุงุจ ุจูุชุฑ ุจุงุดุฏ ุงฺฏุฑ ฺฉ ุง ฺูุฏ ููุฑุฏ ุฒุฑ ุจุฑูุฑุงุฑ ุจุงุดูุฏ:

+ ๐น interface ููุท ฺฉ ูุชุฏ ุชุนุฑู ฺฉุฑุฏู ุจุงุดุฏ.

+ ๐น ูุงุฒ ุจู multicast (ุงุชุตุงู ฺูุฏ ูุชุฏ ุจู ฺฉ delegate) ุฏุงุดุชู ุจุงุดู.

+ ๐น ฺฉ subscriber ูุฌุจูุฑ ุจุงุดุฏ ฺูุฏ ุจุงุฑ ฺฉ interface ุฑุง ูพุงุฏูโุณุงุฒ ฺฉูุฏ.

**ุจุฑุฑุณ ูุซุงู ๐**

ุฏุฑ ูุซุงู ITransformer:

+ ูุง ูุงุฒ ุจู multicast ูุฏุงุฑู.

+ ุงูุง interface ููุท ฺฉ ูุชุฏ (Transform) ุชุนุฑู ฺฉุฑุฏู ุงุณุช.

+ ุงุฒ ุทุฑู ููฺฉู ุงุณุช ุจุฎูุงูู ฺูุฏู ุชุจุฏู ูุฎุชูู (ูุซูุงู ูุฑุจุน ุง ูฺฉุนุจ) ุฑุง ูพุงุฏูโุณุงุฒ ฺฉูู.

ุฏุฑ ฺูู ุญุงูุชุ ุงฺฏุฑ ุงุฒ interface ุงุณุชูุงุฏู ฺฉููุ ูุฌุจูุฑ ูโุดูู ุจุฑุง ูุฑ ุชุจุฏู ฺฉ ฺฉูุงุณ ุฌุฏุงฺฏุงูู ุจุณุงุฒูุ ฺูู ฺฉ ฺฉูุงุณ ููุท ฺฉ ุจุงุฑ ูโุชูุงูุฏ ITransformer ุฑุง ูพุงุฏูโุณุงุฒ ฺฉูุฏ. ุงู ฺฉุงุฑ ุฏุณุชโููพุงฺฏุฑ ู ุชฺฉุฑุงุฑ ูโุดูุฏ.

ูุซูุงู:
```c#
int[] values = { 1, 2, 3 };
Util.TransformAll(values, new Cuber());

foreach (int i in values)
    Console.WriteLine(i);

class Squarer : ITransformer
{
    public int Transform(int x) => x * x;
}

class Cuber : ITransformer
{
    public int Transform(int x) => x * x * x;
}
```

๐ ูุชุฌู:

+ ุจุง delegateูุงุ ูพุงุฏูโุณุงุฒ ุณุงุฏูโุชุฑ ู ููุนุทูโุชุฑ ุงุณุช (ูโุชูุงูู ุจูโุฑุงุญุช ูุชุฏูุง ูุฎุชูู ูุซู ูุฑุจุน ุง ูฺฉุนุจ ุฑุง ูพุงุณ ุจุฏูู).

+ ุจุง interfaceูุงุ ูุฌุจูุฑู ุจุฑุง ูุฑ ุนููฺฏุฑ ฺฉ ฺฉูุงุณ ุฌุฏุฏ ุจุณุงุฒู.
  
### ุณุงุฒฺฏุงุฑ Delegate ูุง โ๏ธ

#### ุณุงุฒฺฏุงุฑ ููุน (Type Compatibility) ๐ท๏ธ

ุชูุงู ููุนโูุง delegate ุจุง ูู ูุงุณุงุฒฺฏุงุฑ ูุณุชูุฏุ ุญุช ุงฺฏุฑ ุงูุถุง (signature) ุขูโูุง ฺฉ ุจุงุดุฏ:
```c#
D1 d1 = Method1;
D2 d2 = d1;   // โ ุฎุทุง ุฒูุงู ฺฉุงููพุงู

void Method1() { }

delegate void D1();
delegate void D2();
```

๐น ุงูุง ุงู ุญุงูุช ูุฌุงุฒ ุงุณุช:
```
D2 d2 = new D2(d1);   // โ ุฏุฑุณุช
```
**ููุงุณูโ ุจุฑุงุจุฑ (Equality) โ**

ุฏู ูููููโ delegate ููุช ุจุฑุงุจุฑ ูุญุณูุจ ูโุดููุฏ ฺฉู ุจู ฺฉ ูุชุฏ ฺฉุณุงู ุงุดุงุฑู ฺฉููุฏ:
```c#
D d1 = Method1;
D d2 = Method1;

Console.WriteLine(d1 == d2);   // True

void Method1() { }

delegate void D();
```

๐น ุฏุฑ ููุฑุฏ multicast delegateโูุง ููุ ุจุฑุงุจุฑ ููุช ุจุฑูุฑุงุฑ ุงุณุช ฺฉู ุจู ููุงู ูุชุฏูุง ู ุจู ููุงู ุชุฑุชุจ ุงุดุงุฑู ฺฉููุฏ.

#### ุณุงุฒฺฏุงุฑ ูพุงุฑุงูุชุฑ (Parameter Compatibility) ๐

ููุช ฺฉ ูุชุฏ ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏุ ูโุชูุงูุฏ ุขุฑฺฏููุงู ุจุฏูุฏ ฺฉู ุงุฒ ููุน ุฎุงุตโุชุฑ ุงุฒ ูพุงุฑุงูุชุฑ ูุชุฏ ุจุงุดุฏ. ุงู ุฑูุชุงุฑ ูุนููู polymorphism ุงุณุช.

ุจู ููู ุฏููุ ฺฉ delegate ูู ูโุชูุงูุฏ ูพุงุฑุงูุชุฑูุง ุฎุงุตโุชุฑ ุงุฒ ูุชุฏ ูุฏู ุฎูุฏ ุฏุงุดุชู ุจุงุดุฏ. ุงู ูฺฺฏ ุฑุง contravariance ูโูุงููุฏ.

ูุซุงู:
```c#
StringAction sa = new StringAction(ActOnObject);
sa("hello");

void ActOnObject(object o) => Console.WriteLine(o);   // ุฎุฑูุฌ: hello

delegate void StringAction(string s);
```

๐น ุฏุฑ ุงูุฌุง StringAction ฺฉ ูุชุฏ ุฑุง ุจุง ูพุงุฑุงูุชุฑ string ูุฑุงุฎูุงู ูโฺฉูุฏ.
๐น ุงูุง ูุชุฏ ฺฉู ูุงูุนุง ุงุฌุฑุง ูโุดูุฏ (ActOnObject) ูพุงุฑุงูุชุฑุด ุงุฒ ููุน object ุงุณุช.
๐น ุฏุฑ ุงู ุญุงูุชุ ุขุฑฺฏููุงู string ุจูโุทูุฑ ุฎูุฏฺฉุงุฑ ุชุจุฏู ุจู object (upcast) ูโุดูุฏ.

**3. ุงุฑุชุจุงุท ุจุง ุงูฺฏู ุงุณุชุงูุฏุงุฑุฏ Event ๐ฏ**

ุงูฺฏู ุงุณุชุงูุฏุงุฑุฏ event ุฏุฑ C# ุทูุฑ ุทุฑุงุญ ุดุฏู ุงุณุช ฺฉู ุงุฒ contravariance ุงุณุชูุงุฏู ฺฉูุฏ.

+ ูููโ ฺฉูุงุณโูุง ุฑูุฏุงุฏ ุงุฒ ฺฉูุงุณ ูพุงูโ ูุดุชุฑฺฉ EventArgs ุงุฑุซโุจุฑ ูโฺฉููุฏ.

+ ุจูุงุจุฑุงู ูโุชูุงูุฏ ฺฉ ูุชุฏ ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุชูุณุท ุฏู delegate ูุฎุชูู ูุฑุงุฎูุงู ุดูุฏ:

     + ฺฉ ุฑูุฏุงุฏ MouseEventArgs ูพุงุณ ุจุฏูุฏ ๐ฑ๏ธ

     + ุฏฺฏุฑ KeyEventArgs ูพุงุณ ุจุฏูุฏ โจ๏ธ

ุงู ฺฉุงุฑ ุงูุนุทุงูโูพุฐุฑ ุจุงูุง ุฏุฑ ูุฏุฑุช ุฑูุฏุงุฏูุง ุจู ุดูุง ูโุฏูุฏ.

๐ ุฎูุงุตู:

+ delegate type ูุง ุญุช ุจุง ุงูุถุง ฺฉุณุงู ูู ูุงุณุงุฒฺฏุงุฑ ูุณุชูุฏ.

+ multicast delegateูุง ุจุฑุงุจุฑูุฏ ุงฺฏุฑ ุฏููุง ููุงู ูุชุฏูุง ู ุชุฑุชุจ ุฑุง ุฏุงุดุชู ุจุงุดูุฏ.

+ contravariance ุงุฌุงุฒู ูโุฏูุฏ ูุชุฏ ูุฏูุ ูพุงุฑุงูุชุฑ ุนุงูโุชุฑ ุงุฒ delegate ุฏุงุดุชู ุจุงุดุฏ.

+ event pattern ุงุฒ ููู ูฺฺฏ ุจุฑุง ูพุดุชุจุงู ุงุฒ ุงููุงุน ูุฎุชูู ุฑูุฏุงุฏูุง ุงุณุชูุงุฏู ูโฺฉูุฏ.

#### ุณุงุฒฺฏุงุฑ ููุน ุจุงุฒฺฏุดุช ุฏุฑ Delegateูุง (Return Type Compatibility) ๐

ููุงูโุทูุฑ ฺฉู ููุช ฺฉ ูุชุฏ ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏ ููฺฉู ุงุณุช ููุน ุฎุงุตโุชุฑ ุงุฒ ฺุฒ ฺฉู ุงูุชุธุงุฑ ุฏุงุดุชุฏ ุจุฑฺฏุฑุฏุฏ (ุฑูุชุงุฑ ูุนููู polymorphism)ุ ุฏุฑ ููุฑุฏ delegateโูุง ูู ููู ููุถูุน ุตุงุฏู ุงุณุช.

ุนู ูุชุฏ ูุฏู ฺฉ delegate ูโุชูุงูุฏ ููุน ุจุงุฒฺฏุดุช ุฎุงุตโุชุฑ ุงุฒ ฺุฒ ฺฉู delegate ุชุนุฑู ฺฉุฑุฏู ุฏุงุดุชู ุจุงุดุฏ.
ุงู ูฺฺฏ ุฑุง covariance ูโูุงููุฏ.

ูุซุงู: Covariance ุฏุฑ ููุน ุจุงุฒฺฏุดุช ๐
```c#
ObjectRetriever o = new ObjectRetriever(RetrieveString);
object result = o();
Console.WriteLine(result);   // hello

string RetrieveString() => "hello";

delegate object ObjectRetriever();
```

๐น ุงูุฌุง ObjectRetriever ุงูุชุธุงุฑ ุฏุงุฑุฏ ูุชุฏ ฺฉู ุจู ุขู ูุชุตู ุงุณุชุ ฺฉ object ุจุฑฺฏุฑุฏุงูุฏ.
๐น ุงูุง ุฏุฑ ูุงูุนุชุ ูุชุฏ RetrieveString ฺฉ string ุจุฑูโฺฏุฑุฏุงูุฏ.
๐น ฺูู string ุฒุฑฺฉูุงุณ object ุงุณุชุ ุงู ูุฌุงุฒ ุงุณุช โ.

๐ ูพุณ: ููุน ุจุงุฒฺฏุดุช delegate ูุง covariant ุงุณุช.

#### ูุงุฑุงูุณ ุฏุฑ Delegateูุง ุฌูุฑฺฉ โ๏ธ

ุฏุฑ ูุตู ณ ฺฏูุชู ฺฉู ุงูุชุฑูุณโูุง ุฌูุฑฺฉ ูโุชูุงููุฏ ุงุฒ covariant ู contravariant ุงุณุชูุงุฏู ฺฉููุฏ.
ุงู ูุงุจูุช ุจุฑุง delegateโูุง ุฌูุฑฺฉ ูู ูุฌูุฏ ุฏุงุฑุฏ.

**ููุงูู ุฎูุจ ุจุฑุง ุชุนุฑู delegate ุฌูุฑฺฉ:**

ุงฺฏุฑ ูพุงุฑุงูุชุฑ ููุน (Type Parameter) ููุท ุฏุฑ ุฎุฑูุฌ ุงุณุชูุงุฏู ูโุดูุฏ โ ุจุง out (covariant) ุนูุงูุชโฺฏุฐุงุฑ ุดูุฏ.

ุงฺฏุฑ ูพุงุฑุงูุชุฑ ููุน ููุท ุฏุฑ ูุฑูุฏ ุงุณุชูุงุฏู ูโุดูุฏ โ ุจุง in (contravariant) ุนูุงูุชโฺฏุฐุงุฑ ุดูุฏ.

**ูุซุงู ฑ: Covariance ุฏุฑ ุฌูุฑฺฉโูุง (ุจุง Func) ๐ค**

ุฏุฑ ูุถุง ูุงู System ุฏุงุฑู:
```c#
delegate TResult Func<out TResult>();
```

ุงู ุจุงุนุซ ูโุดูุฏ ุจุชูุงูู ุจููุณู:
```c#
Func<string> x = () => "Hello!";
Func<object> y = x;   // โ ูุฌุงุฒ ุจู ุฎุงุทุฑ covariance
```

๐น ุนู ูโุชูุงูู Func<string> ุฑุง ุจู Func<object> ุชุจุฏู ฺฉูู ฺูู string ุฒุฑฺฉูุงุณ object ุงุณุช.

**ูุซุงู ฒ: Contravariance ุฏุฑ ุฌูุฑฺฉโูุง (ุจุง Action) ๐ฅ**

ุจุงุฒ ูู ุฏุฑ ูุถุง ูุงู System:
```c#
delegate void Action<in T>(T arg);
```

ุงู ุจุงุนุซ ูโุดูุฏ:
```c#
Action<object> x = obj => Console.WriteLine(obj);
Action<string> y = x;   // โ ูุฌุงุฒ ุจู ุฎุงุทุฑ contravariance
```

๐น ุนู ูโุชูุงูู Action<object> ุฑุง ุจู Action<string> ุชุจุฏู ฺฉูู ฺูู ูุชุฏ ฺฉู ุงูุชุธุงุฑ ุฏุฑุงูุช object ุฏุงุฑุฏุ ูโุชูุงูุฏ string ูู ุจฺฏุฑุฏ.

๐ ุฎูุงุตู:

+ ููุน ุจุงุฒฺฏุดุช delegate ูโุชูุงูุฏ ุฎุงุตโุชุฑ ุงุฒ ููุน ุชุนุฑูโุดุฏู ุจุงุดุฏ โ ุงู covariance ุงุณุช.

+ ุฏุฑ delegate ุฌูุฑฺฉ:

     + ููุน ุฎุฑูุฌ (out) โ covariant ๐ค

     + ููุน ูุฑูุฏ (in) โ contravariant ๐ฅ

ุงู ุจุงุนุซ ูโุดูุฏ ุชุจุฏูโูุง ุจู delegateูุง ุจูโุตูุฑุช ุทุจุน ู ุจุฑ ุงุณุงุณ ุงุฑุซโุจุฑ ุงูุฌุงู ุดููุฏ.
### ุฑูุฏุงุฏูุง (Events)
ููุช ุงุฒ ุฏูฺฏุชโูุง ุงุณุชูุงุฏู ูโฺฉูุฏุ ูุนูููุงู ุฏู ููุด ุฌุฏุฏ ูพุฏุฏุงุฑ ูโุดูุฏ: ูพุฎุดโฺฉููุฏู (**broadcaster**) ู ูุดุชุฑฺฉ (**subscriber**).

ูพุฎุดโฺฉููุฏู ููุน ุงุณุช ฺฉู ฺฉ ููุฏ ุฏูฺฏุช ุฏุงุฑุฏ. ูพุฎุดโฺฉููุฏู ุจุง ูุฑุงุฎูุงู ุฏูฺฏุชุ ุฒูุงู ูพุฎุด (broadcast) ุฑุง ุชุนู ูโฺฉูุฏ.

ูุดุชุฑฺฉู ฺฏุฑูุฏฺฏุงู ูุชุฏ ูุฏู ูุณุชูุฏ. ฺฉ ูุดุชุฑฺฉ ุจุง ูุฑุงุฎูุงู += ู -= ุฑู ุฏูฺฏุช ูพุฎุดโฺฉููุฏูุ ุชุตูู ูโฺฏุฑุฏ ฺู ุฒูุงู ุจู ฺฏูุด ุฏุงุฏู (**listening**) ุดุฑูุน ุง ูพุงุงู ุฏูุฏ. ฺฉ ูุดุชุฑฺฉ ุงุฒ ูุฌูุฏ ุณุงุฑ ูุดุชุฑฺฉู ุฎุจุฑ ูุฏุงุฑุฏ ู ุฏุฑ ฺฉุงุฑ ุขูโูุง ุฏุฎุงูุช ููโฺฉูุฏ.

ุฑูุฏุงุฏูุง (**Events**) ฺฉ ูฺฺฏ ุฒุจุงู ูุณุชูุฏ ฺฉู ุงู ุงูฺฏู ุฑุง ุฑุณู ูโฺฉููุฏ. ฺฉ ุฑูุฏุงุฏ ุณุงุฎุชุงุฑ ุงุณุช ฺฉู ููุท ุฒุฑูุฌููุนูโุง ุงุฒ ูฺฺฏโูุง ุฏูฺฏุช ุฑุง ฺฉู ุจุฑุง ูุฏู ูพุฎุดโฺฉููุฏู/ูุดุชุฑฺฉ ูุงุฒู ุงุณุชุ ุขุดฺฉุงุฑ ูโฺฉูุฏ. ูุฏู ุงุตู ุฑูุฏุงุฏูุง ุงู ุงุณุช ฺฉู ุงุฒ ุชุฏุงุฎู ูุดุชุฑฺฉู ุจุง ฺฉุฏฺฏุฑ ุฌููฺฏุฑ ฺฉููุฏ.

ุณุงุฏูโุชุฑู ุฑุงู ุจุฑุง ุงุนูุงู ฺฉ ุฑูุฏุงุฏุ ูุฑุงุฑ ุฏุงุฏู ฺฉููู ฺฉูุฏ `event` ูุจู ุงุฒ ฺฉ ุนุถู ุฏูฺฏุช ุงุณุช:

```C#

// Delegate definition
public delegate void PriceChangedHandler (decimal oldPrice,
                                         decimal newPrice);

public class Broadcaster
{
  // Event declaration
  public event PriceChangedHandler PriceChanged;
}
```
ฺฉุฏ ุฏุฑูู ููุน `Broadcaster` ุฏุณุชุฑุณ ฺฉุงูู ุจู `PriceChanged` ุฏุงุฑุฏ ู ูโุชูุงูุฏ ุจุง ุขู ุจู ุนููุงู ฺฉ ุฏูฺฏุช ุฑูุชุงุฑ ฺฉูุฏ. ุงูุง ฺฉุฏ ฺฉู ุฏุฑ ุฎุงุฑุฌ ุงุฒ `Broadcaster` ูุฑุงุฑ ุฏุงุฑุฏุ ุชููุง ูโุชูุงูุฏ ุนููุงุช += ู -= ุฑุง ุฑู ุฑูุฏุงุฏ `PriceChanged` ุงูุฌุงู ุฏูุฏ.

<div align="center">
    
![Conventions-UsedThis-Book](../../assets/image/04/Table-2-1.jpeg) 
</div>


