# ูุตู ููุฒุฏูู:  ุจุฑูุงููโููุณ ูพูุง (Dynamic Programming)

ูุตู ด ุชูุถุญ ุฏุงุฏ ฺฉู **dynamic binding** ุฏุฑ ุฒุจุงู C# ฺฺฏููู ฺฉุงุฑ ูโฺฉูุฏ.
ุฏุฑ ุงู ูุตูุ ุงุจุชุฏุง ุจูโุทูุฑ ูุฎุชุตุฑ ุจู **Dynamic Language Runtime (DLR)** ูโูพุฑุฏุงุฒู ู ุณูพุณ ุงูฺฏููุง ุฒุฑ ุฏุฑ ุจุฑูุงููโููุณ ูพูุง ุฑุง ุจุฑุฑุณ ูโฺฉูู:

* **Dynamic member overload resolution**
* **Custom binding (implementing dynamic objects)**
* **Dynamic language interoperability**

ุฏุฑ ูุตู ฒดุ ุชูุถุญ ูโุฏูู ฺฉู **dynamic** ฺฺฏููู ูโุชูุงูุฏ **COM interoperability** ุฑุง ุจูุจูุฏ ุฏูุฏ.

ุงููุงุน (types) ูุนุฑูโุดุฏู ุฏุฑ ุงู ูุตูุ ุฏุฑ **System.Dynamic namespace** ูุฑุงุฑ ุฏุงุฑูุฏุ ุจูโุฌุฒ **CallSite<>** ฺฉู ุฏุฑ **System.Runtime.CompilerServices** ุชุนุฑู ุดุฏู ุงุณุช.

---

### ๐ Dynamic Language Runtime

ุฒุจุงู C# ุจุฑุง ุงูุฌุงู **dynamic binding** ุจู **DLR** ูุชฺฉ ุงุณุช.

ุจุฑุฎูุงู ูุงูุดุ **DLR** ฺฉ ูุณุฎูโ ูพูุง ุงุฒ **CLR** ูุณุช. ุจูฺฉู ฺฉ **ฺฉุชุงุจุฎุงูู (library)** ุงุณุช ฺฉู ุฑู **CLR** ูุฑุงุฑ ูโฺฏุฑุฏโุฏููุงู ูุงููุฏ ูุฑ ฺฉุชุงุจุฎุงููโ ุฏฺฏุฑ ูุซู **System.Xml.dll**.

ูุธููโ ุงุตู DLR ุงุฑุงุฆูโ ุณุฑูุณโูุง ุฒูุงู ุงุฌุฑุง (runtime services) ุจุฑุง ฺฉูพุงุฑฺูโุณุงุฒ ุจุฑูุงููโููุณ ูพูุงโฺู ุฏุฑ ุฒุจุงูโูุง **statically typed** ู ฺู **dynamically typed**โุงุณุช. ุจูุงุจุฑุงูุ ุฒุจุงูโูุง ูุงููุฏ:

* C#
* Visual Basic
* IronPython
* IronRuby

ููฺฏ ุงุฒ ฺฉ ูพุฑูุชฺฉู ฺฉุณุงู ุจุฑุง **dynamic function calls** ุงุณุชูุงุฏู ูโฺฉููุฏ. ุงู ููุถูุน ุจุงุนุซ ูโุดูุฏ ุขูโูุง ุจุชูุงููุฏ ฺฉุชุงุจุฎุงููโูุง ุฑุง ุจู ุงุดุชุฑุงฺฉ ุจฺฏุฐุงุฑูุฏ ู ฺฉุฏ ุฑุง ฺฉู ุจู ุฒุจุงู ุฏฺฏุฑ ููุดุชู ุดุฏู ุงุฌุฑุง ฺฉููุฏ.

DLR ููฺูู ููุดุชู ุฒุจุงูโูุง ูพูุง ุฌุฏุฏ ุฏุฑ **.NET** ุฑุง ูุณุจุชุงู ุขุณุงู ูโฺฉูุฏ. ุจูโุฌุง ุขูฺฉู ููุณูุฏฺฏุงู ุฒุจุงู ูุฌุจูุฑ ุจุงุดูุฏ ูุณุชูู **Intermediate Language (IL)** ุชููุฏ ฺฉููุฏุ ูโุชูุงููุฏ ุฏุฑ ุณุทุญ **expression trees** ฺฉุงุฑ ฺฉููุฏ (ููุงู **expression trees** ููุฌูุฏ ุฏุฑ **System.Linq.Expressions** ฺฉู ุฏุฑ ูุตู ธ ุฏุฑุจุงุฑูโุดุงู ุตุญุจุช ฺฉุฑุฏู).

ุนูุงูู ุจุฑ ุงูุ DLR ุชุถูู ูโฺฉูุฏ ฺฉู ูููโ ูุตุฑูโฺฉููุฏฺฏุงู ุงุฒ ูุฒุช **call-site caching** ุจูุฑูโููุฏ ุดููุฏุ ฺฉ ุจูููโุณุงุฒ ฺฉู ุงุฒ ุชฺฉุฑุงุฑ ุบุฑุถุฑูุฑ ุชุตููุงุช ูพุฑูุฒููโ **member resolution** ุฏุฑ ุทูู dynamic binding ุฌููฺฏุฑ ูโฺฉูุฏ.

---

### โ Call Site ฺุณุชุ

ููุช ฺฉุงููพุงูุฑ ุจุง ฺฉ **dynamic expression** ุฑูุจูโุฑู ูโุดูุฏุ ููโุฏุงูุฏ ฺู ฺฉุณ ุขู ุนุจุงุฑุช ุฑุง ุฏุฑ ุฒูุงู ุงุฌุฑุง ุงุฑุฒุงุจ ุฎูุงูุฏ ฺฉุฑุฏ.

ูุซูุงู ูุชุฏ ุฒุฑ ุฑุง ุฏุฑ ูุธุฑ ุจฺฏุฑุฏ:

```csharp
public dynamic Foo (dynamic x, dynamic y)
{
  return x / y;   // Dynamic expression
}
```

ูุชุบุฑูุง `x` ู `y` ูโุชูุงููุฏ ูุฑ ฺุฒ ุจุงุดูุฏ:

* ฺฉ ุดุก **CLR**
* ฺฉ ุดุก **COM**
* ุง ุญุช ฺฉ ุดุก ุฏุฑ ฺฉ ุฒุจุงู ูพูุง

ุจู ููู ุฏููุ ฺฉุงููพุงูุฑ ููโุชูุงูุฏ ุงุฒ ุฑูุด ูุนููู ุงุณุชุงุชฺฉ ุฎูุฏ (ุนู ุตุฏุง ุฒุฏู ฺฉ ูุชุฏ ูุดุฎุต ุงุฒ ฺฉ ููุน ูุดุฎุต) ุงุณุชูุงุฏู ฺฉูุฏ.
ุฏุฑ ุนูุถุ ฺฉุงููพุงูุฑ ฺฉุฏ ุชููุฏ ูโฺฉูุฏ ฺฉู ุฏุฑ ููุงุช ฺฉ **expression tree** ูโุณุงุฒุฏุ ุงู **expression tree** ุนููุงุช ุฑุง ุชูุตู ูโฺฉูุฏ ฺฉู ุชูุณุท ฺฉ **call site** ูุฏุฑุช ูโุดูุฏ ู **DLR** ุขู ุฑุง ุฏุฑ ุฒูุงู ุงุฌุฑุง bind ูโฺฉูุฏ.
ุฏุฑูุงูุนุ **call site** ูุงููุฏ ฺฉ ูุงุณุทู (intermediary) ุจู **caller** ู **callee** ุนูู ูโฺฉูุฏ.

ฺฉ **call site** ุชูุณุท ฺฉูุงุณ **CallSite<>** ุฏุฑ **System.Core.dll** ููุงุด ุฏุงุฏู ูโุดูุฏ.
ุจุง **disassemble** ฺฉุฑุฏู ูุชุฏ ูุจูุ ูุชุฌู ุชูุฑุจุงู ุจูโุดฺฉู ุฒุฑ ุฎูุงูุฏ ุจูุฏ:

```csharp
static CallSite<Func<CallSite,object,object,object>> divideSite;

[return: Dynamic]
public object Foo ([Dynamic] object x, [Dynamic] object y)
{
  if (divideSite == null)
    divideSite =
      CallSite<Func<CallSite,object,object,object>>.Create (
        Microsoft.CSharp.RuntimeBinder.Binder.BinaryOperation (
          CSharpBinderFlags.None,
          ExpressionType.Divide,
          /* Remaining arguments omitted for brevity */ ));

  return divideSite.Target (divideSite, x, y);
}
```

ููุงูโุทูุฑ ฺฉู ูโุจูุฏุ **call site** ุฏุฑ ฺฉ **static field** ุฐุฎุฑู ูโุดูุฏ ุชุง ูุฒููโ ุณุงุฎุช ูุฌุฏุฏ ุขู ุฏุฑ ูุฑ ุจุงุฑ ูุฑุงุฎูุงู ุงุฌุชูุงุจ ุดูุฏ.
ููฺููุ DLR ูุชุฌูโ **binding phase** ู **method targets** ูุงูุน ุฑุง cache ูโฺฉูุฏ. (ููฺฉู ุงุณุช ฺูุฏู target ุจุณุชู ุจู ููุนโูุง `x` ู `y` ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏ.)

ูุฑุงุฎูุงู ูพูุง (dynamic call) ุฏุฑ ุนูู ุจุง ุตุฏุง ุฒุฏู **Target** (ฺฉู ฺฉ **delegate** ุงุณุช) ุงูุฌุงู ูโุดูุฏ ู ุนููููุฏูุง `x` ู `y` ุจู ุขู ูพุงุณ ุฏุงุฏู ูโุดููุฏ.

ูฺฉุชูโ ููู: ฺฉูุงุณ **Binder** ูุฎุตูุต ูุฑ ุฒุจุงู ุงุณุช.
ูุฑ ุฒุจุงู ฺฉู ุงุฒ **dynamic binding** ูพุดุชุจุงู ูโฺฉูุฏุ ฺฉ **language-specific binder** ุฏุงุฑุฏ ุชุง ุจู DLR ฺฉูฺฉ ฺฉูุฏ ุนุจุงุฑุงุช ุฑุง ูุทุงุจู ููุทู ุขู ุฒุจุงู ุชูุณุฑ ฺฉูุฏ ู ุฑูุชุงุฑ ุบุฑููุชุธุฑู ุจุฑุง ุจุฑูุงููโููุณ ุงุฌุงุฏ ูุดูุฏ.

ูุซูุงู ุงฺฏุฑ ูุชุฏ `Foo` ุฑุง ุจุง ููุงุฏุฑ ุนุฏุฏ `5` ู `2` ุตุฏุง ุจุฒูู:

* **C# binder** ูุชุฌูโ `2` ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ.
* ุงูุง **VB.NET binder** ูุชุฌูโ `2.5` ุฑุง ุฎูุงูุฏ ุฏุงุฏ.

---

### โก Dynamic Member Overload Resolution

ูุฑุงุฎูุงู ฺฉ ูุชุฏ **statically known** ุจุง ุขุฑฺฏููุงูโูุง **dynamically typed** ุจุงุนุซ ูโุดูุฏ ฺฉู **member overload resolution** ุงุฒ ุฒูุงู ฺฉุงููพุงู ุจู ุฒูุงู ุงุฌุฑุง ููุชูู ุดูุฏ.

ุงู ูฺฺฏ ุจุฑุง ุณุงุฏูโุณุงุฒ ุจุฑุฎ ูุธุงู ุจุฑูุงููโููุณ ููุฏ ุงุณุชโูุซู ุณุงุฏูโุชุฑ ฺฉุฑุฏู **Visitor design pattern**.
ููฺูู ุฏุฑ ุฏูุฑ ุฒุฏู ูุญุฏูุฏุชโูุง ุงุนูุงูโุดุฏู ุชูุณุท **static typing** ุฏุฑ C# ุจุณุงุฑ ฺฉุงุฑุจุฑุฏ ุฏุงุฑุฏ.

